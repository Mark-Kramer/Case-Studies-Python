

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Analysis of Rhythmic Spike Train Data &#8212; Case Studies in Neural Data Analysis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/custom.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script async="async" src="_static/thebelab.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="canonical" href="https://mark-kramer.github.io/Case-Studies-Python/10.html" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Spike-field coherence" href="11.html" />
    <link rel="prev" title="Point Process Generalized Linear Models" href="09.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">


<!-- Opengraph tags -->
<meta property="og:url"         content="https://mark-kramer.github.io/Case-Studies-Python/10.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Analysis of Rhythmic Spike Train Data" />
<meta property="og:description" content="Analysis of Rhythmic Spike Train Data  <div class="question">   Synopsis  Data: Spiking activity from one neuron over 50 trials each of 2 s duration.  Goal: Cha" />
<meta property="og:image"       content="https://mark-kramer.github.io/Case-Studies-Python/_static/logo.png" />

<meta name="twitter:card" content="summary">


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Case Studies in Neural Data Analysis</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="01.html">1. Python for the practicing neuroscientist</a>
  </li>
  <li class="">
    <a href="02.html">2. The Event-Related Potential</a>
  </li>
  <li class="">
    <a href="03.html">3. The Power Spectrum (Part 1)</a>
  </li>
  <li class="">
    <a href="04.html">4. The Power Spectrum (Part 2)</a>
  </li>
  <li class="">
    <a href="05.html">5. Analysis of Coupled Rhythms</a>
  </li>
  <li class="">
    <a href="06.html">6. Filtering Field Data</a>
  </li>
  <li class="">
    <a href="07.html">7. Cross-frequency coupling</a>
  </li>
  <li class="">
    <a href="08.html">8. Basic Analysis of Spike Train Data</a>
  </li>
  <li class="">
    <a href="09.html">9. Point Process Generalized Linear Models</a>
  </li>
  <li class="active">
    <a href="">10. Analysis of Rhythmic Spike Train Data</a>
  </li>
  <li class="">
    <a href="11.html">11. Spike-field coherence</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Extra notebooks</p>
</li>
  <li class="">
    <a href="IF.html">12. The integrate and fire neuron</a>
  </li>
  <li class="">
    <a href="HH.html">13. The Hodgkin-Huxley model</a>
  </li>
  <li class="">
    <a href="Perceptron.html">14. Training a Perceptron</a>
  </li>
  <li class="">
    <a href="Backprop.html">15. Backpropagation</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="_sources/10.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.ipynb</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Source interaction buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
            <div class="dropdown-buttons sourcebuttons">
                <a class="repository-button" href="https://github.com/Mark-Kramer/Case-Studies-Python"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left" title="Source repository"><i class="fab fa-github"></i>repository</button></a>
                <a class="issues-button" href="https://github.com/Mark-Kramer/Case-Studies-Python/issues/new?title=Issue%20on%20page%20%2F10.html&body=Your%20issue%20content%20here."><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left" title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
                
            </div>
        </div>
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
            <div class="dropdown-buttons">
                
                <a class="binder-button" href="https://mybinder.org/v2/gh/Mark-Kramer/Case-Studies-Python/gh-pages?urlpath=tree/_book/10.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip" data-placement="left"><img class="binder-button-logo" src="_static/images/logo_binder.svg" alt="Interact on binder">Binder</button></a>
                
                
                <button type="button" class="btn btn-secondary topbarbtn thebelab-launch-button" onclick="initThebelab()" title="Launch Thebelab" data-toggle="tooltip" data-placement="left"><i class="fas fa-rocket"></i><span style="margin-left: .4em;">ThebeLab</span></button>
                
            </div>
        </div>
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#on-ramp-analyzing-rhythmic-spiking-in-python-a-id-onramp-a" class="nav-link">On-ramp: analyzing rhythmic spiking in Python<a id="onramp"></a></a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#introduction-a-id-introduction-a" class="nav-link">Introduction<a id="introduction"></a></a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#background" class="nav-link">Background</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#case-study-data" class="nav-link">Case Study Data</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#goal" class="nav-link">Goal</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#tools-a-id-tools-a" class="nav-link">Tools<a id="tools"></a></a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#data-analysis-a-id-data-analysis-a" class="nav-link">Data Analysis<a id="data-analysis"></a></a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#visual-inspection-a-id-visual-inspection-a" class="nav-link">Visual Inspection<a id="visual-inspection"></a></a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#spectral-analysis-of-spiking-data-a-id-spectral-analysis-a" class="nav-link">Spectral Analysis of Spiking Data <a id="spectral-analysis"></a></a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#point-process-spectral-theory" class="nav-link">Point Process Spectral Theory</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#spectral-estimates-for-the-stn-data" class="nav-link">Spectral Estimates for the STN Data</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#point-process-models" class="nav-link">Point Process Models</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#model-1" class="nav-link">Model 1</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#refining-the-model-movement-direction" class="nav-link">Refining the Model: Movement Direction</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#refining-the-model-history-dependence-a-id-history-dependence-a" class="nav-link">Refining the Model: History Dependence<a id="history-dependence"></a></a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#choice-of-model-order" class="nav-link">Choice of Model Order</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#refining-the-model-smooth-history-dependence" class="nav-link">Refining the Model: Smooth History Dependence</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#drawing-conclusions-from-the-model-a-id-drawing-conclusions-a" class="nav-link">Drawing Conclusions from the Model<a id="drawing-conclusions"></a></a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#summary-a-id-summary-a" class="nav-link">Summary<a id="summary"></a></a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="analysis-of-rhythmic-spike-train-data">
<h1>Analysis of Rhythmic Spike Train Data<a class="headerlink" href="#analysis-of-rhythmic-spike-train-data" title="Permalink to this headline">¶</a></h1>
<div class="question">
<p><em><strong>Synopsis</strong></em></p>
<p><strong>Data:</strong> Spiking activity from one neuron over 50 trials each of 2 s duration.</p>
<p><strong>Goal:</strong> Characterize and interpret features of rhythmic spiking activity.</p>
<p><strong>Tools:</strong> ISI histograms, autocorrelation plots, point process spectral estimators, history-dependent generalized linear models.</p>
</div><ul class="simple">
<li><p><a class="reference external" href="#onramp">On-ramp: analyzing rhythmic spiking in Python</a></p></li>
<li><p><a class="reference external" href="#introduction">Introduction</a></p>
<ul>
<li><p><a class="reference external" href="#tools">Tools</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#data-analysis">Data analysis</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#visual-inspection">Visual Inspection</a></p></li>
<li><p><a class="reference external" href="#ppm">Point Process Models</a></p></li>
<li><p><a class="reference external" href="#spectral-analysis">Spectral Analysis of Spiking Data</a></p></li>
<li><p><a class="reference external" href="#drawing-conclusions">Drawing Conclusions from the Model</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#summary">Summary</a></p></li>
</ul>
<div class="section" id="on-ramp-analyzing-rhythmic-spiking-in-python-a-id-onramp-a">
<h2>On-ramp: analyzing rhythmic spiking in Python<a id="onramp"></a><a class="headerlink" href="#on-ramp-analyzing-rhythmic-spiking-in-python-a-id-onramp-a" title="Permalink to this headline">¶</a></h2>
<p>We begin this notebook with an “<em>on-ramp</em>” to analysis. The purpose of this on-ramp is to introduce you immediately to a core concept in this notebook: how to analyze rhythmic spiking in Python. You may not understand all aspects of the program here, but that’s not the point. Instead, the purpose of this on-ramp is to  illustrate what <em>can</em> be done. Our advice is to simply run the code below and see what happens …</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the usual suspects ...</span>
<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">loadmat</span>            <span class="c1"># To load .mat files</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="o">*</span>                     <span class="c1"># Import plotting functions</span>

<span class="c1"># ... and the modules we need for this notebook</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.genmod.families</span> <span class="kn">import</span> <span class="n">Poisson</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span> <span class="k">as</span> <span class="n">df</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">concat</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;matfiles/10_spikes-1.mat&#39;</span><span class="p">)</span>          <span class="c1"># Load the spike train data.</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>                        <span class="c1"># Extract the t variable.</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1"># Extract the direction variable.</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span>                   <span class="c1"># Extract the train variable</span>

<span class="n">nTrial</span><span class="p">,</span> <span class="n">nTime</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span>             <span class="c1"># Number of trials and number of time points.</span>
<span class="n">IMove</span> <span class="o">=</span> <span class="n">tile</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nTrial</span><span class="p">)</span>            <span class="c1"># Define movement period.</span>
<span class="n">IDir</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="n">direction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nTime</span><span class="p">)</span>    <span class="c1">#  Define direction of movement</span>
<span class="n">spikes</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>                <span class="c1"># Reshape  trials into a single vector</span>
                                        <span class="c1"># Create a dataframe with the data to fit</span>
<span class="n">glmdata</span> <span class="o">=</span> <span class="n">df</span><span class="p">({</span><span class="s1">&#39;IMove&#39;</span><span class="p">:</span> <span class="n">IMove</span><span class="p">,</span> <span class="s1">&#39;spikes&#39;</span><span class="p">:</span> <span class="n">spikes</span><span class="p">,</span> <span class="s1">&#39;IDir&#39;</span><span class="p">:</span> <span class="n">IDir</span><span class="p">})</span>

<span class="n">ordK</span> <span class="o">=</span> <span class="mi">70</span>                               <span class="c1"># Define the model order for spike history.</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordK</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>            <span class="c1"># For each lag,</span>
                                        <span class="c1"># ... add spiking history to dataframe.</span>
    <span class="n">glmdata</span><span class="p">[</span><span class="s1">&#39;lag</span><span class="si">{:02d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">roll</span><span class="p">(</span><span class="n">glmdata</span><span class="o">.</span><span class="n">spikes</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>  

<span class="n">glmdata</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">nTrial</span><span class="p">)</span>       <span class="c1"># Add a Time to dataframe.</span>
                                        <span class="c1"># Reference only times &gt;= ordK</span>
<span class="n">glmHist</span> <span class="o">=</span> <span class="n">glmdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">[</span><span class="n">ordK</span><span class="p">]]</span>
                                        <span class="c1"># Create a string with all lag columns</span>
<span class="n">lagColumns</span> <span class="o">=</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">glmHist</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;lag&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Model formula: spikes as a function of IMove, IDir and history</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;spikes ~ IMove + IDir + IMove : (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lagColumns</span><span class="p">)</span>
                                        <span class="c1"># Fit the model</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">glmHist</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">Poisson</span><span class="p">())</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                                        <span class="c1"># Plot history dependence during planning period.</span>
<span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordK</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">exp</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>                <span class="c1"># With axes labeled.</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag (ms)&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Exponentiated GLM parameters related to history dependence&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_4_0.png" src="_images/10_4_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q:</strong> Try to read the code above. Can you see how it loads data, builds a statistical model of the data with history dependence, and fits the model?</p>
<p><strong>A:</strong> If you’ve never created a statistical model with history dependence before, that’s an especially difficult question. Please continue on to learn this <strong>and more</strong>!</p>
</div></div>
<div class="section" id="introduction-a-id-introduction-a">
<h2>Introduction<a id="introduction"></a><a class="headerlink" href="#introduction-a-id-introduction-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="background">
<h3>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h3>
<p>The subthalamic nucleus (STN) is a component of the basal ganglia that is thought to play an important role in the regulation of motor function. Neurons in the STN often have rhythmic spiking dynamics, and aberrations in the spike rhythms in STN have been associated with tremor and other motor symptoms in Parkinson’s disease. In fact, the STN is one of the primary targets for deep brain stimulation (DBS) to treat Parkinsonian disorders. While the mechanisms by which DBS works are largely unknown, many researchers have hypothesized that altering rhythmic activity in the STN is an important component. Therefore, it is important to be able to characterize spike rhythms in STN neurons and to know with statistical confidence when these rhythms have changed.</p>
<p>In previous notebooks, we developed and used methods to uncover rhythmic dynamics in field recordings. Many of the methods used to characterize rhythms in <em>spiking data</em> may be familiar, like autocorrelation functions and spectral estimators, but will require additional care to interpret. In some cases, rhythmic spiking dynamics can be much more subtle than the rhythms identified fields, and statistical modeling methods will be needed to make powerful inferences from spiking data.</p>
</div>
<div class="section" id="case-study-data">
<h3>Case Study Data<a class="headerlink" href="#case-study-data" title="Permalink to this headline">¶</a></h3>
<p>A clinical neurosurgeon contacts you to help her analyze spiking data she collects from patients with Parkinson’s disease during surgery to implant DBS electrodes. She is interested in making sure that the electrode is localized properly in the STN, and in studying the role that STN activity plays in movement planning and execution for these patients. She asks each patient to perform a simple hand movement task during the electrode implantation procedure, and records the resulting neural activity.</p>
<p>The data consist of single unit spiking activity from one STN neuron recorded over 50 trials of a hand movement task. In each trial, a patient held a joystick and watched cues appear on a screen. The first cue indicated whether the patient should move the joystick to the left or right. The second cue, the GO cue, indicated the time to start moving the joystick. The dataset contains 2 s of activity for each trial, 1 s before the GO cue and 1 s after. We label the period before the GO cue comes on the planning period, and the period after the GO cue the movement period.</p>
</div>
<div class="section" id="goal">
<h3>Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h3>
<p>It is well known that the spiking activity of some STN neurons in patients with Parkinson’s disease shows rhythmic properties in the beta frequency range, 11–30 Hz (<a href="https://doi.org/10.1001/archneurpsyc.1938.02270010106010" rel="external">[Jasper &amp; Andrews, 1938]</a>, <a href="https://doi.org/10.1016/j.neuroimage.2013.05.084" rel="external">[Brittain &amp; Brown, 2014]</a>). The neurosurgeon hypothesizes that information related to the movement task, such as the planning versus the movement period and whether the movement is to the left or right, will influence this rhythmic spiking activity. Our goal is to characterize the spiking properties, identify whether rhythmic activity is present and statistically significant, and how such activity is influenced by the task variables.</p>
</div>
<div class="section" id="tools-a-id-tools-a">
<h3>Tools<a id="tools"></a><a class="headerlink" href="#tools-a-id-tools-a" title="Permalink to this headline">¶</a></h3>
<p>We extend some of the tools already developed for studying rhythms and modeling spike trains. Many of the <a href="08" rel="local">basic visualization tools</a>, such as raster plots, ISI histograms, and autocorrelation functions are useful without modification. We compute spectral estimators for spiking data using the same methods as before, but we have to think carefully about how to interpret the spectrum of a point process. Finally, we extend the <a href="09" rel="local">GLM methods we previously developed for spike train data</a> to allow us to model history-dependent, non-Poisson spiking processes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the usual suspects ...</span>
<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">loadmat</span>                    <span class="c1"># To load .mat files</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="o">*</span>                             <span class="c1"># Import plotting and numerical functions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... and the modules we need for this notebook</span>
<span class="kn">from</span> <span class="nn">nitime.algorithms</span> <span class="kn">import</span> <span class="n">multi_taper_psd</span>
<span class="kn">from</span> <span class="nn">nitime.utils</span> <span class="kn">import</span> <span class="n">dpss_windows</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.genmod.families</span> <span class="kn">import</span> <span class="n">Poisson</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span> <span class="k">as</span> <span class="n">df</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">concat</span>
<span class="kn">from</span> <span class="nn">statsmodels.distributions.empirical_distribution</span> <span class="kn">import</span> <span class="n">ECDF</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">norm</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="data-analysis-a-id-data-analysis-a">
<h2>Data Analysis<a id="data-analysis"></a><a class="headerlink" href="#data-analysis-a-id-data-analysis-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="visual-inspection-a-id-visual-inspection-a">
<h3>Visual Inspection<a id="visual-inspection"></a><a class="headerlink" href="#visual-inspection-a-id-visual-inspection-a" title="Permalink to this headline">¶</a></h3>
<p>Let’s start by loading the data into Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;matfiles/10_spikes-1.mat&#39;</span><span class="p">)</span>           <span class="c1"># Load the spike train data.</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1"># Extract the t variable.</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Extract the direction variable.</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span>                    <span class="c1"># Extract the train variable</span>
</pre></div>
</div>
</div>
</div>
<p>We find three variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">direction</span></code>: A 50×1 vector of indicators for the movement direction for each of 50 trials. A value of 0 indicates movement to the left, and a value of 1 indicates movement to the right.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t</span></code>: A 1×2000 vector of time stamps in milliseconds indicating the time into the trial. Time 0 indicates the GO cue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train</span></code>: A 50×2000 matrix of spike counts in each trial and time bin. The rows of the matrix correspond to trials, while the columns correspond to time.</p></li>
</ul>
<div class = "question">
<p><strong>Q:</strong> How many trials involve movment to the left? to the right?</p>
<p><strong>A:</strong> To answer this, we must count the number of zeros and ones in direction. The <code class="docutils literal notranslate"><span class="pre">sum</span></code> function provides an efficient method to do so: <code class="docutils literal notranslate"><span class="pre">sum(direction)</span></code> which returns a value of 25. We conclude that half of the 50 trials involve right movement, and half involve left movement.</p>
</div><p>Our first goal is to construct a raster plot to visualize the spikes through time for every trial. There are many ways to create this plot in Python. One simple way is to realize that the matrix consists of a collection of zeros and ones as a function of time and trial, corresponding exactly to the information for the raster plot. We can treat this matrix as an image and visualize it using the <code class="docutils literal notranslate"><span class="pre">imshow()</span></code> function in Python:<a id="fig:raster"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imshow</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray_r&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_14_0.png" src="_images/10_14_0.png" />
</div>
</div>
<p>Here, we have adjusted the colormap to draw black ticks on a white background for clarity and ease of visual inspection.</p>
<p>Visually, we do not observe much obvious structure in the raster plot. There does not seem to be substantially more spiking either before or after the GO cue. It is also difficult to see any effect of the movement direction for each trial, since left and right trials are interspersed. We can remedy this by grouping all 25 of the left trials together, and all 25 of the right trials together, and generating a new set of raster plots for each trial type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ltrials</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">direction</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>   <span class="c1">#Identify left trials,</span>
<span class="n">Rtrials</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">direction</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>   <span class="c1">#... and right trials.</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">Ltrials</span><span class="p">],</span> <span class="n">aspect</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray_r&#39;</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># Image left trials,</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Trial&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Left trials&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>

<span class="n">imshow</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">Rtrials</span><span class="p">],</span> <span class="n">aspect</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray_r&#39;</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># ... and right trials.</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Trial&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Right trials&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_16_0.png" src="_images/10_16_0.png" />
<img alt="_images/10_16_1.png" src="_images/10_16_1.png" />
</div>
</div>
<div class="question">
<p><strong>Q:</strong> Consider the raster plots for the left and right trials in the above figure. Do you notice any difference in spiking between the two trial types? Is rhythmic spiking apparent?</p>
<p><strong>A:</strong> In the separate raster plots we observe slightly more spiking during left trials than during right trials, both during the planning (before time 0 s) and movement (after time 0 s) periods. However, we do not observe in this raster plot clear evidence of rhythmic spiking. There are places where you might convince yourself that rhythmic spiking is present, but it is not clear whether this structure is real or could occur by chance.</p>
</div><p>Often when people think about rhythms in spiking data, they think about spiking occurring almost perfectly regularly at some fixed frequency, like a metronome. However, it is rare to find neural spiking systems with this kind of regularity. Instead, if we think about spiking activity as arising from a random point process, we can consider rhythmic spiking as the influence of past spiking on the probability of observing a spike at some time in the future. In other words, another way to think about rhythmic spiking is as a history-dependent point process. Later, we build specific probability models to capture this history dependence. But first we visualize the other influences in the data, those related to planning and movement, and to direction.</p>
<p>We initially construct a <strong>peristimulus time histogram</strong> (PSTH). These PSTHs are useful for visualizing the relation between spike rates and the time relative to a specific time point in repeated trial data. In this case, we look at the spiking rate relative to the time of the GO cue. To compute the PSTH, we partition the time interval into bins, add up the number of spikes that occur within each bin over all trials, and then divide by the number of trials and by the length of the bin. Most often, we select a fixed time width for all the bins.</p>
<p>The matrix <code class="docutils literal notranslate"><span class="pre">train</span></code> already contains the binned spiking data, where the bins are each 1 ms in duration. If we want to use 1 ms bins for the PSTH, all that needs to be done is to sum over all the trials and scale by the number of trials and bin length.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PSTH</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">train</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span> <span class="o">/</span> <span class="mf">1e-3</span>
</pre></div>
</div>
</div>
</div>
<p>Here we divide by 50 because we sum the spiking over 50 trials, and we divide by 1e-3 = 0.001 because the bin width is 1 ms = 0.001 s, and we would like to express the rate in units of spikes/s, or Hz. However, this method will only work for 1 ms bins. A more general approach is to find the times of all the spikes and use the <code class="docutils literal notranslate"><span class="pre">histogram</span></code> command to compute the PSTH:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spiketrials</span><span class="p">,</span> <span class="n">spiketimes</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">,</span><span class="mi">2000</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">50</span><span class="o">/</span><span class="mf">1e-3</span>
</pre></div>
</div>
</div>
</div>
<p>Either method produces the same PSTH result. Now let’s use the <code class="docutils literal notranslate"><span class="pre">bar</span></code> function to produce a bar graph of the PSTH:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bar</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">hist</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> 
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spike Rate (spikes/s)&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_23_0.png" src="_images/10_23_0.png" />
</div>
</div>
<p>Although it was not immediately clear from the raster plot, it is evident in the PSTH that there is a difference in the firing rate between planning and movement periods. The firing rate during planning (time &lt; 0 ms) appears to average around 60 spikes/s, and the firing rate during movement (time &gt; 0 ms) appears to be slightly elevated, averaging around 80 spikes/s. However, this PSTH may be a bit misleading because of the very small bin widths used. In each bin, the PSTH only appears to take a few discrete values (e.g., 40, 60, 80 spikes/s) with nothing in between. Also, there are many bins where the PSTH value is equal to zero; these bins are not obvious in the figure because they are masked by nearby bins. The initial PSTH therefore gives a false sense of the average spike rate. To investigate further, let’s increase the PSTH bin width:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PSTH10</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">,</span> <span class="mi">200</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>                  <span class="c1">#Compute histogram using 10 ms bins</span>
<span class="n">bar</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span> <span class="n">PSTH10</span><span class="o">/</span><span class="mi">50</span><span class="o">/</span><span class="mi">10</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1">#... and plot it.</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_25_0.png" src="_images/10_25_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q:</strong> How does the second input to the hist function specify 10 ms bins?</p>
</div><p>With 10 ms bin widths, the difference in firing rate between planning and movement periods is still evident, but we see that we had overestimated the firing rate because bins with small PSTH values were masked by neighboring bins with higher values. Now we find that the average firing rate during planning is closer to 35 spikes/s, while the rate during movement is closer to 55 spikes/s.</p>
<div class="question">
<p><strong>Q:</strong> Construct a PSTH for these data with 100 ms bins. How does the result compare to the 10 ms bin PSTH in the above figure? What might be some issues that impact PSTHs with large bin widths? What do you think might be a good way to select bin widths for a PSTH?</p>
</div><p>We can also compute the average spike rate in the movement and planning periods directly. To do so, we need to average the spiking data over both trials and time in each period.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">i_plan</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>                   <span class="c1">#Indices for planning.</span>
<span class="n">i_move</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>                  <span class="c1">#Indices for movement.</span>
                                           <span class="c1">#Compute the average spike rate,</span>
<span class="n">PlanRate</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">train</span><span class="p">[:,</span> <span class="n">i_plan</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e-3</span>   <span class="c1">#...during planning,</span>
<span class="n">MoveRate</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">train</span><span class="p">[:,</span> <span class="n">i_move</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e-3</span>   <span class="c1">#...during movement.</span>
</pre></div>
</div>
</div>
</div>
<p>Executing these commands, we find <code class="docutils literal notranslate"><span class="pre">PlanRate</span> <span class="pre">=</span> <span class="pre">38.96</span></code>, and <code class="docutils literal notranslate"><span class="pre">MoveRate</span> <span class="pre">=</span> <span class="pre">54.96</span></code>. These results are consistent with our estimation of the average firing rates through visual inspection of the histogram with 10 ms bins.</p>
<p>In addition to the planning and movement periods, the task can be broken down based on the direction of movement that is cued. The variable direction contains an indicator variable for each trial, which is 0 for left trials and 1 for right trials. Since the left and right trials are interspersed, we need to first find which trials correspond to each direction, and then compute the firing rates for each type of trial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ltrials</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">direction</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>           <span class="c1">#Find left trials,</span>
<span class="n">Rtrials</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">direction</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>           <span class="c1">#... and right trials,</span>
<span class="n">LRate</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">Ltrials</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="mf">1e-3</span>  <span class="c1">#... and compute rates.</span>
<span class="n">RRate</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">Rtrials</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="mf">1e-3</span>
</pre></div>
</div>
</div>
</div>
<div class="question">
<p><strong>Q:</strong> What do you conclude about the firing rates for the two types of trials?</p>
<p><strong>A:</strong> Upon executing these commands, we find <code class="docutils literal notranslate"><span class="pre">LRate</span> <span class="pre">=</span> <span class="pre">58.66</span></code> and <code class="docutils literal notranslate"><span class="pre">RRate</span> <span class="pre">=</span> <span class="pre">35.26</span></code>. These results suggest that the spiking rates for planning and movement in left trials are higher than the rates for right trials.</p>
</div><p>We have now shown that the average firing rate changes between planning and movement periods, and between left and right trials. One question that arises is how the changes pertaining to trial period and to trial direction are related. We have four categories to explore: planning for left trials, planning for right trials, movement on left trials, and movement on right trials. We could compute the mean firing rates in each of these categories. Instead, let’s examine the trial-to-trial distribution of firing rates in each category. Let’s sum the spiking over each 1 s planning or movement period for each trial type, and generate a box plot that visualizes these distributions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PlanL</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">Ltrials</span><span class="p">][:,</span><span class="n">i_plan</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>   <span class="c1"># Firing rate L, planning.</span>
<span class="n">PlanR</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">Rtrials</span><span class="p">][:,</span><span class="n">i_plan</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>   <span class="c1"># Firing rate R, planning.</span>
<span class="n">MoveL</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">Ltrials</span><span class="p">][:,</span><span class="n">i_move</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>   <span class="c1"># Firing rate L, movement.</span>
<span class="n">MoveR</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">Rtrials</span><span class="p">][:,</span><span class="n">i_move</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>   <span class="c1"># Firing rate R, movement.</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">boxplot</span><span class="p">([</span><span class="n">PlanL</span><span class="p">,</span> <span class="n">PlanR</span><span class="p">,</span> <span class="n">MoveL</span><span class="p">,</span> <span class="n">MoveR</span><span class="p">],</span> <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> 
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Plan Left&#39;</span><span class="p">,</span> <span class="s1">&#39;Plan Right&#39;</span><span class="p">,</span> <span class="s1">&#39;Move Left&#39;</span><span class="p">,</span> <span class="s1">&#39;Move Right&#39;</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spike Rate (spikes/s)&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_35_0.png" src="_images/10_35_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q:</strong> Have you used the function <code class="docutils literal notranslate"><span class="pre">boxplot</span></code> before? If not, <a href="https://matplotlib.org/3.2.1/api/_as_gen/matplotlib.pyplot.boxplot.html" rel="external">look it up</a>.</p>
</div><div class="question">
<p><strong>Q:</strong> How do the variables in this code correspond to firing rates?</p>
<p><strong>A:</strong> In this case, the duration of the interval is 1 s for both planning and movement periods. Therefore, we may think of dividing each sum by 1 s, which does not affect the numerical values in the variables.</p>
</div><p>The box plot corroborates our previous findings that the firing rate is increased in left trials and in the movement period of each trial. Further, it suggests that these effects may occur independently and additively; the difference between left and right trials seems approximately the same for both planning and movement periods. At this stage, it would be natural to ask whether these differences between mean firing rates are statistically significant. We explore issues of significance later, and discuss why some traditional approaches for comparing means across groups (such as <em>t</em>-tests between pairs or analysis of variance between all groups) might not capture the structure in the data very well.</p>
<p>While these visualizations have helped elucidate the long-term spiking structure over periods of about 1 s, they have not provided much information about short-term rhythmic structure. In <a href="08" rel="local">notebook 8</a>, we used interspike interval (ISI) histograms to help visualize fine time scale history dependence in spiking activity. Let’s do so again here. To compute the ISI histogram, we first need to compute the ISIs. One approach is to write a for-loop that iterates through each trial in the <code class="docutils literal notranslate"><span class="pre">train</span></code> matrix, finds the spike times, and computes the ISIs. However, in constructing the PSTH, we computed the variable <code class="docutils literal notranslate"><span class="pre">spiketimes</span></code>, which already contains the spike times in trial 1, followed by the spike times in trial 2, and so on, all in one array. If we compute the differences in these spike times, we will have the ISIs for each trial mixed with an occasional negative value when an element of spiketimes is the first spike time for any trial. Let’s eliminate these spurious values and plot a histogram of the ISIs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ISIs</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">)</span>                     <span class="c1">#Compute ISIs for all trials,</span>
<span class="n">ISIs</span> <span class="o">=</span> <span class="n">ISIs</span><span class="p">[</span><span class="n">where</span><span class="p">(</span><span class="n">ISIs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>                <span class="c1">#... and ignore ISIs &quot;across trials&quot;</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="n">ISIs</span><span class="p">,</span> <span class="mi">250</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>              <span class="c1">#Compute histogram of ISIs,</span>
<span class="n">bar</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="n">hist</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">#... and plot it.</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Interspike Interval (ms)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram of ISIs&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_39_0.png" src="_images/10_39_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q:</strong> Can you think of a way this code might lead to incorrect computation of the ISIs? Did this happen for this dataset?</p>
<p><strong>A:</strong> If the last spike in any given trial occurred at an earlier time than the first spike in the subsequent trial, then the ISI computed between trials would not be negative and would not be removed. This never happens in these data, but it suggests that we should be careful when we code various procedures to think about the possible outcomes.</p>
</div><p>The ISI histogram in the above figure reveals a few interesting features, including a short relative refractory period (fewer ISIs near 0 ms) and a large number of ISIs near about 6 ms, suggesting bursting activity (i.e., times of rapid spiking with small intervals between spikes). However, it is difficult to see any structure that looks like clear rhythmic spiking, such as a large second peak at longer ISIs. Let’s see if there is a difference in the ISI distributions for planning and movement periods:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#In the planning period,       </span>
<span class="n">spiketrialsPlan</span><span class="p">,</span> <span class="n">spiketimesPlan</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[:,</span><span class="n">i_plan</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">#Find spikes</span>
<span class="n">PlanISIs</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">spiketimesPlan</span><span class="p">)</span>                              <span class="c1">#... compute ISIs,</span>
<span class="n">PlanISIs</span> <span class="o">=</span> <span class="n">PlanISIs</span><span class="p">[</span><span class="n">where</span><span class="p">(</span><span class="n">PlanISIs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>                     <span class="c1">#... drop spurious ones.</span>
<span class="n">planhist</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="n">PlanISIs</span><span class="p">,</span> <span class="mi">250</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">bar</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="n">planhist</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>              <span class="c1">#Plot ISIs,</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Interspike Interval (ms)&#39;</span><span class="p">)</span>                           <span class="c1">#... label axes.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Planning&#39;</span><span class="p">)</span>

<span class="c1">#In the movement period,       </span>
<span class="n">spiketrialsMove</span><span class="p">,</span> <span class="n">spiketimesMove</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[:,</span> <span class="n">i_move</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="c1">#Find spikes</span>
<span class="n">MoveISIs</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">spiketimesMove</span><span class="p">)</span>                              <span class="c1">#... compute ISIs,</span>
<span class="n">MoveISIs</span> <span class="o">=</span> <span class="n">MoveISIs</span><span class="p">[</span><span class="n">where</span><span class="p">(</span><span class="n">MoveISIs</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)]</span>                       <span class="c1">#... drop spurious ones.</span>
<span class="n">movehist</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="n">MoveISIs</span><span class="p">,</span> <span class="mi">250</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">bar</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="n">movehist</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>              <span class="c1">#Plot ISIs,</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Interspike Interval (ms)&#39;</span><span class="p">)</span>                           <span class="c1">#... label axes.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Movement&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_42_0.png" src="_images/10_42_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q:</strong> What features differ between the ISI histograms for the planning and movement periods, shown above?</p>
<p><strong>A:</strong> There are a few notable differences between the ISI histograms in the two periods. The total number of ISIs is larger during the movement period, corroborating our earlier finding that the firing rate is higher during this period. The peak in the ISI distribution around 6 ms seems more pronounced during movement, suggesting a higher tendency to fire in bursts. There may be some differences in the tail structure of the ISI distribution at ISI values above 20 ms, but it is difficult to relate this to differences in rhythmic spiking structure.</p>
</div><p>In <a href="08" rel="local">notebook 8</a>, we also used the sample <strong>autocorrelation function</strong> (ACF) to visualize history-dependent spiking properties. Recall that the ACF shows the correlation between a signal at two points in time separated by a fixed lag, evaluated over different values of the lag. For these spike train data, let’s use the increments (i.e., the number of spikes in each time bin) as the signal, compute the ACF for each trial, and average the results over all the trials.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">acf1</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1999</span><span class="p">))</span>     <span class="c1">#Variable to hold ACF during planning,</span>
<span class="n">acf2</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1999</span><span class="p">))</span>     <span class="c1">#... and during movement.</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>          <span class="c1">#For each trial,</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">i_plan</span><span class="p">]</span>  <span class="c1">#... get planning data,</span>
    <span class="n">move</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">i_move</span><span class="p">]</span>  <span class="c1"># ... get movement data,</span>
    <span class="n">corr1</span> <span class="o">=</span> <span class="n">correlate</span><span class="p">(</span><span class="n">plan</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">plan</span><span class="p">),</span> <span class="n">plan</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">plan</span><span class="p">),</span> <span class="s1">&#39;full&#39;</span><span class="p">)</span> <span class="c1">#Compute ACF,</span>
    <span class="n">acf1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr1</span> <span class="o">/</span> <span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">plan</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">plan</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>             <span class="c1">#... and normalize,</span>
    <span class="n">corr2</span> <span class="o">=</span> <span class="n">correlate</span><span class="p">(</span><span class="n">move</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">move</span><span class="p">),</span> <span class="n">move</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">move</span><span class="p">),</span> <span class="s1">&#39;full&#39;</span><span class="p">)</span> <span class="c1">#... for both conditions.</span>
    <span class="n">acf2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr2</span> <span class="o">/</span> <span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">move</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">move</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> 
    
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>                 <span class="c1">#Show the ACFs</span>
<span class="n">stem</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">acf1</span><span class="p">[:,</span><span class="mi">1000</span><span class="p">:</span><span class="mi">1100</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">use_line_collection</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag [ms]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Autocorrelation&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Planning&#39;</span><span class="p">)</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">stem</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">acf2</span><span class="p">[:,</span><span class="mi">1000</span><span class="p">:</span><span class="mi">1100</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">use_line_collection</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag [ms]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Autocorrelation&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Movement&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_45_0.png" src="_images/10_45_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q:</strong> Why do we examine the variables <code class="docutils literal notranslate"><span class="pre">acf1</span></code> and <code class="docutils literal notranslate"><span class="pre">acf2</span></code> at columns <code class="docutils literal notranslate"><span class="pre">1000:1100</span></code>?</p>
<p><strong>A:</strong> The columns of both matrices specify the lags, which extend from -1 s to +1 s. We choose indices <code class="docutils literal notranslate"><span class="pre">1000:1100</span></code> to investigate positive lags beginning at 1 ms and ending at 100 ms. Notice that we compute the mean of both matrices across trials (rows) before displaying the results.</p>
</div><p>The autocorrelation plots for both the planning and movement periods show very clear structure. In both periods we see negative correlation for lags of 1–3 ms, followed by positive correlation at lags of 1–8 ms, with a peak at a lag of 6 ms. During the planning period, we see clear structure continuing at higher lags, with an extended period of negative correlations at lags of about 15–35 ms and positive correlations at lags of about 50–70 ms. For the movement period, this structure at lags longer than about 10 ms seems reduced or even absent. These results suggest a change in the rhythmic firing properties between the planning and movement periods. The second peak in the autocorrelation plot for the planning period around 60 ms suggests a 1/60 ms $\approx$17 Hz rhythm that disappears during movement.</p>
<p><a class="reference external" href="#top">Back to top</a></p>
</div>
</div>
<div class="section" id="spectral-analysis-of-spiking-data-a-id-spectral-analysis-a">
<h2>Spectral Analysis of Spiking Data <a id="spectral-analysis"></a><a class="headerlink" href="#spectral-analysis-of-spiking-data-a-id-spectral-analysis-a" title="Permalink to this headline">¶</a></h2>
<p>So far, we have focused on statistical characterizations of spike trains in the time domain. Another approach to visualizing and describing structure in point processes focuses on estimating rhythmic (or harmonic) features of the data in the frequency domain. In <a href="03" rel="local">notebooks 3</a> and <a href="04" rel="local">4</a>, we discussed methods to decompose field data (or continuous valued functions and random processes) into harmonic components. The same type of approach can be used to decompose point processes and to determine the relative contributions to their variability attributable to each frequency. Point process spectral estimation provides a useful tool for spike train analysis but should be performed with care. On the one hand, computing spectral estimates for discrete spike train data is similar to the approaches used for continuous valued signals. On the other hand, the interpretation of point process spectra can differ from continuous process spectra, and blindly applying intuition from continuous spectral estimation to point process data can lead to incorrect interpretations.</p>
<div class="section" id="point-process-spectral-theory">
<h3>Point Process Spectral Theory<a class="headerlink" href="#point-process-spectral-theory" title="Permalink to this headline">¶</a></h3>
<p>In this section, we develop some of the theory needed to understand and interpret spectral estimators for spiking data. As with the spectrum for continuous valued processes (<a href="03" rel="local">notebook 3</a>), the spectrum for a point process can be expressed as the Fourier transform of its autocovariance function. In discrete time, assume we have binned the spiking activity into intervals of length <span class="math notranslate nohighlight">\(\Delta t\)</span>, and that <span class="math notranslate nohighlight">\(\Delta N_i\)</span> represents the number of spikes fired in the <span class="math notranslate nohighlight">\(i^{th}\)</span> interval, which is called the <span class="math notranslate nohighlight">\(i^{th}\)</span> increment. The autocovariance sequence is then</p>
<p>\begin{align}
\gamma(h) &amp;=E[(\Delta N_i - \lambda_0\Delta t)( \Delta N_{i+h} - \lambda_0\Delta t)]\
&amp;=E[\Delta N_i \Delta N_{i + h}] - (\lambda_0 \Delta t)^2
\end{align}</p>
<p>where  <span class="math notranslate nohighlight">\(\lambda_0 \Delta t\)</span> is the expected number of spikes in a single time bin. The discrete spectrum is the discrete Fourier transform of this sequence. Using this definition, we can compute the theoretical autocovariance and spectrum for any stationary point process model.</p>
<p><strong>Example 1: Spectral density of a homogeneous Poisson process.</strong></p>
<p>For a homogeneous Poisson process, the increments <span class="math notranslate nohighlight">\(\Delta N_i\)</span> are independent, and each has a Poisson distribution with the same mean. Assume the mean number of spikes in any bin is  <span class="math notranslate nohighlight">\(\lambda_0 \Delta t\)</span>. Since the mean and variance of a Poisson random variable are the same (see <a href="08" rel="local">notebook 8</a>), this is also the variance of any increment. The autocovariance at lag <span class="math notranslate nohighlight">\(h = 0\)</span> is just the variance of <span class="math notranslate nohighlight">\(\Delta N_i\)</span>, which is  <span class="math notranslate nohighlight">\(\lambda_0 \Delta t\)</span>. At any other lag, the increments are independent and therefore the autocovariance is zero. The autocovariance function is therefore given by</p>
<p title="homogeneous">
$$
  \gamma(h) = \begin{cases}
  \lambda_0 \Delta t & \text{if }h = 0,\\
  0 & \text{otherwise}.\\
  \end{cases}
$$
</p>
<p>The spectral density of this homogeneous Poisson process is the Fourier transform of this autocovariance sequence in the limit as <span class="math notranslate nohighlight">\(\Delta t \to 0\)</span>, which is</p>
<div class="math notranslate nohighlight">
\[
  F(\omega)=\lambda _ 0.
\]</div>
<p>The Fourier transform <span class="math notranslate nohighlight">\(F(\omega)\)</span> does not vary as a function of <span class="math notranslate nohighlight">\(\omega\)</span>, that is, the spectral density is flat. This suggests that constant power is required at all frequencies to describe a homogeneous Poisson process. This is the point process analogue of white noise.</p>
<p><strong>Example 2: Spectral density of a refractory point process.</strong></p>
<p>Assume now that we modify the spiking process to include a relative refractory period. We do this by adding a negative autocorrelation at small lags that diminishes in magnitude as the lag increases. Thus, a spike 1 ms in the past would substantially decrease the probability of observing another spike in the current time interval, but a spike many milliseconds in the past would have little to no effect on the current spike probability. Mathematically, we assume that the autocovariance function has the form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
  \gamma(h) = \begin{cases}
  \lambda_0 \Delta t  - \alpha f_{\sigma}(h) &amp; \text{if }h = 0,\\
  -\alpha f_{\sigma}(h) &amp; \text{otherwise},\\
  \end{cases}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> is a constant representing the degree of refractoriness, and <span class="math notranslate nohighlight">\(f_{\sigma}(h)\)</span> is the Gaussian function (or equivalently, the normal probability density function) with a mean of zero, and a standard deviation of <span class="math notranslate nohighlight">\(\sigma\)</span>. Let’s define some functions so that we can look at some examples of how different values of <span class="math notranslate nohighlight">\({\sigma}\)</span> affect <span class="math notranslate nohighlight">\(\gamma(h)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define f_sigma(h) as a gaussian with default mean (mu=0) and standard deviation (sig=1)</span>
<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sig</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

<span class="c1"># Define some default parameter values for the autocovariance function</span>
<span class="n">lbda0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="o">.</span><span class="mi">01</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-3</span>

<span class="c1"># Define the ACF gamma, again with some default values for the parameters</span>
<span class="k">def</span> <span class="nf">gamma</span><span class="p">(</span><span class="n">lag</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">lbda0</span><span class="o">=</span><span class="n">lbda0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lag</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lbda0</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">lag</span><span class="p">,</span> <span class="n">sig</span><span class="o">=</span><span class="n">sig</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">lag</span><span class="p">,</span> <span class="n">sig</span><span class="o">=</span><span class="n">sig</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<p>Now that we have the functions, try plugging in different values of <code class="docutils literal notranslate"><span class="pre">sig</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sig</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Change the value here to see how the autocovariance changes</span>
<span class="n">autocov</span> <span class="o">=</span> <span class="p">[</span><span class="n">gamma</span><span class="p">(</span><span class="n">lag</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span> <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">)]</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">stem</span><span class="p">(</span><span class="n">autocov</span><span class="p">,</span><span class="n">use_line_collection</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag (ms)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Autocovariance&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;σ = </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sig</span><span class="p">))</span>
<span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5e-4</span><span class="p">,</span> <span class="mf">1.5e-4</span><span class="p">])</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_51_0.png" src="_images/10_51_0.png" />
</div>
</div>
<p>The reason we chose the Gaussian function is that it captures a smooth decay of the refractory effect and its Fourier transform is easy to compute. The spectral density <span class="math notranslate nohighlight">\(F(\omega)\)</span> of this refractory point process is
<span class="math notranslate nohighlight">\($
  F(\omega)  = \lambda_0 - \alpha \sqrt{2\pi\sigma} \cdot f_{1/\sigma} (\omega).
$\)</span></p>
<p>This spectral density does depend on <span class="math notranslate nohighlight">\(\omega\)</span>; as <span class="math notranslate nohighlight">\(\omega\)</span> becomes large, <span class="math notranslate nohighlight">\(f_{1/\sigma}(\omega)\)</span> goes to zero and the spectrum approaches the constant level of a Poisson process; however, as <span class="math notranslate nohighlight">\(\omega\)</span> becomes small, the spectrum decreases below this level. Therefore, the effect of the refractory period on the spectrum is a dip at low frequencies. Adjust the value of <code class="docutils literal notranslate"><span class="pre">sig</span></code> in the following code block to verify this for different values of <span class="math notranslate nohighlight">\(\sigma\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sig</span> <span class="o">=</span> <span class="mi">20</span>                         <span class="c1">#Set the width of the refractory period,</span>
<span class="n">spectral_density</span> <span class="o">=</span> <span class="p">(</span><span class="n">lbda0</span> <span class="o">-</span>     <span class="c1">#... and compute the spectral density.</span>
                    <span class="n">alpha</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">sig</span><span class="p">)</span> <span class="o">*</span> 
                    <span class="n">gaussian</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dt</span><span class="p">),</span> <span class="n">sig</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">sig</span><span class="p">))</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">spectral_density</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>  <span class="c1">#Plot the spectral density in Hz,</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>         <span class="c1">#... with axes labeled.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spectral Density (Hz)&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_54_0.png" src="_images/10_54_0.png" />
</div>
</div>
<p>You should observe that the extent of this decrease in power in the frequency domain is inversely proportional to the extent of the refractory period in the time domain. When <span class="math notranslate nohighlight">\(\sigma= 2\)</span> ms, the dip in the spectrum is small but extends all the way out beyond 500 Hz. If you evaluate <span class="math notranslate nohighlight">\(\sigma= 20\)</span> ms, for example, the dip in the spectrum is larger but only extends out to about 100 Hz.</p>
<p>It may seem strange that considerable power remains at high frequencies even though the refractory period decreases the probability that the spike train fires at frequencies higher than <span class="math notranslate nohighlight">\(1/\sigma\)</span> . The explanation for this apparent incongruity is that the high-frequency power is not only related to the probability of firing at high frequencies but is also necessary to generate the impulse profile of each spike event. As frequency becomes large, the power spectral density of any point process will asymptote to <span class="math notranslate nohighlight">\(\lambda_0\)</span>, the expected spike rate, not to zero.</p>
<p>This example illustrates a counterintuitive result. To understand the mean firing rate of a spiking process, we look to the high end of the spectrum, and to understand whether refractoriness prevents high-frequency spiking, we look to the low end of the spectrum. This is one reason it is important to be careful when interpreting spectral estimators for point processes.</p>
</div>
<div class="section" id="spectral-estimates-for-the-stn-data">
<h3>Spectral Estimates for the STN Data<a class="headerlink" href="#spectral-estimates-for-the-stn-data" title="Permalink to this headline">¶</a></h3>
<p>With a new appreciation for interpreting point process spectra, let’s compute spectral estimators for the STN data for the planning and movement periods. As in notebooks <a href="04" rel="local">4<a href="05" rel="local">/a&gt; and [5</a>, we use multitaper spectral estimators. Since the data follow a trial structure, we compute estimators for each trial and average the results across trials. The planning and movement periods for each trial are 1 s in duration, so we can achieve a 4 Hz frequency resolution by setting the time-bandwidth product to 4. This allows us to use seven tapers, each providing independent and informative estimates.</p>
<div class="python-note">
<p>Here we compute the spectrum by hand. The main reason for this is that we are working with point process data and most packages assume that a signal is continuous. Below, we define a function, <code class="docutils literal notranslate"><span class="pre">mt_spec</span></code> to calculate spectrum. The line marked with a pair of asterisks (**) is where the computation of the spectrum of point process data differs from that of continuous data. In this case, because the mean firing rate is so low, the difference is trivial. Using the <code class="docutils literal notranslate"><span class="pre">multi_taper_psd()</span></code> function from the <a href="http://nipy.org/nitime/documentation.html" rel="external">Nitime</a> package produces nearly the same result, though it must be rescaled to see this. Try the following to compare results from the packaged function to those from the function we define below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>from nitime.algorithms import multi_taper_psd
f, SPlanP, var = multi_taper_psd(train[:, i_plan] * Fs, Fs=1000, NW=4)
SPlan *= Fs ** 2 / 2
</pre></div>
</div>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mt_specpb</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Fs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">NW</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">trial_ave</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="n">tapers</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dpss_windows</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">NW</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">NW</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Compute the tapers,</span>
    <span class="n">tapers</span> <span class="o">*=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">Fs</span><span class="p">)</span>                                   <span class="c1"># ... and scale them.</span>
    
    <span class="n">dataT</span> <span class="o">=</span> <span class="p">[[</span><span class="n">trial</span> <span class="o">*</span> <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tapers</span><span class="p">]</span>                 <span class="c1"># Multiply the data by the tapers,</span>
             <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>                          <span class="c1"># ... for each trial in the data.</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">tapers</span><span class="p">)</span>                                 <span class="c1"># Compute the fft of the tapers.</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">dataT</span><span class="p">)</span>                                  <span class="c1"># Compute the fft of the tapered data.</span>
    <span class="c1"># Recall that rfft assumes the data are real, and thus </span>
    <span class="n">J</span> <span class="o">-=</span> <span class="p">[</span><span class="n">T</span> <span class="o">*</span> <span class="n">trial</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>            <span class="c1"># Subtract the dc (**)</span>
    <span class="n">J</span> <span class="o">*=</span> <span class="n">J</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>                                        <span class="c1"># Compute the spectrum</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">J</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">rfftfreq</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trial_ave</span> <span class="p">:</span> <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                         <span class="c1"># Average across trials.</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">S</span>


<span class="n">f</span><span class="p">,</span> <span class="n">SPlan</span> <span class="o">=</span> <span class="n">mt_specpb</span><span class="p">(</span><span class="n">train</span><span class="p">[:,</span> <span class="n">i_plan</span><span class="p">])</span>  <span class="c1"># Compute the spectrum of the planning period</span>
<span class="n">_</span><span class="p">,</span> <span class="n">SMove</span> <span class="o">=</span> <span class="n">mt_specpb</span><span class="p">(</span><span class="n">train</span><span class="p">[:,</span> <span class="n">i_move</span><span class="p">])</span>  <span class="c1"># ... and the movement period</span>

<span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">SPlan</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Planning&quot;</span><span class="p">)</span>        <span class="c1"># Plot the planning period,</span>
<span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">SMove</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Movement&quot;</span><span class="p">)</span>        <span class="c1"># ... and the movement period</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Freq (Hz)&#39;</span><span class="p">)</span>                     <span class="c1"># ... with axes labeled</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Power (Hz)&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Trial-averaged spectra of spiking data&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_58_0.png" src="_images/10_58_0.png" />
</div>
</div>
<p>A number of distinct features are evident in these spectral estimates for the planning and movement periods. At higher frequencies, the spectral density for the planning period asymptotes to about 35 Hz, while for the movement period it asymptotes closer to 55 Hz. This corroborates our previous results based on the observed mean firing rates. Both spectral estimates show a decrease at frequencies below 200 Hz, suggesting an approximately 5 ms refractory period. However, in the planning period, we see a large peak at about 18 Hz that does not appear during the movement period. This suggests that the STN neuron spikes rhythmically during the planning period and that this rhythm is attenuated during movement.</p>
<p>Here we have separated each trial into planning and movement periods and computed separate spectral estimates for each period. This assumes that the data are stationary—that the mean and autocovariance structure do not change in time—during the planning period, that there is a sudden change between the planning and movement period, and that the data are stationary again during the movement period. Is this a reasonable assumption? One way to explore this is to compute a spectrogram, as we did in <a href="03" rel="local">notebook 3</a>. Let’s use a moving window of 500 ms duration and a step size of 50 ms.</p>
<div class="question">
<p><strong>Q.</strong> Since the duration of the moving window is 500 ms, if we want to maintain a frequency resolution of 4 Hz, what is the time-bandwidth product and number of tapers?</p>
<p><strong>A.</strong> The time-bandwidth product is 0.5 s × 4 Hz = 2. In this case, we therefore have three tapers that provide informative, independent estimates of the spectrum.</p>
</div><p>We also focus on the frequency range from 0 to 50 Hz, which includes the large peak near 18 Hz that we previously observed during the planning period.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">window</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">05</span>  <span class="c1"># Define the duration and step size for the spectrogram in seconds.</span>
<span class="n">fpass</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>         <span class="c1"># Define the frequency band of interest,</span>
<span class="n">Fs</span> <span class="o">=</span> <span class="mi">1000</span>               <span class="c1"># ... and sampling rate.</span>

<span class="n">window</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Fs</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">window</span><span class="p">,</span> <span class="n">step</span><span class="p">]]</span>  <span class="c1"># Convert step and window to samples.</span>
<span class="n">starts</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">window</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>     <span class="c1"># Determine where spectrogram windows should start.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">mt_specpb</span><span class="p">(</span><span class="n">train</span><span class="p">[:,</span> <span class="nb">range</span><span class="p">(</span><span class="n">window</span><span class="p">)],</span> <span class="n">NW</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>       <span class="c1"># Get the frequencies,</span>
<span class="n">findx</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">&gt;=</span> <span class="n">fpass</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f</span> <span class="o">&lt;=</span> <span class="n">fpass</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>             <span class="c1"># ... create a mask of frequencies of interest,</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">findx</span><span class="p">]</span>                                          <span class="c1"># ... and select these frequencies of interest.</span>
<span class="n">spectrogram</span> <span class="o">=</span> <span class="p">[</span><span class="n">mt_specpb</span><span class="p">(</span><span class="n">train</span><span class="p">[:,</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">window</span><span class="p">)],</span> <span class="n">NW</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="n">findx</span><span class="p">]</span>  <span class="c1"># Compute the spectrum on each 500 ms window.</span>
               <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">starts</span><span class="p">]</span>                       <span class="c1"># ... starting every 50 ms</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">starts</span><span class="p">]</span> <span class="o">+</span> <span class="n">window</span> <span class="o">/</span> <span class="mi">2</span>                            <span class="c1"># Centers of spectrogram windows.</span>
<span class="n">contourf</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">array</span><span class="p">(</span><span class="n">spectrogram</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>                  <span class="c1"># Plot the result,</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [ms]&#39;</span><span class="p">)</span>                                   <span class="c1"># ... with axes labeled.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Trial averaged spectrogram of spiking data across</span><span class="se">\n</span><span class="s1"> planning and movement periods&#39;</span><span class="p">)</span>
<span class="n">colorbar</span><span class="p">()</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_62_0.png" src="_images/10_62_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q.</strong> What features do you observe in the spectrogram of the spike train data? How do these features change between the planning and movement periods?</p>
<p><strong>A.</strong> The period before time 0 s, corresponding to the planning period, shows a clear peak at 15–20 Hz. As we approach time 0 s, there is a rapid change in the spectral structure. The peak starts to vanish, not only because the spectral density at 15–20 Hz decreases but also because the spectral density across all frequencies increases. This reflects a combination of a change in rhythmic spiking and a change in the overall firing rate. The fact that the spectral content seems to undergo a sudden shift from one regime (planning) to another regime (movement) suggests that it is reasonable to construct models with different spike dynamics in these two periods.</p>
</div><div class="python-note">
<p>To make the figure above we used the <code class="docutils literal notranslate"><span class="pre">contour()</span></code> function. This function breaks the data into bins and then does some spatial interpolation so that it appears less pixelated. Try using <code class="docutils literal notranslate"><span class="pre">pcolormesh()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">contour()</span></code>. Note: we could have used <code class="docutils literal notranslate"><span class="pre">imshow()</span></code> like we did to make the <a class="reference external" href="#fig:raster">raster plots</a><span class="sup">fig<img src="imgs/raster.png"></span>, but labeling the axes with <code class="docutils literal notranslate"><span class="pre">contour()</span></code> and <code class="docutils literal notranslate"><span class="pre">pcolormesh()</span></code> is more straightforward.</p>
</div><p><a class="reference external" href="#top">Back to top</a></p>
<p><a id="ppm"></a></p>
</div>
</div>
<div class="section" id="point-process-models">
<h2>Point Process Models<a class="headerlink" href="#point-process-models" title="Permalink to this headline">¶</a></h2>
<p>So far we have focused on descriptive statistics and visualization methods to characterize the properties of the spike train data. In <a href="09" rel="local">notebook 9</a>, we developed point process models to understand the factors influencing a spiking process. We can use the same types of models to describe how past spiking activity influences future activity to produce rhythmic spiking and other forms of history dependence. In doing so, we utilize all the tools that we previously developed for point process modeling: tools to fit parameters and construct confidence bounds, tools to measure the goodness-of-fit between the model and the data, and tools for testing whether individual model components or combinations of components provide significant improvements in fitting the data.</p>
<p>In this case study, we continue to use a specific class of models, <strong>generalized linear models</strong> (GLMs) for point processes. As discussed in <a href="09" rel="local">notebook 9</a>, GLMs have a number of attractive properties, including the fact that we can guarantee that the likelihood of the data as a function of the model parameters is convex and therefore has one peak that is easy to find. As in <a href="09" rel="local">notebook 9</a>, we will use the <code class="docutils literal notranslate"><span class="pre">Statsmodels</span></code> <a href="https://www.statsmodels.org/stable/index.html" rel="external">package</a> to fit our GLM parameters. Let’s revisit how to do this.</p>
<p>The first input to <code class="docutils literal notranslate"><span class="pre">sm.GLM</span></code> is the response vector—the spike train—which is an <span class="math notranslate nohighlight">\(n \times 1\)</span> vector. We have to reshape the spike train to be one long vector containing all the trials sequentially, and also construct the design matrix accordingly. The second input to this function is the design matrix or predictors. This is an <span class="math notranslate nohighlight">\(n \times p\)</span> matrix, where <span class="math notranslate nohighlight">\(n\)</span> is the total number of time steps in the dataset, and <span class="math notranslate nohighlight">\(p\)</span> is the number of predictors in the model. For these data, we have 50 trials, each comprising 2,000 time steps, so <span class="math notranslate nohighlight">\(n = 50 \times 2000 = 100,000\)</span> data points. The third input is the GLM distribution to use. Here we assume that the spike count in each bin is approximately Poisson, as we did in <a href="09" rel="local">notebook 9</a>. Recall that by selecting the Poisson GLM, we implicitly use a log link function. In other words, we set the log of the firing rate to be a linear function of the predictors and model parameters. Equivalently, we construct a model of the form <span class="math notranslate nohighlight">\(\lambda(t) = e^{\beta X(t)}\)</span>, where <span class="math notranslate nohighlight">\(\lambda(t)\)</span> is the spiking intensity at time <span class="math notranslate nohighlight">\(t\)</span>, <span class="math notranslate nohighlight">\(X(t)\)</span> is a <span class="math notranslate nohighlight">\(p \times 1\)</span> column vector of the predictors at time <span class="math notranslate nohighlight">\(t\)</span>, and <span class="math notranslate nohighlight">\(\beta\)</span> is a <span class="math notranslate nohighlight">\(1 \times p\)</span> column vector of the model parameters. Since each bin contains either 0 or 1 spike, we could also use the binomial distribution with a maximum of one count in each bin. However, choosing the Poisson count distribution will make it easier to interpret the resulting models.</p>
<p>In this notebook, we will change this approach slightly to demonstrate the use of <em>Dataframes</em> and <em>formulae</em>. A <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="external">Dataframe</a> is an object from the Pandas module that allows us to mimic the programming style used in <a href="https://www.r-project.org/" rel="external">[R]</a>. It stores data in a table under named columns and has some handy built-in functions that make it easy to use. Moreover, dataframes are often used in Pythonic data analyses, so you will likely see them again. A <em>formula</em> is a character string that describes the model. It will look something like <code class="docutils literal notranslate"><span class="pre">responses</span> <span class="pre">~</span> <span class="pre">predictors</span></code> (read “responses as a function of predictors”). Note that this is simply a different style of programming; the underlying mathematics is the same.</p>
<div class="math-note">
<p>One important note: Although we are approximating the number of spikes in each bin as Poisson, this does not mean we are modeling the data as a Poisson process. A Poisson process is one that has Poisson spike counts in each interval but also requires that the counts in two separate intervals be independent. Here, we explicitly model the spike count in one bin as a function of the number of spikes fired in previous bins. Therefore, the spike counts will not be independent between bins.</p>
</div><div class="section" id="model-1">
<h3>Model 1<a class="headerlink" href="#model-1" title="Permalink to this headline">¶</a></h3>
<p>Let’s build a model to compare the firing rate between the planning and movement periods; subsequent models will also include the effects of history dependence. In this model, the design matrix consists of one column that is zero whenever <span class="math notranslate nohighlight">\(t &lt; 0\)</span>, corresponding to the planning period, and that is 1 whenever <span class="math notranslate nohighlight">\(t \geq 0\)</span>, corresponding to the movement period. The resulting model has the form<a id="model:1"></a></p>
<p><a id="eq:3"></a>
<span class="math notranslate nohighlight">\($
  \lambda(t) = e^{\beta_0 + \beta_1 I_\text{move}(t)},
  \tag{Model 1}
$\)</span></p>
<p>where <span class="math notranslate nohighlight">\(I_\text{move}(t)\)</span> is the movement period indicator function. We must also remember to reshape the spike train matrix into a single response vector.
<a id="repeatvtile"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nTrial</span><span class="p">,</span> <span class="n">nTime</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span>    <span class="c1"># Number of trials and number of time points.</span>
<span class="n">IMove</span> <span class="o">=</span> <span class="n">tile</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nTrial</span><span class="p">)</span>   <span class="c1"># Define movement period.</span>
<span class="n">spikes</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>       <span class="c1"># Reshape the trials into a single vector</span>
<span class="n">glmdata</span> <span class="o">=</span> <span class="n">df</span><span class="p">({</span><span class="s1">&#39;IMove&#39;</span><span class="p">:</span> <span class="n">IMove</span><span class="p">,</span> <span class="s1">&#39;spikes&#39;</span><span class="p">:</span> <span class="n">spikes</span><span class="p">})</span>  <span class="c1"># Create a dataframe with the data to fit</span>
<span class="n">M1</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span><span class="s1">&#39;spikes ~ IMove&#39;</span><span class="p">,</span> <span class="c1"># Write a formula to fit spikes as a function of IMove,</span>
             <span class="n">data</span><span class="o">=</span><span class="n">glmdata</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">()</span>  <span class="c1"># ... supply the data,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>            <span class="c1"># ... and fit the model.</span>
<span class="n">M1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>                   <span class="c1"># Show results of the fit.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>spikes</td>      <th>  No. Observations:  </th>  <td>100000</td> 
</tr>
<tr>
  <th>Model:</th>                  <td>GLM</td>       <th>  Df Residuals:      </th>  <td> 99998</td> 
</tr>
<tr>
  <th>Model Family:</th>         <td>Poisson</td>     <th>  Df Model:          </th>  <td>     1</td> 
</tr>
<tr>
  <th>Link Function:</th>          <td>log</td>       <th>  Scale:             </th> <td>  1.0000</td>
</tr>
<tr>
  <th>Method:</th>                <td>IRLS</td>       <th>  Log-Likelihood:    </th> <td> -18990.</td>
</tr>
<tr>
  <th>Date:</th>            <td>Sat, 13 Jun 2020</td> <th>  Deviance:          </th> <td>  28588.</td>
</tr>
<tr>
  <th>Time:</th>                <td>17:58:43</td>     <th>  Pearson chi2:      </th> <td>9.53e+04</td>
</tr>
<tr>
  <th>No. Iterations:</th>          <td>6</td>        <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>           <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>     <td>   -3.2452</td> <td>    0.023</td> <td> -143.232</td> <td> 0.000</td> <td>   -3.290</td> <td>   -3.201</td>
</tr>
<tr>
  <th>IMove[T.True]</th> <td>    0.3441</td> <td>    0.030</td> <td>   11.617</td> <td> 0.000</td> <td>    0.286</td> <td>    0.402</td>
</tr>
</table></div></div>
</div>
<p>The variable <code class="docutils literal notranslate"><span class="pre">M1</span></code> now contains all the information we will need about our model fit. This includes the fitted parameters (<code class="docutils literal notranslate"><span class="pre">M1.params</span></code>), model deviance (<code class="docutils literal notranslate"><span class="pre">M1.deviance</span></code>), and standard error (<code class="docutils literal notranslate"><span class="pre">M1.bse</span></code>), among <a href="http://www.statsmodels.org/dev/generated/statsmodels.genmod.generalized_linear_model.GLMResults.html#statsmodels.genmod.generalized_linear_model.GLMResults" rel="external">others</a>. Let’s examine the model parameters, remembering to exponentiate them to improve interpretability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="p">(</span><span class="n">M1</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept        0.038960
IMove[T.True]    1.410678
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The first parameter estimate indicates that the firing rate during the planning period is <code class="docutils literal notranslate"><span class="pre">exp(b1[0])=0.0390</span></code> spikes/ms or 39 spikes/s. The second parameter estimate indicates that during the movement period the firing rate is modulated by <code class="docutils literal notranslate"><span class="pre">exp(b1[1])=1.4107</span></code>; it increases by 41%.</p>
<div class="question">
<p><strong>Q.</strong> Is this 41% increase significant, or is it likely to occur by chance under this model?</p>
<p><strong>A.</strong> To answer this, let’s use the <code class="docutils literal notranslate"><span class="pre">conf_int()</span></code> method on the model result:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>exp(M1.conf_int(.05))
</pre></div>
</div>
<p>We find the 95% confidence interval [1.33, 1.50], which suggests that the firing rate during the movement period is between 33% and 50% higher than the planning period. The fact that this interval does not contain 1 suggests that this effect is significant at the 0.05 level. More directly, we can examine the p-value for this parameter (based on a Wald test) having a nonzero modulation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>M1.pvalues;     # p-value from Wald test.
</pre></div>
</div>
<p>We find p = 3.3864e-31 and are therefore quite certain that the difference in firing rate between the planning and movement periods is real.</p>
</div><div class="math-note">
<p>A common practice is to calculate the upper (lower) confidence bounds by adding (subtracting) twice the standard deviation. If you do this, you will notice that the bounds you get will not be identical to what you see when you use <code class="docutils literal notranslate"><span class="pre">M1.conf_int(.05)</span></code>. The reason is that in a normal distribution, there is actually slightly more than 95% of the data within two standard deviations of the mean—more like <a href="https://en.wikipedia.org/wiki/Normal_distribution#Cumulative_distribution_function" rel="external">95.45%</a>. This means that if you compute the confidence bounds using the two standard deviations rule of thumb, you will get a very slightly wider confidence interval.</p>
</div><p>In other case studies (see notebooks <a href="08" rel="local">8</a> and <a href="09" rel="local">9</a>), we explored a number of tools to assess goodness-of-fit of spiking models. Here, we examine just a few of these tools to investigate how well the initial simple model fits the spiking data. First, let’s construct a KS plot of the rescaled interspike intervals. We compute the estimated firing rate based on the model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">M1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">glmdata</span><span class="p">)</span>  <span class="c1"># Predict firing rate of Model 1</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we compute the rescaled intervals by integrating, or in this case summing, the estimated rate between spike times:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spikeindex</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">spikes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>                                    <span class="c1"># Find spikes.</span>
<span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">lambda1</span><span class="p">[</span><span class="n">a</span><span class="p">:</span><span class="n">b</span><span class="p">])</span>                                           <span class="c1"># Sum firing rate,</span>
     <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hstack</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">spikeindex</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span> <span class="n">spikeindex</span><span class="p">)]</span>  <span class="c1"># ... over each ISI.</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we compute the empirical CDF of the rescaled spike times (<code class="docutils literal notranslate"><span class="pre">Z</span></code>) and compare it to the model CDF, which is an exponential distribution with parameter 1 if the model is correct (see <a href="09" rel="local">notebook 9</a>):<a id="fig:ks1"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eCDF</span> <span class="o">=</span> <span class="n">ECDF</span><span class="p">(</span><span class="n">Z</span><span class="p">);</span>         <span class="c1"># Empirical CDF at Z values.</span>
<span class="n">mCDF</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">eCDF</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1"># Model CDF at Z values.</span>
<span class="n">nISI</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>           <span class="c1"># Total number of ISIs.</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">mCDF</span><span class="p">,</span> <span class="n">eCDF</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>       <span class="c1"># Create a KS plot</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.36</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">nISI</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># ... with confidence bounds</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.36</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">nISI</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Model CDF&#39;</span><span class="p">)</span>      <span class="c1"># With axes labeled.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Empirical CDF&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model 1 KS plot&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_80_0.png" src="_images/10_80_0.png" />
</div>
</div>
<p>The KS plot reveals that the initial model tends to fit the distribution of the larger rescaled ISIs well, but not the shorter ISIs. Therefore, we conclude that Model 1 does not completely capture the structure of the spiking data.</p>
<div class="question">
<p><strong>Q.</strong> What features of the spiking structure could be missing from this model?</p>
<p><strong>A.</strong> We have a few options from prior visualizations, including movement direction (left or right) as well as past spiking history. We may improve the model by incorporating either (or both) features.</p>
</div></div>
<div class="section" id="refining-the-model-movement-direction">
<h3>Refining the Model: Movement Direction<a class="headerlink" href="#refining-the-model-movement-direction" title="Permalink to this headline">¶</a></h3>
<p>With an eye toward improving the initial model, we first visualize the impact of movement direction on Model 1. We create a column vector for the design matrix that indicates the trial movement direction for each time step:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDir</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="n">direction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nTime</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="question">
<p><strong>Q.</strong> <a class="reference external" href="#repeatvtile">Above</a> we used the <code class="docutils literal notranslate"><span class="pre">tile()</span></code> function to replicate the vector <code class="docutils literal notranslate"><span class="pre">t</span></code> in order to fit Model 1. This time, we used the function <code class="docutils literal notranslate"><span class="pre">repeat()</span></code>. See if you can figure out what each function does and why we needed a different one this time.</p>
</div><p>We could add the variable <code class="docutils literal notranslate"><span class="pre">xdir</span></code> directly to the initial Model 1, and proceed immediately with a model fit. But first let’s examine the point process residuals for Model 1, and whether these residuals depend on the trial movement direction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">M1</span><span class="o">.</span><span class="n">resid_response</span><span class="p">);</span>              <span class="c1"># Cumulative sum of Model 1 residuals.</span>
<span class="n">plot</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="n">IDir</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">IDir</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Right&quot;</span><span class="p">)</span>  <span class="c1"># Plot right movement trials,</span>
<span class="n">plot</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="n">IDir</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">IDir</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Left&quot;</span><span class="p">)</span>   <span class="c1"># ... and left movement trials.</span>

<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trial&#39;</span><span class="p">)</span>                             <span class="c1"># Label axes.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Integrate Point Process Residual&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Point process residuals for Model 1&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_87_0.png" src="_images/10_87_0.png" />
</div>
</div>
<p>We find that the integrated residuals tend to increase for left trials, suggesting that Model 1 consistently underestimates the firing rate for these trials, and tend to decrease for right trials, suggesting that Model 1 overestimates the rate for those trials. Including trial direction may therefore help improve the model. Let’s now add the predictor <code class="docutils literal notranslate"><span class="pre">xdir</span></code> to the <a class="reference external" href="#model:1">initial model</a><span class="thumb"><sup>eq</sup><img src="imgs/model1.png"></span> to create the second model,<a id="model:2"></a></p>
<div class="math notranslate nohighlight">
\[
  \lambda(t) = \exp\big(\beta_0 + \beta_1 I_\text{move}(t) + \beta_2 I_\text{dir}(t)\big),
  \tag{Model 2}
\]</div>
<p>and fit the model in Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">glmdata</span><span class="p">[</span><span class="s1">&#39;IDir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IDir</span>                 <span class="c1"># Add direction information to the glm dataframe</span>
<span class="n">M2</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span><span class="s1">&#39;spikes ~ IMove + IDir&#39;</span><span class="p">,</span>  <span class="c1"># Model 2 formula</span>
             <span class="n">data</span><span class="o">=</span><span class="n">glmdata</span><span class="p">,</span>             <span class="c1"># ... supply the data,</span>
             <span class="n">family</span><span class="o">=</span><span class="n">Poisson</span><span class="p">())</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>   <span class="c1"># ... and fit the model.</span>
<span class="n">M2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>                           <span class="c1"># Show results of the fit.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>spikes</td>      <th>  No. Observations:  </th>  <td>100000</td> 
</tr>
<tr>
  <th>Model:</th>                  <td>GLM</td>       <th>  Df Residuals:      </th>  <td> 99997</td> 
</tr>
<tr>
  <th>Model Family:</th>         <td>Poisson</td>     <th>  Df Model:          </th>  <td>     2</td> 
</tr>
<tr>
  <th>Link Function:</th>          <td>log</td>       <th>  Scale:             </th> <td>  1.0000</td>
</tr>
<tr>
  <th>Method:</th>                <td>IRLS</td>       <th>  Log-Likelihood:    </th> <td> -18843.</td>
</tr>
<tr>
  <th>Date:</th>            <td>Sat, 13 Jun 2020</td> <th>  Deviance:          </th> <td>  28293.</td>
</tr>
<tr>
  <th>Time:</th>                <td>17:58:46</td>     <th>  Pearson chi2:      </th> <td>9.52e+04</td>
</tr>
<tr>
  <th>No. Iterations:</th>          <td>7</td>        <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>           <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>     <td>   -3.0228</td> <td>    0.025</td> <td> -119.359</td> <td> 0.000</td> <td>   -3.072</td> <td>   -2.973</td>
</tr>
<tr>
  <th>IMove[T.True]</th> <td>    0.3441</td> <td>    0.030</td> <td>   11.617</td> <td> 0.000</td> <td>    0.286</td> <td>    0.402</td>
</tr>
<tr>
  <th>IDir[T.True]</th>  <td>   -0.5090</td> <td>    0.030</td> <td>  -16.891</td> <td> 0.000</td> <td>   -0.568</td> <td>   -0.450</td>
</tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">M2</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>  <span class="c1"># Look at our new parameters</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept        0.048667
IMove[T.True]    1.410678
IDir[T.True]     0.601091
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>When adding the direction for each trial to the model, we find that the baseline firing rate parameter changes to <span class="math notranslate nohighlight">\(\exp(\beta_0) = 0.0487 = 48.7\)</span> spikes/s. The baseline condition now corresponds to the planning period only (<code class="docutils literal notranslate"><span class="pre">IMove=0</span></code>) of trials to the left (<code class="docutils literal notranslate"><span class="pre">IDir=0</span></code>). The modulation due to changing from planning to movement periods—<span class="math notranslate nohighlight">\(\exp(\beta_\text{move})=1.41\)</span>—stays about the same, suggesting a 41% increase in firing during the movement period. The final parameter relates to the modulation when changing from a left trial to a right trial. The modulation of <span class="math notranslate nohighlight">\(\exp(\beta_\text{direction})=0.6011\)</span> indicates that on right trials the firing rate is reduced by about 40%. Let’s check the significance of this last parameter (via a Wald test):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M2</span><span class="o">.</span><span class="n">pvalues</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept        0.000000e+00
IMove[T.True]    3.386554e-31
IDir[T.True]     5.281829e-64
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>We find <span class="math notranslate nohighlight">\(p_\text{direction} = 5.28\times 10^{-64}\)</span> and conclude that the decrease in firing rate is highly significant. Finally, let’s construct a KS plot for Model 2:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lambda2</span> <span class="o">=</span> <span class="n">M2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">glmdata</span><span class="p">)</span>          <span class="c1"># Predict firing rate of Model 2</span>
<span class="n">spikeindex</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">glmdata</span><span class="o">.</span><span class="n">spikes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Find the spikes.</span>
                                       <span class="c1"># Compute the rescaled waiting times.</span>
<span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">lambda2</span><span class="p">[</span><span class="n">a</span><span class="p">:</span><span class="n">b</span><span class="p">])</span>                 <span class="c1"># Sum firing rate,</span>
     <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hstack</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">spikeindex</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span> <span class="n">spikeindex</span><span class="p">)]</span>  <span class="c1"># ... over each ISI.</span>

<span class="n">eCDF</span> <span class="o">=</span> <span class="n">ECDF</span><span class="p">(</span><span class="n">Z</span><span class="p">);</span>                        <span class="c1"># Empirical CDF at Z values.</span>
<span class="n">mCDF</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">eCDF</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>                <span class="c1"># Model CDF at Z values.</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>                             <span class="c1"># Total number of ISIs.</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">mCDF</span><span class="p">,</span> <span class="n">eCDF</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>                     <span class="c1"># Create a KS plot</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.36</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># ... with confidence bounds,</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.36</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Model CDF&#39;</span><span class="p">)</span>                    <span class="c1"># ... and axes labeled.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Empirical CDF&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model 2 KS plot&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_94_0.png" src="_images/10_94_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q.</strong> Compare the KS plot for Model 2 to the <a class="reference external" href="#fig:ks1">KS plot for Model 1</a>. Does the updated model provide an improvement over the original model?</p>
<p><strong>A.</strong> This KS plot of Model 2 looks similar to that of Model 1. We observe some improvements at intermediate rescaled ISIs, but we are still seeing too few small rescaled ISIs. The updated model represents a slight improvement over the first model but is still well outside the confidence bounds of the KS plot.</p>
</div><div style="width:60%; margin: auto">
    <span style="width:50%; float: left"><img src="imgs/ks1.png"></span>
    <span style="width:50%; float: left"><img src="imgs/ks2.png"></span>
</div>
<div style="clear: both; display: table"></div><div class="question">
<p><strong>Q.</strong> What other covariates could we add to improve the model?</p>
<p><strong>A.</strong> The previous autocovariance and spectral analysis suggests that another feature of these data relates to history-dependent spiking. Perhaps we should add columns to the design matrix that depend on past values of the spiking activity.</p>
</div></div>
</div>
<div class="section" id="refining-the-model-history-dependence-a-id-history-dependence-a">
<h2>Refining the Model: History Dependence<a id="history-dependence"></a><a class="headerlink" href="#refining-the-model-history-dependence-a-id-history-dependence-a" title="Permalink to this headline">¶</a></h2>
<p>Up to this point, we have used Poisson regression models for the spiking data that did not incorporate any history-dependent terms. For those models, the number of spikes in each of the small discrete-time bins is assumed to have a Poisson distribution, and the number of spikes in any two nonoverlapping bins is assumed to be independent. A simple result from probability theory is that the sum of independent Poisson random variables also has a Poisson distribution. Therefore, for those previous models, the number of spikes over multiple time bins, which is the sum of the number of spikes in each bin, still has a Poisson distribution, and all those previous models would be considered Poisson process models.</p>
<p>Now, we would like to add predictors to the model related to the past history of spiking. Thus, we do not expect the number of spikes in nonoverlapping bins to be independent; a spike at the current time will change the probability of seeing a spike in the near future. Even if the number of spikes in a small time bin is assumed to be Poisson, it is no longer the case that the number of spikes in any larger interval will be Poisson. Thus, we would no longer call the resulting spike train a Poisson process. We still use the notation <span class="math notranslate nohighlight">\(\lambda(t)\)</span> to represent the expected number of spikes in the <span class="math notranslate nohighlight">\(t^{th}\)</span> time bin, but this is no longer called a Poisson rate function. Instead, we call it the <strong>conditional intensity function</strong> and write <span class="math notranslate nohighlight">\(\lambda(t|H_t)\)</span>, where <span class="math notranslate nohighlight">\(H_t\)</span> represents the past history of spiking.</p>
<p>There are many different functions of past spiking that we could use in the model. The simplest option is to use the binned spike train itself, lagged by different amounts of time. Mathematically, we are building a probability model for <span class="math notranslate nohighlight">\(\Delta N_i\)</span> as a function of <span class="math notranslate nohighlight">\(\Delta N_{i-j}\)</span> for <span class="math notranslate nohighlight">\(j = 1,\dots,k\)</span> for some model order <span class="math notranslate nohighlight">\(k\)</span>.</p>
<p>How should we select the model order? We return to this question later and propose principled approaches to create <em>parsimonious</em> models—models that fit the data well with as few parameters as possible. But we start by selecting a model order based on spectral analysis. We found a peak in the spectral density during the planning period at 15–20 Hz. A history-dependent model that extends to lags of 70 ms should be able to capture rhythms above 15 Hz. Let’s therefore define a variable <code class="docutils literal notranslate"><span class="pre">ordK</span></code> to represent the model order:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ordK</span> <span class="o">=</span> <span class="mi">70</span>  <span class="c1"># Define the model order</span>
</pre></div>
</div>
</div>
</div>
<p>To predict the spiking at the current time, we need to observe the spiking history up to <code class="docutils literal notranslate"><span class="pre">ordK</span></code> lags in the past. Therefore, we make a new dataframe, <code class="docutils literal notranslate"><span class="pre">glmHist</span></code>, including data from starting from index <code class="docutils literal notranslate"><span class="pre">ordK</span></code> (recall that Python uses 0-indexing, so index <span class="math notranslate nohighlight">\(n\)</span> is actually the <span class="math notranslate nohighlight">\([n+1]^{th}\)</span> element in the array). We then insert a new column with the spiking history for each lag.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordK</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># For each lag,</span>
                              <span class="c1"># ... scroll the spiking history forward.</span>
    <span class="n">glmdata</span><span class="p">[</span><span class="s1">&#39;lag</span><span class="si">{:02d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">roll</span><span class="p">(</span><span class="n">glmdata</span><span class="o">.</span><span class="n">spikes</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>  

<span class="c1"># Add a Time column to glmdata so we can filter by time</span>
<span class="n">glmdata</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">nTrial</span><span class="p">)</span>

<span class="c1"># Create a variable to reference only those times in glmdata that are &gt;= ordK</span>
<span class="n">glmHist</span> <span class="o">=</span> <span class="n">glmdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">[</span><span class="n">ordK</span><span class="p">]]</span>
<span class="c1"># Alternative:</span>
<span class="c1"># ... Uncomment the following to filter glmdata using .drop() instead of .loc</span>
<span class="c1"># glmHist = glmdata.drop(index=where(glmdata.Time &lt; t[ordK])[0])</span>

<span class="n">glmHist</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>IMove</th>
      <th>spikes</th>
      <th>IDir</th>
      <th>lag01</th>
      <th>lag02</th>
      <th>lag03</th>
      <th>lag04</th>
      <th>lag05</th>
      <th>lag06</th>
      <th>lag07</th>
      <th>...</th>
      <th>lag62</th>
      <th>lag63</th>
      <th>lag64</th>
      <th>lag65</th>
      <th>lag66</th>
      <th>lag67</th>
      <th>lag68</th>
      <th>lag69</th>
      <th>lag70</th>
      <th>Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>71</th>
      <td>False</td>
      <td>0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-929</td>
    </tr>
    <tr>
      <th>72</th>
      <td>False</td>
      <td>0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-928</td>
    </tr>
    <tr>
      <th>73</th>
      <td>False</td>
      <td>0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-927</td>
    </tr>
    <tr>
      <th>74</th>
      <td>False</td>
      <td>0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-926</td>
    </tr>
    <tr>
      <th>75</th>
      <td>False</td>
      <td>0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-925</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 74 columns</p>
</div></div></div>
</div>
<div class="python-note">
<p><strong>A note on copying variables in Python.</strong>
To create the variable <code class="docutils literal notranslate"><span class="pre">glmHist</span></code> in the code above, we filtered the dataframe (<code class="docutils literal notranslate"><span class="pre">glmdata</span></code>) using either <code class="docutils literal notranslate"><span class="pre">loc</span></code> or <code class="docutils literal notranslate"><span class="pre">drop()</span></code>. If you try to manipulate <code class="docutils literal notranslate"><span class="pre">glmHist</span></code> directly, you will get an error (although currently Python does some things behind the scenes to allow this). This is because when we created <code class="docutils literal notranslate"><span class="pre">glmHist</span></code>, we did not actually create a new object in the computer’s memory—we created a new reference to the already existing object. For a demonstration, try the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>breakfast = {&#39;ham&#39;: &#39;eggs&#39;}
lunch = breakfast
lunch[&#39;ham&#39;] = &#39;sandwich&#39;
print(breakfast)
</pre></div>
</div>
<p>You should find that <code class="docutils literal notranslate"><span class="pre">breakfast</span> <span class="pre">=</span> <span class="pre">{'ham':</span> <span class="pre">'sandwich'}</span></code>. Even though we did not change <code class="docutils literal notranslate"><span class="pre">breakfast</span></code> explicitly, the contents still changed. This is because certain objects in Python are <em>mutable</em>, which means they can be changed in memory.</p>
<p>In Python, when you assign a value to a variable, the value gets stored at a specific address in the machine’s memory, and the variable points to that address. If you assign one variable to another, e.g. <code class="docutils literal notranslate"><span class="pre">lunch</span> <span class="pre">=</span> <span class="pre">breakfast</span></code>, you are in fact giving <code class="docutils literal notranslate"><span class="pre">lunch</span></code> the address indicated by <code class="docutils literal notranslate"><span class="pre">breakfast</span></code>. Try this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(id(lunch))
print(id(breakfast))
</pre></div>
</div>
<p>You should see the same value printed twice. If <code class="docutils literal notranslate"><span class="pre">breakfast</span></code> is the address to an <em>immutable</em> object like an <strong>int</strong> or a <strong>string</strong>, then changing the value of <code class="docutils literal notranslate"><span class="pre">breakfast</span></code> (or any other variable pointing to that address) forces the variable to point to a new address—immutable objects cannot be changed (mutated) in memory.</p>
<p>On the other hand, if <code class="docutils literal notranslate"><span class="pre">breakfast</span></code> is the address to a <em>mutable</em> object like a <strong>dictionary</strong> or a <strong>list</strong>, then the value of the object will change in memory, and <code class="docutils literal notranslate"><span class="pre">breakfast</span></code> will continue to point to the same address. This is why in the example above, changing <code class="docutils literal notranslate"><span class="pre">lunch</span></code> also changes <code class="docutils literal notranslate"><span class="pre">breakfast</span></code>. Both variables point to the same address and changes to the dictionary object result in changes at that location in memory.</p>
<p>If this seems confusing, don’t worry. When you want to make a true copy in memory that you can safely manipulate, simply include the constructor function for the object type. In the <code class="docutils literal notranslate"><span class="pre">breakfast</span></code> example, use <code class="docutils literal notranslate"><span class="pre">lunch</span> <span class="pre">=</span> <span class="pre">dict(breakfast)</span></code> since <code class="docutils literal notranslate"><span class="pre">breakfast</span></code> is a dictionary. In our code above, we could have used <code class="docutils literal notranslate"><span class="pre">df()</span></code> (our imported abbreviation for <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame()</span></code>) to create a new dataframe.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>glmHist = df(glmdata.loc[lambda d: d[&#39;Time&#39;] &gt;= t[ordK]])
</pre></div>
</div>
<p>Other mutable datatypes include <strong>lists</strong> and <strong>arrays</strong> (<code class="docutils literal notranslate"><span class="pre">list()</span></code>, <code class="docutils literal notranslate"><span class="pre">array()</span></code>).</p>
<p>For a more thorough discussion of mutable and immutable objects see <a href="https://towardsdatascience.com/https-towardsdatascience-com-python-basics-mutable-vs-immutable-objects-829a0cb1530a" rel="external">here</a>.</p>
</div><div class="question">
<p><strong>Q.</strong> Consider the variable <code class="docutils literal notranslate"><span class="pre">glmHist</span></code>. Can you explain why we included only times greater than or equal to <code class="docutils literal notranslate"><span class="pre">t[ordK]</span></code>?</p>
</div><p>We can now include the history in the GLM as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;spikes ~&#39;</span> <span class="o">+</span>              <span class="c1"># Observed spikes as a function of ...</span>
           <span class="s1">&#39;+&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">glmHist</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;spikes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>  <span class="c1"># ... all other columns</span>
<span class="n">M3</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span>                <span class="c1"># Fit a glm using the formula,</span>
             <span class="n">data</span><span class="o">=</span><span class="n">glmHist</span><span class="p">,</span>           <span class="c1"># ... on the data with spiking history,</span>
             <span class="n">family</span><span class="o">=</span><span class="n">Poisson</span><span class="p">())</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> <span class="c1"># ... using a Poisson GLM.</span>
<span class="n">M3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>                         <span class="c1"># Summary of fit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>spikes</td>      <th>  No. Observations:  </th>  <td> 96450</td> 
</tr>
<tr>
  <th>Model:</th>                  <td>GLM</td>       <th>  Df Residuals:      </th>  <td> 96376</td> 
</tr>
<tr>
  <th>Model Family:</th>         <td>Poisson</td>     <th>  Df Model:          </th>  <td>    73</td> 
</tr>
<tr>
  <th>Link Function:</th>          <td>log</td>       <th>  Scale:             </th> <td>  1.0000</td>
</tr>
<tr>
  <th>Method:</th>                <td>IRLS</td>       <th>  Log-Likelihood:    </th> <td> -17967.</td>
</tr>
<tr>
  <th>Date:</th>            <td>Sat, 13 Jun 2020</td> <th>  Deviance:          </th> <td>  26792.</td>
</tr>
<tr>
  <th>Time:</th>                <td>17:58:52</td>     <th>  Pearson chi2:      </th> <td>9.16e+04</td>
</tr>
<tr>
  <th>No. Iterations:</th>          <td>7</td>        <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>           <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>     <td>   -3.0622</td> <td>    0.046</td> <td>  -66.090</td> <td> 0.000</td> <td>   -3.153</td> <td>   -2.971</td>
</tr>
<tr>
  <th>IMove[T.True]</th> <td>    0.3665</td> <td>    0.060</td> <td>    6.118</td> <td> 0.000</td> <td>    0.249</td> <td>    0.484</td>
</tr>
<tr>
  <th>IDir[T.True]</th>  <td>   -0.4989</td> <td>    0.034</td> <td>  -14.883</td> <td> 0.000</td> <td>   -0.565</td> <td>   -0.433</td>
</tr>
<tr>
  <th>lag01</th>         <td>   -1.5569</td> <td>    0.133</td> <td>  -11.664</td> <td> 0.000</td> <td>   -1.818</td> <td>   -1.295</td>
</tr>
<tr>
  <th>lag02</th>         <td>   -1.2337</td> <td>    0.115</td> <td>  -10.710</td> <td> 0.000</td> <td>   -1.459</td> <td>   -1.008</td>
</tr>
<tr>
  <th>lag03</th>         <td>   -0.4937</td> <td>    0.082</td> <td>   -5.993</td> <td> 0.000</td> <td>   -0.655</td> <td>   -0.332</td>
</tr>
<tr>
  <th>lag04</th>         <td>    0.0471</td> <td>    0.066</td> <td>    0.717</td> <td> 0.473</td> <td>   -0.082</td> <td>    0.176</td>
</tr>
<tr>
  <th>lag05</th>         <td>    0.3924</td> <td>    0.058</td> <td>    6.807</td> <td> 0.000</td> <td>    0.279</td> <td>    0.505</td>
</tr>
<tr>
  <th>lag06</th>         <td>    0.5639</td> <td>    0.055</td> <td>   10.324</td> <td> 0.000</td> <td>    0.457</td> <td>    0.671</td>
</tr>
<tr>
  <th>lag07</th>         <td>    0.4368</td> <td>    0.059</td> <td>    7.440</td> <td> 0.000</td> <td>    0.322</td> <td>    0.552</td>
</tr>
<tr>
  <th>lag08</th>         <td>    0.2545</td> <td>    0.064</td> <td>    3.998</td> <td> 0.000</td> <td>    0.130</td> <td>    0.379</td>
</tr>
<tr>
  <th>lag09</th>         <td>    0.0181</td> <td>    0.069</td> <td>    0.261</td> <td> 0.794</td> <td>   -0.118</td> <td>    0.154</td>
</tr>
<tr>
  <th>lag10</th>         <td>    0.0555</td> <td>    0.066</td> <td>    0.835</td> <td> 0.404</td> <td>   -0.075</td> <td>    0.186</td>
</tr>
<tr>
  <th>lag11</th>         <td>    0.0277</td> <td>    0.066</td> <td>    0.418</td> <td> 0.676</td> <td>   -0.102</td> <td>    0.157</td>
</tr>
<tr>
  <th>lag12</th>         <td>   -0.0009</td> <td>    0.067</td> <td>   -0.014</td> <td> 0.989</td> <td>   -0.132</td> <td>    0.130</td>
</tr>
<tr>
  <th>lag13</th>         <td>    0.0586</td> <td>    0.065</td> <td>    0.901</td> <td> 0.367</td> <td>   -0.069</td> <td>    0.186</td>
</tr>
<tr>
  <th>lag14</th>         <td>   -0.0416</td> <td>    0.069</td> <td>   -0.605</td> <td> 0.545</td> <td>   -0.176</td> <td>    0.093</td>
</tr>
<tr>
  <th>lag15</th>         <td>    0.0076</td> <td>    0.067</td> <td>    0.113</td> <td> 0.910</td> <td>   -0.124</td> <td>    0.139</td>
</tr>
<tr>
  <th>lag16</th>         <td>   -0.0748</td> <td>    0.070</td> <td>   -1.074</td> <td> 0.283</td> <td>   -0.211</td> <td>    0.062</td>
</tr>
<tr>
  <th>lag17</th>         <td>    0.0400</td> <td>    0.066</td> <td>    0.608</td> <td> 0.544</td> <td>   -0.089</td> <td>    0.169</td>
</tr>
<tr>
  <th>lag18</th>         <td>   -0.1212</td> <td>    0.071</td> <td>   -1.708</td> <td> 0.088</td> <td>   -0.260</td> <td>    0.018</td>
</tr>
<tr>
  <th>lag19</th>         <td>   -0.0658</td> <td>    0.069</td> <td>   -0.954</td> <td> 0.340</td> <td>   -0.201</td> <td>    0.069</td>
</tr>
<tr>
  <th>lag20</th>         <td>   -0.1430</td> <td>    0.072</td> <td>   -1.997</td> <td> 0.046</td> <td>   -0.283</td> <td>   -0.003</td>
</tr>
<tr>
  <th>lag21</th>         <td>   -0.1078</td> <td>    0.070</td> <td>   -1.533</td> <td> 0.125</td> <td>   -0.246</td> <td>    0.030</td>
</tr>
<tr>
  <th>lag22</th>         <td>    0.0056</td> <td>    0.067</td> <td>    0.084</td> <td> 0.933</td> <td>   -0.125</td> <td>    0.136</td>
</tr>
<tr>
  <th>lag23</th>         <td>   -0.0420</td> <td>    0.068</td> <td>   -0.614</td> <td> 0.539</td> <td>   -0.176</td> <td>    0.092</td>
</tr>
<tr>
  <th>lag24</th>         <td>   -0.1141</td> <td>    0.071</td> <td>   -1.598</td> <td> 0.110</td> <td>   -0.254</td> <td>    0.026</td>
</tr>
<tr>
  <th>lag25</th>         <td>   -0.0682</td> <td>    0.070</td> <td>   -0.977</td> <td> 0.329</td> <td>   -0.205</td> <td>    0.069</td>
</tr>
<tr>
  <th>lag26</th>         <td>   -0.1026</td> <td>    0.071</td> <td>   -1.444</td> <td> 0.149</td> <td>   -0.242</td> <td>    0.037</td>
</tr>
<tr>
  <th>lag27</th>         <td>   -0.0415</td> <td>    0.069</td> <td>   -0.602</td> <td> 0.547</td> <td>   -0.177</td> <td>    0.094</td>
</tr>
<tr>
  <th>lag28</th>         <td>    0.0555</td> <td>    0.066</td> <td>    0.843</td> <td> 0.399</td> <td>   -0.074</td> <td>    0.185</td>
</tr>
<tr>
  <th>lag29</th>         <td>    0.0178</td> <td>    0.067</td> <td>    0.265</td> <td> 0.791</td> <td>   -0.114</td> <td>    0.150</td>
</tr>
<tr>
  <th>lag30</th>         <td>   -0.0850</td> <td>    0.071</td> <td>   -1.200</td> <td> 0.230</td> <td>   -0.224</td> <td>    0.054</td>
</tr>
<tr>
  <th>lag31</th>         <td>   -0.0865</td> <td>    0.071</td> <td>   -1.222</td> <td> 0.222</td> <td>   -0.225</td> <td>    0.052</td>
</tr>
<tr>
  <th>lag32</th>         <td>   -0.0393</td> <td>    0.069</td> <td>   -0.571</td> <td> 0.568</td> <td>   -0.174</td> <td>    0.096</td>
</tr>
<tr>
  <th>lag33</th>         <td>   -0.0750</td> <td>    0.070</td> <td>   -1.076</td> <td> 0.282</td> <td>   -0.212</td> <td>    0.062</td>
</tr>
<tr>
  <th>lag34</th>         <td>   -0.1005</td> <td>    0.070</td> <td>   -1.428</td> <td> 0.153</td> <td>   -0.238</td> <td>    0.037</td>
</tr>
<tr>
  <th>lag35</th>         <td>    0.0101</td> <td>    0.067</td> <td>    0.151</td> <td> 0.880</td> <td>   -0.121</td> <td>    0.141</td>
</tr>
<tr>
  <th>lag36</th>         <td>    0.0059</td> <td>    0.068</td> <td>    0.087</td> <td> 0.931</td> <td>   -0.126</td> <td>    0.138</td>
</tr>
<tr>
  <th>lag37</th>         <td>   -0.1008</td> <td>    0.071</td> <td>   -1.412</td> <td> 0.158</td> <td>   -0.241</td> <td>    0.039</td>
</tr>
<tr>
  <th>lag38</th>         <td>   -0.0180</td> <td>    0.069</td> <td>   -0.262</td> <td> 0.793</td> <td>   -0.153</td> <td>    0.117</td>
</tr>
<tr>
  <th>lag39</th>         <td>    0.0577</td> <td>    0.066</td> <td>    0.871</td> <td> 0.384</td> <td>   -0.072</td> <td>    0.188</td>
</tr>
<tr>
  <th>lag40</th>         <td>    0.0462</td> <td>    0.067</td> <td>    0.693</td> <td> 0.488</td> <td>   -0.084</td> <td>    0.177</td>
</tr>
<tr>
  <th>lag41</th>         <td>    0.0702</td> <td>    0.066</td> <td>    1.066</td> <td> 0.287</td> <td>   -0.059</td> <td>    0.199</td>
</tr>
<tr>
  <th>lag42</th>         <td>    0.0440</td> <td>    0.067</td> <td>    0.660</td> <td> 0.509</td> <td>   -0.087</td> <td>    0.175</td>
</tr>
<tr>
  <th>lag43</th>         <td>   -0.0155</td> <td>    0.068</td> <td>   -0.226</td> <td> 0.821</td> <td>   -0.150</td> <td>    0.119</td>
</tr>
<tr>
  <th>lag44</th>         <td>   -0.1064</td> <td>    0.071</td> <td>   -1.499</td> <td> 0.134</td> <td>   -0.246</td> <td>    0.033</td>
</tr>
<tr>
  <th>lag45</th>         <td>    0.0533</td> <td>    0.066</td> <td>    0.810</td> <td> 0.418</td> <td>   -0.076</td> <td>    0.182</td>
</tr>
<tr>
  <th>lag46</th>         <td>   -0.0271</td> <td>    0.068</td> <td>   -0.396</td> <td> 0.692</td> <td>   -0.161</td> <td>    0.107</td>
</tr>
<tr>
  <th>lag47</th>         <td>    0.0167</td> <td>    0.067</td> <td>    0.247</td> <td> 0.805</td> <td>   -0.115</td> <td>    0.149</td>
</tr>
<tr>
  <th>lag48</th>         <td>    0.1526</td> <td>    0.063</td> <td>    2.405</td> <td> 0.016</td> <td>    0.028</td> <td>    0.277</td>
</tr>
<tr>
  <th>lag49</th>         <td>    0.0203</td> <td>    0.068</td> <td>    0.300</td> <td> 0.764</td> <td>   -0.113</td> <td>    0.153</td>
</tr>
<tr>
  <th>lag50</th>         <td>    0.1398</td> <td>    0.064</td> <td>    2.180</td> <td> 0.029</td> <td>    0.014</td> <td>    0.265</td>
</tr>
<tr>
  <th>lag51</th>         <td>    0.0822</td> <td>    0.066</td> <td>    1.249</td> <td> 0.212</td> <td>   -0.047</td> <td>    0.211</td>
</tr>
<tr>
  <th>lag52</th>         <td>   -0.0453</td> <td>    0.070</td> <td>   -0.652</td> <td> 0.515</td> <td>   -0.182</td> <td>    0.091</td>
</tr>
<tr>
  <th>lag53</th>         <td>   -0.0733</td> <td>    0.070</td> <td>   -1.048</td> <td> 0.295</td> <td>   -0.210</td> <td>    0.064</td>
</tr>
<tr>
  <th>lag54</th>         <td>    0.1250</td> <td>    0.064</td> <td>    1.966</td> <td> 0.049</td> <td>    0.000</td> <td>    0.250</td>
</tr>
<tr>
  <th>lag55</th>         <td>    0.0634</td> <td>    0.066</td> <td>    0.966</td> <td> 0.334</td> <td>   -0.065</td> <td>    0.192</td>
</tr>
<tr>
  <th>lag56</th>         <td>    0.0489</td> <td>    0.066</td> <td>    0.737</td> <td> 0.461</td> <td>   -0.081</td> <td>    0.179</td>
</tr>
<tr>
  <th>lag57</th>         <td>   -0.0054</td> <td>    0.068</td> <td>   -0.079</td> <td> 0.937</td> <td>   -0.139</td> <td>    0.128</td>
</tr>
<tr>
  <th>lag58</th>         <td>    0.0974</td> <td>    0.065</td> <td>    1.498</td> <td> 0.134</td> <td>   -0.030</td> <td>    0.225</td>
</tr>
<tr>
  <th>lag59</th>         <td>    0.0483</td> <td>    0.067</td> <td>    0.725</td> <td> 0.468</td> <td>   -0.082</td> <td>    0.179</td>
</tr>
<tr>
  <th>lag60</th>         <td>   -0.0424</td> <td>    0.069</td> <td>   -0.613</td> <td> 0.540</td> <td>   -0.178</td> <td>    0.093</td>
</tr>
<tr>
  <th>lag61</th>         <td>    0.1566</td> <td>    0.063</td> <td>    2.488</td> <td> 0.013</td> <td>    0.033</td> <td>    0.280</td>
</tr>
<tr>
  <th>lag62</th>         <td>   -0.0175</td> <td>    0.068</td> <td>   -0.256</td> <td> 0.798</td> <td>   -0.152</td> <td>    0.117</td>
</tr>
<tr>
  <th>lag63</th>         <td>    0.0871</td> <td>    0.065</td> <td>    1.332</td> <td> 0.183</td> <td>   -0.041</td> <td>    0.215</td>
</tr>
<tr>
  <th>lag64</th>         <td>    0.0121</td> <td>    0.068</td> <td>    0.178</td> <td> 0.858</td> <td>   -0.121</td> <td>    0.145</td>
</tr>
<tr>
  <th>lag65</th>         <td>    0.0829</td> <td>    0.066</td> <td>    1.260</td> <td> 0.208</td> <td>   -0.046</td> <td>    0.212</td>
</tr>
<tr>
  <th>lag66</th>         <td>    0.0553</td> <td>    0.067</td> <td>    0.829</td> <td> 0.407</td> <td>   -0.076</td> <td>    0.186</td>
</tr>
<tr>
  <th>lag67</th>         <td>    0.1514</td> <td>    0.064</td> <td>    2.377</td> <td> 0.017</td> <td>    0.027</td> <td>    0.276</td>
</tr>
<tr>
  <th>lag68</th>         <td>    0.0887</td> <td>    0.066</td> <td>    1.348</td> <td> 0.178</td> <td>   -0.040</td> <td>    0.218</td>
</tr>
<tr>
  <th>lag69</th>         <td>    0.0653</td> <td>    0.066</td> <td>    0.983</td> <td> 0.326</td> <td>   -0.065</td> <td>    0.196</td>
</tr>
<tr>
  <th>lag70</th>         <td>    0.0832</td> <td>    0.065</td> <td>    1.270</td> <td> 0.204</td> <td>   -0.045</td> <td>    0.212</td>
</tr>
<tr>
  <th>Time</th>          <td>-3.797e-05</td> <td> 5.27e-05</td> <td>   -0.720</td> <td> 0.471</td> <td>   -0.000</td> <td> 6.54e-05</td>
</tr>
</table></div></div>
</div>
<p>This model would have a total of 73 parameters—one intercept parameter, one movement parameter, one direction parameter, and 70 parameters representing the columns of the history matrix. Mathematically,</p>
<div class="math notranslate nohighlight">
\[
  \tag{Model 3}
  \lambda\big(t | H(t)\big) = 
  \exp\big(
      \beta_0 + 
      \beta_1 I_\text{move}(t) +
      \beta_2 I_\text{dir}(t) +
      \sum_{j=1}^{70} \beta_{2+j}\Delta N_{t-j}
  \big).
\]</div>
<p>However, Model 3 implies that the influences of the trial period (<span class="math notranslate nohighlight">\(I_{dir}(t)\)</span>) and of the past history (<span class="math notranslate nohighlight">\(\Delta N_{t-j}\)</span>) are multiplicatively separable; that is, that the only difference between the planning and movement period is a change in the average firing rate and the spike rhythms are the same in both periods. The autocovariance and spectral analyses suggest that the influence of past spiking differs between these trial periods. Therefore, we should instead construct a model that has an interaction between the <code class="docutils literal notranslate"><span class="pre">Imove</span></code> and <code class="docutils literal notranslate"><span class="pre">lag</span></code> variables. We do this by including columns that represent the product of these two variables. Mathematically, we propose a model of the form
<a id="eq:model4"></a></p>
<div class="math notranslate nohighlight">
\[\begin{split}
  \tag{Model 4}
  \begin{eqnarray}
  \lambda\big(t | H(t)\big) &amp;=&amp; 
  \exp\bigg(
      \beta_0 + 
      \beta_1 I_\text{move}(t) +
      \beta_2 I_\text{dir}(t) + \\ &amp;&amp; \qquad
      \sum_{j=1}^{70}
      \big[
      \big(\mathbb{1} - I_\text{move}(t)\big)\beta_{1 + 2j} + 
          I_\text{move}(t)\beta_{2 + 2j}
      \big]
  \bigg)
  \end{eqnarray}
\end{split}\]</div>
<p>Model 4 has 143 parameters—one intercept parameter, one parameter for each of the movement and direction indicator variables, 70 parameters describing the history dependence in the planning period, and 70 more parameters describing the history dependence in the movement period. Whenever we construct a point process model that includes history dependence, we call it a conditional intensity model rather than a rate model. To fit this model in Python, we will take advantage of the dataframe structure using the <code class="docutils literal notranslate"><span class="pre">filter()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a string with all lag columns joined by plus signs</span>
<span class="n">lagColumns</span> <span class="o">=</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">glmHist</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;lag&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Write a formula modeling the spikes as a function of IMove, IDir and the </span>
<span class="c1"># ... cross-terms (:) of IMove and the lag columns</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;spikes ~ IMove + IDir + IMove : (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lagColumns</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">M4</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">glmHist</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">Poisson</span><span class="p">())</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">M4</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>  <span class="c1"># Summarize the fit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>spikes</td>      <th>  No. Observations:  </th>  <td> 96450</td> 
</tr>
<tr>
  <th>Model:</th>                  <td>GLM</td>       <th>  Df Residuals:      </th>  <td> 96307</td> 
</tr>
<tr>
  <th>Model Family:</th>         <td>Poisson</td>     <th>  Df Model:          </th>  <td>   142</td> 
</tr>
<tr>
  <th>Link Function:</th>          <td>log</td>       <th>  Scale:             </th> <td>  1.0000</td>
</tr>
<tr>
  <th>Method:</th>                <td>IRLS</td>       <th>  Log-Likelihood:    </th> <td> -17889.</td>
</tr>
<tr>
  <th>Date:</th>            <td>Sat, 13 Jun 2020</td> <th>  Deviance:          </th> <td>  26637.</td>
</tr>
<tr>
  <th>Time:</th>                <td>17:59:10</td>     <th>  Pearson chi2:      </th> <td>9.14e+04</td>
</tr>
<tr>
  <th>No. Iterations:</th>          <td>7</td>        <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
           <td></td>             <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>          <td>   -3.0339</td> <td>    0.053</td> <td>  -56.797</td> <td> 0.000</td> <td>   -3.139</td> <td>   -2.929</td>
</tr>
<tr>
  <th>IMove[T.True]</th>      <td>    0.3221</td> <td>    0.062</td> <td>    5.154</td> <td> 0.000</td> <td>    0.200</td> <td>    0.445</td>
</tr>
<tr>
  <th>IDir[T.True]</th>       <td>   -0.5012</td> <td>    0.034</td> <td>  -14.906</td> <td> 0.000</td> <td>   -0.567</td> <td>   -0.435</td>
</tr>
<tr>
  <th>IMove[False]:lag01</th> <td>   -2.1004</td> <td>    0.303</td> <td>   -6.940</td> <td> 0.000</td> <td>   -2.694</td> <td>   -1.507</td>
</tr>
<tr>
  <th>IMove[True]:lag01</th>  <td>   -1.3948</td> <td>    0.149</td> <td>   -9.364</td> <td> 0.000</td> <td>   -1.687</td> <td>   -1.103</td>
</tr>
<tr>
  <th>IMove[False]:lag02</th> <td>   -1.1973</td> <td>    0.194</td> <td>   -6.162</td> <td> 0.000</td> <td>   -1.578</td> <td>   -0.816</td>
</tr>
<tr>
  <th>IMove[True]:lag02</th>  <td>   -1.2779</td> <td>    0.143</td> <td>   -8.933</td> <td> 0.000</td> <td>   -1.558</td> <td>   -0.998</td>
</tr>
<tr>
  <th>IMove[False]:lag03</th> <td>   -0.3466</td> <td>    0.131</td> <td>   -2.648</td> <td> 0.008</td> <td>   -0.603</td> <td>   -0.090</td>
</tr>
<tr>
  <th>IMove[True]:lag03</th>  <td>   -0.6043</td> <td>    0.106</td> <td>   -5.701</td> <td> 0.000</td> <td>   -0.812</td> <td>   -0.397</td>
</tr>
<tr>
  <th>IMove[False]:lag04</th> <td>    0.0378</td> <td>    0.112</td> <td>    0.337</td> <td> 0.736</td> <td>   -0.182</td> <td>    0.257</td>
</tr>
<tr>
  <th>IMove[True]:lag04</th>  <td>    0.0271</td> <td>    0.081</td> <td>    0.334</td> <td> 0.738</td> <td>   -0.132</td> <td>    0.186</td>
</tr>
<tr>
  <th>IMove[False]:lag05</th> <td>    0.2167</td> <td>    0.106</td> <td>    2.048</td> <td> 0.041</td> <td>    0.009</td> <td>    0.424</td>
</tr>
<tr>
  <th>IMove[True]:lag05</th>  <td>    0.4501</td> <td>    0.069</td> <td>    6.530</td> <td> 0.000</td> <td>    0.315</td> <td>    0.585</td>
</tr>
<tr>
  <th>IMove[False]:lag06</th> <td>    0.4212</td> <td>    0.098</td> <td>    4.308</td> <td> 0.000</td> <td>    0.230</td> <td>    0.613</td>
</tr>
<tr>
  <th>IMove[True]:lag06</th>  <td>    0.6054</td> <td>    0.066</td> <td>    9.172</td> <td> 0.000</td> <td>    0.476</td> <td>    0.735</td>
</tr>
<tr>
  <th>IMove[False]:lag07</th> <td>    0.3714</td> <td>    0.102</td> <td>    3.659</td> <td> 0.000</td> <td>    0.172</td> <td>    0.570</td>
</tr>
<tr>
  <th>IMove[True]:lag07</th>  <td>    0.4547</td> <td>    0.072</td> <td>    6.310</td> <td> 0.000</td> <td>    0.313</td> <td>    0.596</td>
</tr>
<tr>
  <th>IMove[False]:lag08</th> <td>    0.1963</td> <td>    0.110</td> <td>    1.791</td> <td> 0.073</td> <td>   -0.018</td> <td>    0.411</td>
</tr>
<tr>
  <th>IMove[True]:lag08</th>  <td>    0.2716</td> <td>    0.078</td> <td>    3.471</td> <td> 0.001</td> <td>    0.118</td> <td>    0.425</td>
</tr>
<tr>
  <th>IMove[False]:lag09</th> <td>    0.0774</td> <td>    0.115</td> <td>    0.676</td> <td> 0.499</td> <td>   -0.147</td> <td>    0.302</td>
</tr>
<tr>
  <th>IMove[True]:lag09</th>  <td>   -0.0261</td> <td>    0.087</td> <td>   -0.298</td> <td> 0.765</td> <td>   -0.197</td> <td>    0.145</td>
</tr>
<tr>
  <th>IMove[False]:lag10</th> <td>    0.0594</td> <td>    0.114</td> <td>    0.519</td> <td> 0.604</td> <td>   -0.165</td> <td>    0.284</td>
</tr>
<tr>
  <th>IMove[True]:lag10</th>  <td>    0.0438</td> <td>    0.082</td> <td>    0.536</td> <td> 0.592</td> <td>   -0.116</td> <td>    0.204</td>
</tr>
<tr>
  <th>IMove[False]:lag11</th> <td>   -0.0644</td> <td>    0.120</td> <td>   -0.535</td> <td> 0.592</td> <td>   -0.300</td> <td>    0.171</td>
</tr>
<tr>
  <th>IMove[True]:lag11</th>  <td>    0.0525</td> <td>    0.079</td> <td>    0.661</td> <td> 0.509</td> <td>   -0.103</td> <td>    0.208</td>
</tr>
<tr>
  <th>IMove[False]:lag12</th> <td>   -0.0984</td> <td>    0.122</td> <td>   -0.808</td> <td> 0.419</td> <td>   -0.337</td> <td>    0.140</td>
</tr>
<tr>
  <th>IMove[True]:lag12</th>  <td>    0.0235</td> <td>    0.080</td> <td>    0.294</td> <td> 0.769</td> <td>   -0.133</td> <td>    0.180</td>
</tr>
<tr>
  <th>IMove[False]:lag13</th> <td>    0.1273</td> <td>    0.110</td> <td>    1.161</td> <td> 0.246</td> <td>   -0.088</td> <td>    0.342</td>
</tr>
<tr>
  <th>IMove[True]:lag13</th>  <td>    0.0178</td> <td>    0.081</td> <td>    0.220</td> <td> 0.826</td> <td>   -0.141</td> <td>    0.176</td>
</tr>
<tr>
  <th>IMove[False]:lag14</th> <td>    0.0200</td> <td>    0.117</td> <td>    0.171</td> <td> 0.864</td> <td>   -0.209</td> <td>    0.248</td>
</tr>
<tr>
  <th>IMove[True]:lag14</th>  <td>   -0.0673</td> <td>    0.085</td> <td>   -0.790</td> <td> 0.430</td> <td>   -0.234</td> <td>    0.100</td>
</tr>
<tr>
  <th>IMove[False]:lag15</th> <td>    0.1307</td> <td>    0.111</td> <td>    1.181</td> <td> 0.238</td> <td>   -0.086</td> <td>    0.348</td>
</tr>
<tr>
  <th>IMove[True]:lag15</th>  <td>   -0.0581</td> <td>    0.085</td> <td>   -0.687</td> <td> 0.492</td> <td>   -0.224</td> <td>    0.108</td>
</tr>
<tr>
  <th>IMove[False]:lag16</th> <td>   -0.2589</td> <td>    0.134</td> <td>   -1.930</td> <td> 0.054</td> <td>   -0.522</td> <td>    0.004</td>
</tr>
<tr>
  <th>IMove[True]:lag16</th>  <td>    0.0033</td> <td>    0.082</td> <td>    0.040</td> <td> 0.968</td> <td>   -0.157</td> <td>    0.163</td>
</tr>
<tr>
  <th>IMove[False]:lag17</th> <td>   -0.1796</td> <td>    0.128</td> <td>   -1.404</td> <td> 0.160</td> <td>   -0.430</td> <td>    0.071</td>
</tr>
<tr>
  <th>IMove[True]:lag17</th>  <td>    0.1302</td> <td>    0.077</td> <td>    1.689</td> <td> 0.091</td> <td>   -0.021</td> <td>    0.281</td>
</tr>
<tr>
  <th>IMove[False]:lag18</th> <td>   -0.1398</td> <td>    0.125</td> <td>   -1.117</td> <td> 0.264</td> <td>   -0.385</td> <td>    0.105</td>
</tr>
<tr>
  <th>IMove[True]:lag18</th>  <td>   -0.1062</td> <td>    0.086</td> <td>   -1.232</td> <td> 0.218</td> <td>   -0.275</td> <td>    0.063</td>
</tr>
<tr>
  <th>IMove[False]:lag19</th> <td>   -0.0483</td> <td>    0.119</td> <td>   -0.404</td> <td> 0.686</td> <td>   -0.282</td> <td>    0.186</td>
</tr>
<tr>
  <th>IMove[True]:lag19</th>  <td>   -0.0615</td> <td>    0.085</td> <td>   -0.727</td> <td> 0.467</td> <td>   -0.227</td> <td>    0.104</td>
</tr>
<tr>
  <th>IMove[False]:lag20</th> <td>   -0.2086</td> <td>    0.129</td> <td>   -1.618</td> <td> 0.106</td> <td>   -0.461</td> <td>    0.044</td>
</tr>
<tr>
  <th>IMove[True]:lag20</th>  <td>   -0.1001</td> <td>    0.086</td> <td>   -1.161</td> <td> 0.246</td> <td>   -0.269</td> <td>    0.069</td>
</tr>
<tr>
  <th>IMove[False]:lag21</th> <td>   -0.2909</td> <td>    0.134</td> <td>   -2.170</td> <td> 0.030</td> <td>   -0.554</td> <td>   -0.028</td>
</tr>
<tr>
  <th>IMove[True]:lag21</th>  <td>   -0.0181</td> <td>    0.083</td> <td>   -0.218</td> <td> 0.827</td> <td>   -0.180</td> <td>    0.144</td>
</tr>
<tr>
  <th>IMove[False]:lag22</th> <td>   -0.1518</td> <td>    0.125</td> <td>   -1.213</td> <td> 0.225</td> <td>   -0.397</td> <td>    0.093</td>
</tr>
<tr>
  <th>IMove[True]:lag22</th>  <td>    0.0788</td> <td>    0.079</td> <td>    0.997</td> <td> 0.319</td> <td>   -0.076</td> <td>    0.234</td>
</tr>
<tr>
  <th>IMove[False]:lag23</th> <td>   -0.3184</td> <td>    0.136</td> <td>   -2.336</td> <td> 0.019</td> <td>   -0.585</td> <td>   -0.051</td>
</tr>
<tr>
  <th>IMove[True]:lag23</th>  <td>    0.0795</td> <td>    0.080</td> <td>    1.000</td> <td> 0.317</td> <td>   -0.076</td> <td>    0.235</td>
</tr>
<tr>
  <th>IMove[False]:lag24</th> <td>   -0.2108</td> <td>    0.130</td> <td>   -1.625</td> <td> 0.104</td> <td>   -0.465</td> <td>    0.044</td>
</tr>
<tr>
  <th>IMove[True]:lag24</th>  <td>   -0.0529</td> <td>    0.086</td> <td>   -0.617</td> <td> 0.537</td> <td>   -0.221</td> <td>    0.115</td>
</tr>
<tr>
  <th>IMove[False]:lag25</th> <td>   -0.5296</td> <td>    0.151</td> <td>   -3.497</td> <td> 0.000</td> <td>   -0.826</td> <td>   -0.233</td>
</tr>
<tr>
  <th>IMove[True]:lag25</th>  <td>    0.1196</td> <td>    0.079</td> <td>    1.508</td> <td> 0.132</td> <td>   -0.036</td> <td>    0.275</td>
</tr>
<tr>
  <th>IMove[False]:lag26</th> <td>   -0.2515</td> <td>    0.132</td> <td>   -1.908</td> <td> 0.056</td> <td>   -0.510</td> <td>    0.007</td>
</tr>
<tr>
  <th>IMove[True]:lag26</th>  <td>   -0.0183</td> <td>    0.085</td> <td>   -0.216</td> <td> 0.829</td> <td>   -0.184</td> <td>    0.148</td>
</tr>
<tr>
  <th>IMove[False]:lag27</th> <td>   -0.1214</td> <td>    0.125</td> <td>   -0.971</td> <td> 0.332</td> <td>   -0.367</td> <td>    0.124</td>
</tr>
<tr>
  <th>IMove[True]:lag27</th>  <td>    0.0077</td> <td>    0.083</td> <td>    0.093</td> <td> 0.926</td> <td>   -0.155</td> <td>    0.170</td>
</tr>
<tr>
  <th>IMove[False]:lag28</th> <td>   -0.0880</td> <td>    0.123</td> <td>   -0.714</td> <td> 0.476</td> <td>   -0.330</td> <td>    0.154</td>
</tr>
<tr>
  <th>IMove[True]:lag28</th>  <td>    0.1258</td> <td>    0.078</td> <td>    1.611</td> <td> 0.107</td> <td>   -0.027</td> <td>    0.279</td>
</tr>
<tr>
  <th>IMove[False]:lag29</th> <td>   -0.2447</td> <td>    0.134</td> <td>   -1.826</td> <td> 0.068</td> <td>   -0.507</td> <td>    0.018</td>
</tr>
<tr>
  <th>IMove[True]:lag29</th>  <td>    0.1321</td> <td>    0.078</td> <td>    1.691</td> <td> 0.091</td> <td>   -0.021</td> <td>    0.285</td>
</tr>
<tr>
  <th>IMove[False]:lag30</th> <td>   -0.1363</td> <td>    0.127</td> <td>   -1.073</td> <td> 0.283</td> <td>   -0.385</td> <td>    0.113</td>
</tr>
<tr>
  <th>IMove[True]:lag30</th>  <td>   -0.0514</td> <td>    0.085</td> <td>   -0.602</td> <td> 0.547</td> <td>   -0.219</td> <td>    0.116</td>
</tr>
<tr>
  <th>IMove[False]:lag31</th> <td>   -0.2153</td> <td>    0.132</td> <td>   -1.633</td> <td> 0.102</td> <td>   -0.474</td> <td>    0.043</td>
</tr>
<tr>
  <th>IMove[True]:lag31</th>  <td>   -0.0168</td> <td>    0.084</td> <td>   -0.199</td> <td> 0.842</td> <td>   -0.182</td> <td>    0.148</td>
</tr>
<tr>
  <th>IMove[False]:lag32</th> <td>   -0.2670</td> <td>    0.134</td> <td>   -1.992</td> <td> 0.046</td> <td>   -0.530</td> <td>   -0.004</td>
</tr>
<tr>
  <th>IMove[True]:lag32</th>  <td>    0.0658</td> <td>    0.081</td> <td>    0.817</td> <td> 0.414</td> <td>   -0.092</td> <td>    0.224</td>
</tr>
<tr>
  <th>IMove[False]:lag33</th> <td>   -0.2636</td> <td>    0.133</td> <td>   -1.982</td> <td> 0.047</td> <td>   -0.524</td> <td>   -0.003</td>
</tr>
<tr>
  <th>IMove[True]:lag33</th>  <td>    0.0125</td> <td>    0.082</td> <td>    0.152</td> <td> 0.880</td> <td>   -0.149</td> <td>    0.173</td>
</tr>
<tr>
  <th>IMove[False]:lag34</th> <td>   -0.3515</td> <td>    0.139</td> <td>   -2.533</td> <td> 0.011</td> <td>   -0.623</td> <td>   -0.080</td>
</tr>
<tr>
  <th>IMove[True]:lag34</th>  <td>    0.0081</td> <td>    0.082</td> <td>    0.099</td> <td> 0.921</td> <td>   -0.153</td> <td>    0.169</td>
</tr>
<tr>
  <th>IMove[False]:lag35</th> <td>   -0.1213</td> <td>    0.124</td> <td>   -0.976</td> <td> 0.329</td> <td>   -0.365</td> <td>    0.122</td>
</tr>
<tr>
  <th>IMove[True]:lag35</th>  <td>    0.0803</td> <td>    0.080</td> <td>    1.010</td> <td> 0.312</td> <td>   -0.076</td> <td>    0.236</td>
</tr>
<tr>
  <th>IMove[False]:lag36</th> <td>    0.0648</td> <td>    0.114</td> <td>    0.567</td> <td> 0.571</td> <td>   -0.159</td> <td>    0.289</td>
</tr>
<tr>
  <th>IMove[True]:lag36</th>  <td>   -0.0145</td> <td>    0.084</td> <td>   -0.173</td> <td> 0.863</td> <td>   -0.178</td> <td>    0.149</td>
</tr>
<tr>
  <th>IMove[False]:lag37</th> <td>   -0.2382</td> <td>    0.133</td> <td>   -1.791</td> <td> 0.073</td> <td>   -0.499</td> <td>    0.022</td>
</tr>
<tr>
  <th>IMove[True]:lag37</th>  <td>   -0.0404</td> <td>    0.085</td> <td>   -0.476</td> <td> 0.634</td> <td>   -0.207</td> <td>    0.126</td>
</tr>
<tr>
  <th>IMove[False]:lag38</th> <td>   -0.0741</td> <td>    0.124</td> <td>   -0.596</td> <td> 0.551</td> <td>   -0.318</td> <td>    0.169</td>
</tr>
<tr>
  <th>IMove[True]:lag38</th>  <td>    0.0037</td> <td>    0.083</td> <td>    0.045</td> <td> 0.964</td> <td>   -0.158</td> <td>    0.166</td>
</tr>
<tr>
  <th>IMove[False]:lag39</th> <td>    0.1384</td> <td>    0.112</td> <td>    1.238</td> <td> 0.216</td> <td>   -0.081</td> <td>    0.358</td>
</tr>
<tr>
  <th>IMove[True]:lag39</th>  <td>    0.0120</td> <td>    0.082</td> <td>    0.146</td> <td> 0.884</td> <td>   -0.149</td> <td>    0.173</td>
</tr>
<tr>
  <th>IMove[False]:lag40</th> <td>   -0.0011</td> <td>    0.120</td> <td>   -0.009</td> <td> 0.993</td> <td>   -0.237</td> <td>    0.234</td>
</tr>
<tr>
  <th>IMove[True]:lag40</th>  <td>    0.0619</td> <td>    0.080</td> <td>    0.773</td> <td> 0.440</td> <td>   -0.095</td> <td>    0.219</td>
</tr>
<tr>
  <th>IMove[False]:lag41</th> <td>    0.1980</td> <td>    0.109</td> <td>    1.818</td> <td> 0.069</td> <td>   -0.015</td> <td>    0.411</td>
</tr>
<tr>
  <th>IMove[True]:lag41</th>  <td>   -0.0007</td> <td>    0.083</td> <td>   -0.009</td> <td> 0.993</td> <td>   -0.163</td> <td>    0.161</td>
</tr>
<tr>
  <th>IMove[False]:lag42</th> <td>    0.1223</td> <td>    0.112</td> <td>    1.087</td> <td> 0.277</td> <td>   -0.098</td> <td>    0.343</td>
</tr>
<tr>
  <th>IMove[True]:lag42</th>  <td>   -0.0006</td> <td>    0.083</td> <td>   -0.008</td> <td> 0.994</td> <td>   -0.163</td> <td>    0.161</td>
</tr>
<tr>
  <th>IMove[False]:lag43</th> <td>   -0.0428</td> <td>    0.121</td> <td>   -0.354</td> <td> 0.723</td> <td>   -0.280</td> <td>    0.194</td>
</tr>
<tr>
  <th>IMove[True]:lag43</th>  <td>   -0.0058</td> <td>    0.083</td> <td>   -0.070</td> <td> 0.945</td> <td>   -0.169</td> <td>    0.157</td>
</tr>
<tr>
  <th>IMove[False]:lag44</th> <td>   -0.0749</td> <td>    0.123</td> <td>   -0.611</td> <td> 0.541</td> <td>   -0.315</td> <td>    0.165</td>
</tr>
<tr>
  <th>IMove[True]:lag44</th>  <td>   -0.1215</td> <td>    0.087</td> <td>   -1.394</td> <td> 0.163</td> <td>   -0.292</td> <td>    0.049</td>
</tr>
<tr>
  <th>IMove[False]:lag45</th> <td>    0.1341</td> <td>    0.110</td> <td>    1.219</td> <td> 0.223</td> <td>   -0.082</td> <td>    0.350</td>
</tr>
<tr>
  <th>IMove[True]:lag45</th>  <td>    0.0091</td> <td>    0.082</td> <td>    0.112</td> <td> 0.911</td> <td>   -0.152</td> <td>    0.170</td>
</tr>
<tr>
  <th>IMove[False]:lag46</th> <td>    0.0365</td> <td>    0.116</td> <td>    0.315</td> <td> 0.753</td> <td>   -0.190</td> <td>    0.263</td>
</tr>
<tr>
  <th>IMove[True]:lag46</th>  <td>   -0.0622</td> <td>    0.085</td> <td>   -0.733</td> <td> 0.464</td> <td>   -0.229</td> <td>    0.104</td>
</tr>
<tr>
  <th>IMove[False]:lag47</th> <td>    0.0355</td> <td>    0.116</td> <td>    0.305</td> <td> 0.761</td> <td>   -0.193</td> <td>    0.264</td>
</tr>
<tr>
  <th>IMove[True]:lag47</th>  <td>    0.0063</td> <td>    0.083</td> <td>    0.076</td> <td> 0.939</td> <td>   -0.156</td> <td>    0.168</td>
</tr>
<tr>
  <th>IMove[False]:lag48</th> <td>    0.2583</td> <td>    0.105</td> <td>    2.467</td> <td> 0.014</td> <td>    0.053</td> <td>    0.464</td>
</tr>
<tr>
  <th>IMove[True]:lag48</th>  <td>    0.0856</td> <td>    0.080</td> <td>    1.074</td> <td> 0.283</td> <td>   -0.071</td> <td>    0.242</td>
</tr>
<tr>
  <th>IMove[False]:lag49</th> <td>    0.1527</td> <td>    0.111</td> <td>    1.380</td> <td> 0.168</td> <td>   -0.064</td> <td>    0.370</td>
</tr>
<tr>
  <th>IMove[True]:lag49</th>  <td>   -0.0683</td> <td>    0.086</td> <td>   -0.797</td> <td> 0.426</td> <td>   -0.236</td> <td>    0.100</td>
</tr>
<tr>
  <th>IMove[False]:lag50</th> <td>    0.3647</td> <td>    0.101</td> <td>    3.628</td> <td> 0.000</td> <td>    0.168</td> <td>    0.562</td>
</tr>
<tr>
  <th>IMove[True]:lag50</th>  <td>   -0.0082</td> <td>    0.083</td> <td>   -0.099</td> <td> 0.921</td> <td>   -0.171</td> <td>    0.155</td>
</tr>
<tr>
  <th>IMove[False]:lag51</th> <td>    0.1652</td> <td>    0.111</td> <td>    1.492</td> <td> 0.136</td> <td>   -0.052</td> <td>    0.382</td>
</tr>
<tr>
  <th>IMove[True]:lag51</th>  <td>    0.0262</td> <td>    0.082</td> <td>    0.320</td> <td> 0.749</td> <td>   -0.134</td> <td>    0.186</td>
</tr>
<tr>
  <th>IMove[False]:lag52</th> <td>    0.2069</td> <td>    0.108</td> <td>    1.918</td> <td> 0.055</td> <td>   -0.005</td> <td>    0.418</td>
</tr>
<tr>
  <th>IMove[True]:lag52</th>  <td>   -0.2051</td> <td>    0.091</td> <td>   -2.260</td> <td> 0.024</td> <td>   -0.383</td> <td>   -0.027</td>
</tr>
<tr>
  <th>IMove[False]:lag53</th> <td>    0.0714</td> <td>    0.114</td> <td>    0.623</td> <td> 0.533</td> <td>   -0.153</td> <td>    0.296</td>
</tr>
<tr>
  <th>IMove[True]:lag53</th>  <td>   -0.1586</td> <td>    0.088</td> <td>   -1.797</td> <td> 0.072</td> <td>   -0.332</td> <td>    0.014</td>
</tr>
<tr>
  <th>IMove[False]:lag54</th> <td>    0.1332</td> <td>    0.110</td> <td>    1.215</td> <td> 0.224</td> <td>   -0.082</td> <td>    0.348</td>
</tr>
<tr>
  <th>IMove[True]:lag54</th>  <td>    0.1064</td> <td>    0.078</td> <td>    1.363</td> <td> 0.173</td> <td>   -0.047</td> <td>    0.259</td>
</tr>
<tr>
  <th>IMove[False]:lag55</th> <td>    0.0954</td> <td>    0.111</td> <td>    0.857</td> <td> 0.391</td> <td>   -0.123</td> <td>    0.314</td>
</tr>
<tr>
  <th>IMove[True]:lag55</th>  <td>    0.0380</td> <td>    0.081</td> <td>    0.468</td> <td> 0.640</td> <td>   -0.121</td> <td>    0.197</td>
</tr>
<tr>
  <th>IMove[False]:lag56</th> <td>    0.2411</td> <td>    0.105</td> <td>    2.302</td> <td> 0.021</td> <td>    0.036</td> <td>    0.446</td>
</tr>
<tr>
  <th>IMove[True]:lag56</th>  <td>   -0.0686</td> <td>    0.086</td> <td>   -0.801</td> <td> 0.423</td> <td>   -0.237</td> <td>    0.099</td>
</tr>
<tr>
  <th>IMove[False]:lag57</th> <td>    0.0462</td> <td>    0.116</td> <td>    0.399</td> <td> 0.690</td> <td>   -0.181</td> <td>    0.273</td>
</tr>
<tr>
  <th>IMove[True]:lag57</th>  <td>   -0.0401</td> <td>    0.084</td> <td>   -0.475</td> <td> 0.635</td> <td>   -0.205</td> <td>    0.125</td>
</tr>
<tr>
  <th>IMove[False]:lag58</th> <td>    0.3425</td> <td>    0.101</td> <td>    3.406</td> <td> 0.001</td> <td>    0.145</td> <td>    0.540</td>
</tr>
<tr>
  <th>IMove[True]:lag58</th>  <td>   -0.0631</td> <td>    0.085</td> <td>   -0.741</td> <td> 0.458</td> <td>   -0.230</td> <td>    0.104</td>
</tr>
<tr>
  <th>IMove[False]:lag59</th> <td>    0.1657</td> <td>    0.111</td> <td>    1.497</td> <td> 0.134</td> <td>   -0.051</td> <td>    0.383</td>
</tr>
<tr>
  <th>IMove[True]:lag59</th>  <td>   -0.0288</td> <td>    0.083</td> <td>   -0.346</td> <td> 0.729</td> <td>   -0.192</td> <td>    0.135</td>
</tr>
<tr>
  <th>IMove[False]:lag60</th> <td>    0.1858</td> <td>    0.110</td> <td>    1.696</td> <td> 0.090</td> <td>   -0.029</td> <td>    0.401</td>
</tr>
<tr>
  <th>IMove[True]:lag60</th>  <td>   -0.1894</td> <td>    0.089</td> <td>   -2.124</td> <td> 0.034</td> <td>   -0.364</td> <td>   -0.015</td>
</tr>
<tr>
  <th>IMove[False]:lag61</th> <td>    0.3462</td> <td>    0.102</td> <td>    3.396</td> <td> 0.001</td> <td>    0.146</td> <td>    0.546</td>
</tr>
<tr>
  <th>IMove[True]:lag61</th>  <td>    0.0449</td> <td>    0.080</td> <td>    0.562</td> <td> 0.574</td> <td>   -0.112</td> <td>    0.202</td>
</tr>
<tr>
  <th>IMove[False]:lag62</th> <td>    0.2030</td> <td>    0.109</td> <td>    1.862</td> <td> 0.063</td> <td>   -0.011</td> <td>    0.417</td>
</tr>
<tr>
  <th>IMove[True]:lag62</th>  <td>   -0.1455</td> <td>    0.088</td> <td>   -1.654</td> <td> 0.098</td> <td>   -0.318</td> <td>    0.027</td>
</tr>
<tr>
  <th>IMove[False]:lag63</th> <td>    0.0845</td> <td>    0.115</td> <td>    0.738</td> <td> 0.460</td> <td>   -0.140</td> <td>    0.309</td>
</tr>
<tr>
  <th>IMove[True]:lag63</th>  <td>    0.0841</td> <td>    0.080</td> <td>    1.054</td> <td> 0.292</td> <td>   -0.072</td> <td>    0.240</td>
</tr>
<tr>
  <th>IMove[False]:lag64</th> <td>    0.0903</td> <td>    0.114</td> <td>    0.793</td> <td> 0.428</td> <td>   -0.133</td> <td>    0.313</td>
</tr>
<tr>
  <th>IMove[True]:lag64</th>  <td>   -0.0289</td> <td>    0.084</td> <td>   -0.342</td> <td> 0.732</td> <td>   -0.194</td> <td>    0.136</td>
</tr>
<tr>
  <th>IMove[False]:lag65</th> <td>    0.1482</td> <td>    0.111</td> <td>    1.340</td> <td> 0.180</td> <td>   -0.069</td> <td>    0.365</td>
</tr>
<tr>
  <th>IMove[True]:lag65</th>  <td>    0.0498</td> <td>    0.082</td> <td>    0.609</td> <td> 0.543</td> <td>   -0.111</td> <td>    0.210</td>
</tr>
<tr>
  <th>IMove[False]:lag66</th> <td>    0.0744</td> <td>    0.115</td> <td>    0.646</td> <td> 0.518</td> <td>   -0.151</td> <td>    0.300</td>
</tr>
<tr>
  <th>IMove[True]:lag66</th>  <td>    0.0572</td> <td>    0.082</td> <td>    0.698</td> <td> 0.485</td> <td>   -0.103</td> <td>    0.218</td>
</tr>
<tr>
  <th>IMove[False]:lag67</th> <td>    0.1712</td> <td>    0.110</td> <td>    1.563</td> <td> 0.118</td> <td>   -0.043</td> <td>    0.386</td>
</tr>
<tr>
  <th>IMove[True]:lag67</th>  <td>    0.1552</td> <td>    0.078</td> <td>    1.982</td> <td> 0.048</td> <td>    0.002</td> <td>    0.309</td>
</tr>
<tr>
  <th>IMove[False]:lag68</th> <td>    0.1507</td> <td>    0.111</td> <td>    1.353</td> <td> 0.176</td> <td>   -0.068</td> <td>    0.369</td>
</tr>
<tr>
  <th>IMove[True]:lag68</th>  <td>    0.0724</td> <td>    0.082</td> <td>    0.888</td> <td> 0.375</td> <td>   -0.087</td> <td>    0.232</td>
</tr>
<tr>
  <th>IMove[False]:lag69</th> <td>    0.0735</td> <td>    0.115</td> <td>    0.638</td> <td> 0.523</td> <td>   -0.152</td> <td>    0.299</td>
</tr>
<tr>
  <th>IMove[True]:lag69</th>  <td>    0.0751</td> <td>    0.081</td> <td>    0.923</td> <td> 0.356</td> <td>   -0.084</td> <td>    0.235</td>
</tr>
<tr>
  <th>IMove[False]:lag70</th> <td>   -0.0329</td> <td>    0.122</td> <td>   -0.271</td> <td> 0.787</td> <td>   -0.271</td> <td>    0.205</td>
</tr>
<tr>
  <th>IMove[True]:lag70</th>  <td>    0.1508</td> <td>    0.078</td> <td>    1.935</td> <td> 0.053</td> <td>   -0.002</td> <td>    0.303</td>
</tr>
</table></div></div>
</div>
<p>In the first line, we created the portion of the <code class="docutils literal notranslate"><span class="pre">formula</span></code> variable that includes the history terms. The <code class="docutils literal notranslate"><span class="pre">filter()</span></code> method can be used to filter rows or columns of a dataframe according to their names (use <code class="docutils literal notranslate"><span class="pre">df.filter?</span></code> for details). In this case, we asked for all column names that include the phrase <code class="docutils literal notranslate"><span class="pre">'lag'</span></code>. In the second line, we compose the formula as we have before except this time we include <em>cross-terms</em>. Cross-terms are the product of two predictor variables. There are two ways to include cross-terms in a formula: <code class="docutils literal notranslate"><span class="pre">*</span></code> and <code class="docutils literal notranslate"><span class="pre">:</span></code>. The asterisk (<code class="docutils literal notranslate"><span class="pre">*</span></code>) indicates individual terms in addition to cross-terms; the colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>) indicates that we would like to include only the cross terms.</p>
<div class="question">
<p><strong>Q.</strong> What is a shorter way to call the following formula?</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>spikes ~ IMove + IDir + lag01 + IMove:IDir + IMove:lag01 + IDir:lag01 + IMove:IDir:lag01
</pre></div>
</div>
<p><strong>A.</strong> Because we want to model <code class="docutils literal notranslate"><span class="pre">spikes</span></code> on all individual and cross-terms, we can write</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>spikes ~ IMove*IDir*lag01
</pre></div>
</div>
<p>Moreover, if we wanted to exclude a specific term - for example, <code class="docutils literal notranslate"><span class="pre">IMove:IDir:lag01</span></code>- we could write</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>spikes ~ IMove*IDir*lag01 - IMove:IDir:lag01
</pre></div>
</div>
</div><p>Let’s examine the exponentiated values directly. For the first three:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examine the first three exponentiated values of Model 4</span>
<span class="n">exp</span><span class="p">(</span><span class="n">M4</span><span class="o">.</span><span class="n">params</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept        0.048126
IMove[T.True]    1.380011
IDir[T.True]     0.605787
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Since Model 4 has 140 additional parameters related to history dependence, inspecting these printed values directly would be too overwhelming. Instead, let’s plot their exponentiated values as a function of lag for each period: <a id="fig:M4params"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordK</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> 
     <span class="n">exp</span><span class="p">(</span><span class="n">M4</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span> 
     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Planning&#39;</span><span class="p">)</span>     <span class="c1"># Plot the planning parameters.</span>

<span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordK</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> 
     <span class="n">exp</span><span class="p">(</span><span class="n">M4</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span> 
     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Movement&#39;</span><span class="p">)</span>     <span class="c1"># Plot the movement parameters.</span>

<span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>   <span class="c1"># With axes labeled.</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag (ms)&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Exponentiated GLM parameters related to history dependence in Model 4&#39;</span><span class="p">)</span>

<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/fig-M4params.png&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_113_0.png" src="_images/10_113_0.png" />
</div>
</div>
<p>Each of these values represents a modulation to the firing intensity when a previous spike has occurred at the given lag. For both periods, the value at lag 1 ms is near zero, suggesting that the probability of spiking again immediately after a previous spike is greatly reduced—the neuron is refractory. At lags greater than 1 ms, the probability of spiking now is increased when there is a spike at the given lag. For example, if there is a spike 6 ms in the past during the movement period, the probability of spiking is modulated by about 1.8, or it increases by about 80%. A modulation value near 1 suggests no effect on the spike intensity related to a spike at that lag. For the movement period, we see a refractory period followed by a period of increased intensity 6 ms after a spike. However, any spiking 10 ms in the past or longer appears to have no effect on the current spiking intensity. During the planning period, we see a similar pattern of refractoriness followed by increased intensity up to lag 10 ms. At longer lags, however, we see a pattern of decreased spiking probability about 15–35 ms after a spike, followed by increased spiking probability about 45–65 ms after a spike. The parameter values for these periods suggest that the modulation for these lags is relatively small, about a 10%–15% decrease or increase in the firing intensity.</p>
<div class="question">
<p><strong>Q.</strong> Are these history effects statistically significant?</p>
<p><strong>A.</strong> One approach we could take is to visualize the p-values (based on the Wald t- test) for each parameter. Since it can be hard to tell visually whether p-values are sufficiently close to zero, let’s plot the negative of the natural logarithm of the p-values. Any value of the negative log above 3 indicates a p-value below 0.05. In Python,</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>                   <span class="c1"># Create a figure with two subplots</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordK</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> 
          <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">M4</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>  <span class="c1"># Plot the planning p-values.</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                         <span class="c1"># Indicate significance level,</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>       <span class="c1"># ... over a range of lags,</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Lag (ms)&#39;</span><span class="p">)</span>             <span class="c1"># ... with axes labeled.</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;-Log(p)&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Planning&#39;</span><span class="p">)</span>

<span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordK</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> 
          <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">M4</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>  <span class="c1"># Plot the movement p-values.</span>
<span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                         <span class="c1"># Indicate significance level.</span>
<span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>       <span class="c1"># ... over a range of lags,</span>
<span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Lag (ms)&#39;</span><span class="p">)</span>             <span class="c1"># ... with axes labeled.</span>
<span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Movement&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_116_0.png" src="_images/10_116_0.png" />
</div>
</div>
<p>We see that for both the planning and movement periods, the p-values corresponding to lags up to about 8 ms tend to be significant. For the movement period, most of the parameters for lags above 8 ms do not suggest significant modulation. For the planning period, we find a few parameters for higher lags that are significant on their own. However, in this case we have to be careful about multiple comparisons. As discussed in <a href="08" rel="local">notebook 8</a>, if we control the probability of a single test or comparison being significant by chance at 0.05, then after performing multiple tests or comparisons, the probability that any of them are deemed significant by chance becomes much higher. For 140 independent comparisons, even if no effects are actually present, the probability of finding at least one to be significant by chance is <span class="math notranslate nohighlight">\(1 - 0.95^{140} = 0.99\)</span>.</p>
<p>A common approach for dealing with multiple comparisons is the Bonferroni correction method, where instead of setting the significance level to control for the probability of a single significant result by chance, we divide by the total number of comparisons to control for the probability of having any comparison significant by chance. In this case, the corrected significance level would be 0.05/140 = 0.00036. The negative log of this corrected significance level is about 8. So, in the figure above, we would declare significant only points above 8. Of the parameters corresponding to lags above 10 ms, only the one at lag 50 for the planning period would remain significant.</p>
<p>Bonferroni’s method is often much more conservative than necessary. In this case, we can try another option. Instead of 140 separate tests for each lag in each period, we can construct a single test to answer a question of direct interest: Is there a significant difference between the complete sets of history parameters in the planning and movement periods? In <a href="09" rel="local">notebook 9</a>, we discussed maximum likelihood ratio tests (MLRTs) for point process models. We showed that for nested models (where one model can be made equivalent to the other by setting some parameters to specific values), under the null hypothesis that the data arise from the smaller model, the difference in the deviance between the two models should have a chi-square distribution with the number of degrees of freedom equal to the number of extra parameters in the larger model. In this case, let’s compare Model 3, for which the history dependence is the same for the planning and movement periods, with Model 4. To compute the p-value for this test in Python,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pval</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">M3</span><span class="o">.</span><span class="n">deviance</span> <span class="o">-</span> <span class="n">M4</span><span class="o">.</span><span class="n">deviance</span><span class="p">,</span> <span class="n">ordK</span><span class="p">)</span>
<span class="n">pval</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>2.1893430623975974e-08
</pre></div>
</div>
</div>
</div>
<div class="question">
<p><strong>Q.</strong> Why do we set the second input to the function <code class="docutils literal notranslate"><span class="pre">chi2.cdf()</span></code> to <code class="docutils literal notranslate"><span class="pre">okdK</span></code>?</p>
</div><p>We find <code class="docutils literal notranslate"><span class="pre">pval</span> <span class="pre">=</span> <span class="pre">2.3190e-08</span></code>, and we would be very unlikely to see this result if Model 3—the model with identical history dependence structure—were correct.
Finally, let’s construct a KS plot to see how well Model 4 fits the data. When we introduced the time-rescaling theorem in <a href="09" rel="local">notebook 9</a>, we assumed that the data came from a Poisson process. Now that we are modeling history-dependent point processes, we need to make a slight update to the time-rescaling theorem:</p>
<div class="math-note" id="time-rescaling-history-dependent">
<p><strong>Time-Rescaling Theorem for History-Dependent Point Processes.</strong></p>
<p>Let <span class="math notranslate nohighlight">\(S_1 , S_2 , \ldots , S_n\)</span> be a collection of spike times from any point process with conditional intensity function <span class="math notranslate nohighlight">\(\lambda(t|H_t)\)</span>. Let</p>
<div class="math notranslate nohighlight">
\[
  Z_1 = \int_0^{S_1} \lambda(t | H_t)dt
  \quad
  \text{and}
  \quad
  Z_i =  \int_{S_{i-1}}^{S_i} \lambda(t | H_t)dt,
\]</div>
<p>for <span class="math notranslate nohighlight">\(i = 1, \ldots, n\)</span>. Then the rescaled variables <span class="math notranslate nohighlight">\(Z_1, \ldots, Z_n\)</span>, are independent and identically distributed random variables from the exponential distribution with parameter 1.</p>
</div>
<p>This looks nearly identical to the time-rescaling theorem for Poisson processes, with the Poisson rate functions replaced by history-dependent conditional intensity functions. However, the fact that the rescaled times, <span class="math notranslate nohighlight">\(Z_i\)</span>, are still independent is perhaps more surprising in this case, since the original point process (i.e., <span class="math notranslate nohighlight">\(S_1, S_2, \ldots, S_3\)</span>) does have history dependence. This result suggests that if we have the right model, we can rescale the spiking process to account for history dependence as well as changes in the firing intensity related to time and other covariates.</p>
<p>Let’s now return to constructing a KS plot to see how well Model 4 fits the data.</p>
<p>We use <code class="docutils literal notranslate"><span class="pre">predict()</span></code> to compute the model intensity at each time step: <a id="fig:m4ks"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lambda4</span> <span class="o">=</span> <span class="n">M4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">glmHist</span><span class="p">)</span>          <span class="c1"># Compute the model prediction.</span>
<span class="n">spikeindex</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">glmHist</span><span class="o">.</span><span class="n">spikes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Find the spike times.</span>

<span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">lambda4</span><span class="p">[</span><span class="n">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">])</span>               <span class="c1"># Compute the rescaled waiting time,</span>
     <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hstack</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">spikeindex</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span> <span class="n">spikeindex</span><span class="p">)]</span>  <span class="c1"># ... for each ISI.</span>

<span class="n">eCDF</span> <span class="o">=</span> <span class="n">ECDF</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>                         <span class="c1"># Empirical CDF</span>
<span class="n">mCDF</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">eCDF</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>                <span class="c1"># Model CDF</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>                 <span class="c1"># Plot the results</span>
<span class="n">plot</span><span class="p">(</span><span class="n">mCDF</span><span class="p">,</span> <span class="n">eCDF</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikeindex</span><span class="p">)</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.36</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.36</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Model CDF&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Empirical CDF&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;KS plot of Model 4&#39;</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/fig-model4ks.png&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_121_0.png" src="_images/10_121_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q.</strong> Compare the KS plot for Model 4 to the <a class="reference external" href="#fig:ks1">KS plot for Model 1</a><span class="sup">fig<img src="imgs/ks1.png"></span>. Does the updated model provide an improvement over the original model?</p>
<p><strong>A.</strong> We see a substantial improvement in the fit according to the KS plot at smaller rescaled ISIs. The model still does not quite pass the KS test, as can be seen when the KS plot veers outside of the confidence band around the model CDF value of 0.2. However, the inclusion of history dependence has clearly improved the fit of the short rescaled ISIs.</p>
</div><div class="question">
<p><strong>Q.</strong> Based on prior visualization analyses, are there any other variables that we could include to further improve the goodness of fit of the model?</p>
</div><div class="section" id="choice-of-model-order">
<h3>Choice of Model Order<a class="headerlink" href="#choice-of-model-order" title="Permalink to this headline">¶</a></h3>
<p>Before we settle on Model 4, let’s return to the question of how to select the order of a model such as <a class="reference external" href="#eq:model4">Model 4</a><span class="sup">eq<img src="imgs/eq10-6.png"></span>. We chose somewhat arbitrarily a model order of 70 for the number of history-dependent terms for both the planning and movement periods, based on the visualization analyses. In subsequent modeling, we found that many of these parameters did not contribute significantly to the model fit on their own. One approach to selecting model order is to start by fitting a higher-order model than you suspect is necessary, and then paring down the parameters that are not significant on their own. In this example, this process would leave a few parameters at small lags for both the planning and movement periods, and one parameter corresponding to a lag of 50 ms for the planning period. However, the MLRT example showed that although many of the history-dependent parameters in this model are not significant on their own, together they substantially improve the model.</p>
<p>Instead of starting with a large model and paring it down, another approach to model selection is to start with a small model and step up the model order while examining the change in goodness-of-fit for each subsequent model. Of course, we have to be careful in comparing goodness-of-fit, since larger models tend to fit the data better even if they do not better predict future data. In <a href="09" rel="local">notebook 9</a>, we used Akaike’s information criterion (AIC) to compare the goodness-of-fit of models of different sizes. Let’s examine the change in AIC as we change the model order.</p>
<p>Before comparing models of different sizes, let’s consider the classes of models to explore. For the most recent model, we have separate history terms related to the planning and movement periods. The visualization analyses and previous modeling results suggest that the extent to which past spiking influences current spiking likely differs between these two periods. Therefore, let’s fit models with different orders for the history dependence in these separate periods. Mathematically, we would search for the value of the pair, <span class="math notranslate nohighlight">\((p, q)\)</span>, that minimizes the AIC of the model</p>
<div class="math notranslate nohighlight">
\[
  \lambda(t) = 
  \exp\big[
      \beta_0 + 
      \beta_1I_\text{move}(t) + 
      \beta_2I_\text{dir}(t) + 
      \sum_{j=1}^p \big(\mathbb 1 - I_\text{move}(t)\big)\beta_{2+j}\Delta N_{t-j} + 
      \sum_{j=1}^q \beta_{p + 2 + j}I_\text{move}(t)\Delta N_{t-j}
  \big].
\]</div>
<p>This might be the best choice if the goal were to find the most parsimonious model that captures the full dataset.</p>
<p>Alternatively, we could decide to fix a single value for the model order and force the history-dependent component to be the same size in both periods. In that case, we would find the single value <span class="math notranslate nohighlight">\(p\)</span> that minimizes the AIC of the model</p>
<div class="math notranslate nohighlight">
\[
  \lambda(t) = 
  \exp\big[
      \beta_0 + 
      \beta_1I_\text{move}(t) + 
      \beta_2I_\text{dir}(t) + 
      \sum_{j=1}^p \big(\mathbb 1 - I_\text{move}(t)\big)\beta_{2+j}\Delta N_{t-j} + 
      \sum_{j=1}^p \beta_{p + 2 + j}I_\text{move}(t)\Delta N_{t-j}
  \big].
\]</div>
<p>This might be the best choice if the goal were to compare the rhythmic spiking features between the planning and movement periods with a parsimonious model, since it allows us to test for differences, as with the preceding MLRT.</p>
<p>In this case, let’s consider a simpler problem: for the data in the planning period alone, let’s find the model order that minimizes the AIC of</p>
<div class="math notranslate nohighlight">
\[
  \lambda(t) = 
  \exp\big[
      \beta_0 + 
      \beta_1I_\text{dir}(t) + 
      \sum_{j=1}^p \beta_{1 + j}I_\text{move}(t)\Delta N_{t-j}
  \big].
\]</div>
<p>We will build models of order 1 up to order 100 and compute the AIC for each model. Because we are fitting many models, each with a large dataset, the following code might take a few minutes to run:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maxord</span> <span class="o">=</span> <span class="mi">100</span>                                 <span class="c1"># Define the maximum model order.</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ordK</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxord</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>        <span class="c1"># Add a history column for each lag greater than ordK</span>
    <span class="n">glmdata</span><span class="p">[</span><span class="s1">&#39;lag</span><span class="si">{:02d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">roll</span><span class="p">(</span><span class="n">glmdata</span><span class="o">.</span><span class="n">spikes</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

<span class="n">planHist</span> <span class="o">=</span> <span class="n">glmdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Isolate the planning period</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;spikes ~ IDir&#39;</span>                    <span class="c1"># Initialize the formula,</span>
<span class="n">aic</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">maxord</span><span class="p">,))</span>                       <span class="c1"># ... and the variable to store AIC values.</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxord</span><span class="p">):</span>                      <span class="c1"># For each model order,</span>
    <span class="n">formula</span> <span class="o">+=</span> <span class="s1">&#39; + lag</span><span class="si">{:02d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># ... update the formula,</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span>             <span class="c1"># ... create the model,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">planHist</span><span class="p">,</span>               <span class="c1"># ... supply the planning data,</span>
                <span class="n">family</span><span class="o">=</span><span class="n">Poisson</span><span class="p">())</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>      <span class="c1"># ... fit the model.</span>
    <span class="n">aic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">aic</span>                           <span class="c1"># Store the model AIC.</span>
</pre></div>
</div>
</div>
</div>
<div class="math-note">
<p>Recall that the AIC is related to the deviance of the fitted model (modulo a fixed constant) plus 2 times the number of parameters in the model. Therefore, we could also have computed the AIC using</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>aic[k] = M.deviance + 2 * len(M.params)
</pre></div>
</div>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxord</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">aic</span><span class="p">)</span>  <span class="c1"># Plot the AIC,</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Model Order&#39;</span><span class="p">)</span>            <span class="c1"># ... with axes labeled.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;AIC plot of models with increasing number of</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;history-dependent components for planning period&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_127_0.png" src="_images/10_127_0.png" />
</div>
</div>
<p>We see that the AIC drops sharply (with one little blip) from order 1 through order 6, after which the AIC starts to increase. However, as the model order continues to increase, the AIC plot undergoes a number of additional drops around lags of 25–35 ms and around 60 ms, reaching a minimum at a lag of 62 ms. The AIC continues to increase after that point up to lag 100 ms. Of course, it is possible that the AIC undergoes additional drops beyond a lag of 100 ms.</p>
<div class="question">
<p><strong>Q.</strong> Given the AIC results above, what model order would you choose?</p>
</div></div>
<div class="section" id="refining-the-model-smooth-history-dependence">
<h3>Refining the Model: Smooth History Dependence<a class="headerlink" href="#refining-the-model-smooth-history-dependence" title="Permalink to this headline">¶</a></h3>
<p>Let’s examine one more approach for constructing a parsimonious model that still captures history dependence in these data. Looking back at the <a class="reference external" href="#fig:M4params">parameter estimates for Model 4</a><span class="sup">fig<img src="imgs/fig-M4params.png"></span>, we see that nearby parameters have quite variable estimates. Do we really believe that the influence of a spike 25 ms in the past can be very different from the influence of a spike 26 ms in the past? If not, it might be preferable to define a model with fewer free parameters that guarantees a smooth modulation as a function of lag.</p>
<p>Motivated by this observation, let’s replace the separate terms for each single millisecond lag. We do so with a small set of basis functions on the spiking history that can flexibly capture smooth history dependence structure. Mathematically, we fit a model of the form <a id="eq:model5"></a></p>
<div class="math notranslate nohighlight">
\[\begin{split}
  \tag{Model 5}
  \begin{eqnarray}
  \lambda(t | H_t) &amp;=&amp; 
  \exp\big(
      \beta_0 + 
      \beta_1I_\text{move}(t) +
      \beta_2I_\text{dir}(t)\ + \\ &amp;&amp; \quad
      \sum_{j=1}^p 
      \big[
          \big(
              \mathbb 1 - I_\text{move}(t)
          \big)
          \beta_{1+2j} + 
          I_\text{move}(t)\beta_{2 + 2j}
      \big]g_j(H_t)
  \big),
  \end{eqnarray}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(H_t\)</span> is the full past firing history, and <span class="math notranslate nohighlight">\(g_j(H_t)\)</span> is a small collection of basis functions that together provide a smooth influence of the history on the current spiking intensity.</p>
<p>There are many sensible choices for these basis functions. A common choice is a
smoothing spline basis. Here we use a set of Gaussian kernel functions with means at different lags as the basis functions. Mathematically, we set <span class="math notranslate nohighlight">\(g_j(H_t) = \sum_\tau\Delta N_{t - \tau}\exp[-(\tau - \mu_j)^2 / (2\sigma^2)]\)</span>, where we let <span class="math notranslate nohighlight">\(\mu_j = 10j - 15\)</span> for <span class="math notranslate nohighlight">\(j = 1,\ldots, 8\)</span>, and <span class="math notranslate nohighlight">\(\sigma=5\)</span>. This choice of basis function is rather arbitrary; Gaussian kernels lack many of the nice properties of other basis functions. In this case, it was primarily chosen for ease of implementation in Python but also because of some simple intuition. The Gaussian kernel provides a way of smoothing the history dependence over a time scale set by the <span class="math notranslate nohighlight">\(\sigma\)</span> term. Setting <span class="math notranslate nohighlight">\(\sigma = 5\)</span> and spacing the means at 10 ms lags apart ensures that distinct features in the history modulation function will not be closer than about 10 ms in lag.</p>
<p>We construct this set of basis functions in Python as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">ordK</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ordK</span><span class="p">)])</span>
<span class="n">plot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_131_0.png" src="_images/10_131_0.png" />
</div>
</div>
<p>The result in <code class="docutils literal notranslate"><span class="pre">C</span></code> is a [70 × 8] matrix that we will use to convert the previous 70 history columns in <code class="docutils literal notranslate"><span class="pre">glmdata</span></code> into a new set of 8 columns to include in the design matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lags</span> <span class="o">=</span> <span class="n">glmdata</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;lag&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="n">ordK</span><span class="p">]</span>  <span class="c1"># Get the first ordK lags.</span>
<span class="n">basisCols</span> <span class="o">=</span> <span class="n">glmdata</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">lags</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>     <span class="c1"># Matrix multiply lags up to ordK by C.</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>                      <span class="c1"># Add the new basis columns to glmdata.</span>
    <span class="n">glmdata</span><span class="p">[</span><span class="s1">&#39;b</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="n">basisCols</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                                                  <span class="c1"># Formula to fit spikes with basis vectors.   </span>
<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;spikes ~ IMove + IDir + IMove : (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">glmdata</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

<span class="n">glmHist</span> <span class="o">=</span> <span class="n">glmdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">[</span><span class="n">ordK</span><span class="p">]]</span>
<span class="n">M5</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span>                     <span class="c1"># Create the model,</span>
             <span class="n">data</span><span class="o">=</span><span class="n">glmHist</span><span class="p">,</span>                        <span class="c1"># ... exclude the first ordK time points,</span>
             <span class="n">family</span><span class="o">=</span><span class="n">Poisson</span><span class="p">())</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>              <span class="c1"># ... fit the model.</span>
<span class="n">M5</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>spikes</td>      <th>  No. Observations:  </th>  <td> 96450</td> 
</tr>
<tr>
  <th>Model:</th>                  <td>GLM</td>       <th>  Df Residuals:      </th>  <td> 96431</td> 
</tr>
<tr>
  <th>Model Family:</th>         <td>Poisson</td>     <th>  Df Model:          </th>  <td>    18</td> 
</tr>
<tr>
  <th>Link Function:</th>          <td>log</td>       <th>  Scale:             </th> <td>  1.0000</td>
</tr>
<tr>
  <th>Method:</th>                <td>IRLS</td>       <th>  Log-Likelihood:    </th> <td> -18014.</td>
</tr>
<tr>
  <th>Date:</th>            <td>Sat, 13 Jun 2020</td> <th>  Deviance:          </th> <td>  26885.</td>
</tr>
<tr>
  <th>Time:</th>                <td>18:02:06</td>     <th>  Pearson chi2:      </th> <td>9.11e+04</td>
</tr>
<tr>
  <th>No. Iterations:</th>          <td>7</td>        <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
         <td></td>            <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>       <td>   -3.0337</td> <td>    0.053</td> <td>  -56.865</td> <td> 0.000</td> <td>   -3.138</td> <td>   -2.929</td>
</tr>
<tr>
  <th>IMove[T.True]</th>   <td>    0.3279</td> <td>    0.062</td> <td>    5.250</td> <td> 0.000</td> <td>    0.205</td> <td>    0.450</td>
</tr>
<tr>
  <th>IDir[T.True]</th>    <td>   -0.5036</td> <td>    0.034</td> <td>  -14.989</td> <td> 0.000</td> <td>   -0.569</td> <td>   -0.438</td>
</tr>
<tr>
  <th>IMove[False]:b0</th> <td>  -35.1150</td> <td>    3.161</td> <td>  -11.110</td> <td> 0.000</td> <td>  -41.310</td> <td>  -28.920</td>
</tr>
<tr>
  <th>IMove[True]:b0</th>  <td>  -35.1882</td> <td>    2.239</td> <td>  -15.715</td> <td> 0.000</td> <td>  -39.577</td> <td>  -30.799</td>
</tr>
<tr>
  <th>IMove[False]:b1</th> <td>    7.6090</td> <td>    0.859</td> <td>    8.858</td> <td> 0.000</td> <td>    5.926</td> <td>    9.293</td>
</tr>
<tr>
  <th>IMove[True]:b1</th>  <td>    8.5543</td> <td>    0.617</td> <td>   13.860</td> <td> 0.000</td> <td>    7.345</td> <td>    9.764</td>
</tr>
<tr>
  <th>IMove[False]:b2</th> <td>   -2.6924</td> <td>    0.706</td> <td>   -3.811</td> <td> 0.000</td> <td>   -4.077</td> <td>   -1.308</td>
</tr>
<tr>
  <th>IMove[True]:b2</th>  <td>   -2.8550</td> <td>    0.486</td> <td>   -5.871</td> <td> 0.000</td> <td>   -3.808</td> <td>   -1.902</td>
</tr>
<tr>
  <th>IMove[False]:b3</th> <td>   -2.4755</td> <td>    0.701</td> <td>   -3.532</td> <td> 0.000</td> <td>   -3.849</td> <td>   -1.102</td>
</tr>
<tr>
  <th>IMove[True]:b3</th>  <td>    1.5028</td> <td>    0.455</td> <td>    3.299</td> <td> 0.001</td> <td>    0.610</td> <td>    2.396</td>
</tr>
<tr>
  <th>IMove[False]:b4</th> <td>   -1.2299</td> <td>    0.669</td> <td>   -1.839</td> <td> 0.066</td> <td>   -2.541</td> <td>    0.081</td>
</tr>
<tr>
  <th>IMove[True]:b4</th>  <td>   -0.2786</td> <td>    0.456</td> <td>   -0.612</td> <td> 0.541</td> <td>   -1.171</td> <td>    0.614</td>
</tr>
<tr>
  <th>IMove[False]:b5</th> <td>    1.5456</td> <td>    0.622</td> <td>    2.485</td> <td> 0.013</td> <td>    0.326</td> <td>    2.765</td>
</tr>
<tr>
  <th>IMove[True]:b5</th>  <td>    0.1248</td> <td>    0.457</td> <td>    0.273</td> <td> 0.785</td> <td>   -0.772</td> <td>    1.021</td>
</tr>
<tr>
  <th>IMove[False]:b6</th> <td>    2.1231</td> <td>    0.597</td> <td>    3.554</td> <td> 0.000</td> <td>    0.952</td> <td>    3.294</td>
</tr>
<tr>
  <th>IMove[True]:b6</th>  <td>   -0.9600</td> <td>    0.460</td> <td>   -2.087</td> <td> 0.037</td> <td>   -1.862</td> <td>   -0.058</td>
</tr>
<tr>
  <th>IMove[False]:b7</th> <td>    1.3616</td> <td>    0.589</td> <td>    2.310</td> <td> 0.021</td> <td>    0.206</td> <td>    2.517</td>
</tr>
<tr>
  <th>IMove[True]:b7</th>  <td>    0.9499</td> <td>    0.429</td> <td>    2.214</td> <td> 0.027</td> <td>    0.109</td> <td>    1.791</td>
</tr>
</table></div></div>
</div>
<p>Now let’s plot for this model the modulation in the spiking intensity due to a previous spike at any lag by multiplying the corresponding set of parameters by <code class="docutils literal notranslate"><span class="pre">C</span></code>.<a id="fig:model5"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordK</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># Plot the planning modulation,</span>
     <span class="n">exp</span><span class="p">(</span><span class="n">matmul</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">array</span><span class="p">(</span><span class="n">M5</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">2</span><span class="p">]))),</span> 
     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Planning&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordK</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># ... and the movement modulation,</span>
     <span class="n">exp</span><span class="p">(</span><span class="n">matmul</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">array</span><span class="p">(</span><span class="n">M5</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">2</span><span class="p">]))),</span> 
     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Movement&#39;</span><span class="p">)</span>

<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag (ms)&#39;</span><span class="p">)</span>        <span class="c1"># ... with axes labeled.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Modulation&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Exponential GLM parameters related to history dependence</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
     <span class="s1">&#39;using Gaussian kernel basis functions of Model 5&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_135_0.png" src="_images/10_135_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q.</strong> How well does Model 5 fit the data?</p>
</div><p>To answer this, let’s construct one more KS plot:<a id="fig:m5ks"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lambda5</span> <span class="o">=</span> <span class="n">M5</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">glmHist</span><span class="p">)</span>
<span class="n">spikeindex</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">glmHist</span><span class="o">.</span><span class="n">spikes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">lambda5</span><span class="p">[</span><span class="n">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">])</span> 
     <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hstack</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">spikeindex</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span> <span class="n">spikeindex</span><span class="p">)]</span>

<span class="n">eCDF</span> <span class="o">=</span> <span class="n">ECDF</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
<span class="n">mCDF</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">eCDF</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">mCDF</span><span class="p">,</span> <span class="n">eCDF</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.36</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)),</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.36</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)),</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Model CDF&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Empirical CDF&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;KS plot for Model 5&#39;</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/fig-model5ks.png&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_138_0.png" src="_images/10_138_0.png" />
</div>
</div>
<div class="question">
<p><strong>Q.</strong> Compare the KS plot for Model 5 to the KS plot for Model 4. How does the model with Gaussian kernel basis functions compare to the previous model?</p>
<p><strong>A.</strong> Model 5 appears very similar to the previous model, even though we are using far fewer parameters. However, Model 5 still does not pass the KS test completely, as can be seen by the KS plot exiting the 95% confidence region at a model CDF value around 0.1.</p>
</div><div style="width:70%; margin: auto">
    <span style="width:50%; float: left"><img src="imgs/fig-model4ks.png"></span>
    <span style="width:50%; float: left"><img src="imgs/fig-model5ks.png"></span>
</div>
<div style="clear: both; display: table"></div><p>Although Model 5 does not completely pass the KS test, it does capture many of the features that we sought to identify through the analyses. We might therefore accept this as the final model, for the time being, and try to interpret its components. We can always return to the model selection procedure and continue to refine the model if we find that it fails to capture some important features of the data.</p>
<p><a class="reference external" href="#top">Back to top</a></p>
</div>
</div>
<div class="section" id="drawing-conclusions-from-the-model-a-id-drawing-conclusions-a">
<h2>Drawing Conclusions from the Model<a id="drawing-conclusions"></a><a class="headerlink" href="#drawing-conclusions-from-the-model-a-id-drawing-conclusions-a" title="Permalink to this headline">¶</a></h2>
<p>At last, let’s examine and interpret the Model 5 parameters. Exponentiating the first three, we get:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Parameters:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">M5</span><span class="o">.</span><span class="n">params</span><span class="p">[:</span><span class="mi">3</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-values:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">M5</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Parameters:
Intercept        0.048135
IMove[T.True]    1.388054
IDir[T.True]     0.604345
dtype: float64

p-values:
Intercept        0.000000e+00
IMove[T.True]    1.518398e-07
IDir[T.True]     8.676041e-51
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The best guess for the baseline firing intensity - for the planning period during left trials with no previous spiking in the past 70 ms - is approximately 0.048 spikes/ms, or 48 spikes/s. The firing intensity, excluding the effect of history dependence, increases about <code class="docutils literal notranslate"><span class="pre">exp(M5.params[1])=1.3881</span></code>, or 39%, when we move from the planning period to the movement period. This increase is highly significant (<code class="docutils literal notranslate"><span class="pre">M5.pvalues[1]</span> <span class="pre">=</span> <span class="pre">1.5e-07</span></code>) according to the model. The relative firing intensity between left and right trials is <code class="docutils literal notranslate"><span class="pre">exp(M5.params[2])</span> <span class="pre">=</span> <span class="pre">0.6043</span></code>; we find there is an approximate 40% decrease in the firing intensity for right trials as compared to left trials. This difference is again highly significant (<code class="docutils literal notranslate"><span class="pre">M5.pvalues[2]</span> <span class="pre">=</span> <span class="pre">8.7e-51</span></code>) according to the model.</p>
<p>In the <a class="reference external" href="#fig:model5">estimated modulation due to past spiking in Model 5</a><span class="sup">fig<img src="imgs/fig-model5.png"></span> for both the planning and movement periods, we observe a refractory period followed by a period of bursting (i.e., increased spiking intensity) around 6 ms in both the planning and movement periods. During the planning period, we also observe a notable pattern of decreased firing intensity at 20–30 ms after a previous spike, followed by increased firing intensity at 50–60 ms after a previous spike. This pattern seems absent during the movement period. Are the individual parameters related to this history dependence significant? To address this, let’s plot the <span class="math notranslate nohighlight">\(p\)</span>-values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">M5</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Planning&quot;</span><span class="p">)</span> <span class="c1"># -Log p-values in planning.</span>
<span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">M5</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Movement&quot;</span><span class="p">)</span> <span class="c1"># -Log p-values in movement.</span>
<span class="n">axhline</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;-Log(p)&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag parameter&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Negative log $p$-values for Model 5&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10_145_0.png" src="_images/10_145_0.png" />
</div>
</div>
<p>For Model 5, all but one of the parameters related to history modulation during the planning period are significant at the 0.05 level. However, this leads to the same multiple comparisons problem discussed earlier. For Model 4 we performed 140 tests, while here we have only 16 tests, far fewer, so the multiplicity problem is slightly reduced but still present. Again, we can avoid this problem by instead focusing on a single test to address the question of whether the history dependence structure differs between the planning and movement periods. Let’s fit a reduced model that uses the same basis functions for history dependence as Model 5 but includes only a single set of parameters for both the planning and movement periods.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;spikes ~ IMove + IDir + </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>          <span class="c1"># Write a formula</span>
    <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">glmHist</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)))</span>               <span class="c1"># ... excluding IMove cross-terms</span>
<span class="n">M6</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">glmHist</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">Poisson</span><span class="p">())</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>  <span class="c1"># Fit the model</span>
</pre></div>
</div>
</div>
</div>
<p>Next, let’s compute the MLRT statistic as the difference in the deviance between Model 5
and its reduction, and compute its significance based on the chi-square distribution,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">M6</span><span class="o">.</span><span class="n">deviance</span> <span class="o">-</span> <span class="n">M5</span><span class="o">.</span><span class="n">deviance</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>2.220446049250313e-16
</pre></div>
</div>
</div>
</div>
<p>Once again, we end up with a very significant result that provides confidence that the spiking dynamics really do change between periods. The rhythmic structure that we see during planning is attenuated during the movement period.</p>
<p><a class="reference external" href="#top">Back to top</a></p>
</div>
<div class="section" id="summary-a-id-summary-a">
<h2>Summary<a id="summary"></a><a class="headerlink" href="#summary-a-id-summary-a" title="Permalink to this headline">¶</a></h2>
<p>In this case study, we explored a variety of approaches for identifying and quantifying rhythmic spiking dynamics. One key point is that we can think about spike rhythms in terms of how the likelihood of spiking depends on its own history. Many of the most useful visualization tools that we explored, such as the autocorrelation plot and the spectral estimates, implicitly define the covariability of the spiking process with its past. The GLM methods allowed us to model this history dependence explicitly and to explore multiple features of the data simultaneously.</p>
<p>In the STN data, we also saw that rhythmic spiking structure can be subtle and hard to detect if we do not use the proper tools. The dynamic rhythms in these data were nearly impossible to see in raster plots or ISI histograms but became quite apparent in the autocorrelation plot, spectral density estimates, and model fits. Many people think of rhythmic spiking data as being like the beats of a metronome: perfect beats at a specific frequency. But we saw that very subtle changes in the firing probability, perhaps just a 10% increase or decrease at a particular lag, can lead to robust rhythms, as identified by visualization and modeling tools. Real spike rhythms often look more like the examples in this notebook than like the rhythms of a beating metronome.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "Mark-Kramer/Case-Studies-Python",
            ref: "gh-pages",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "."
        }
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="09.html" title="previous page">Point Process Generalized Linear Models</a>
    <a class='right-next' id="next-link" href="11.html" title="next page">Spike-field coherence</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Mark Kramer and Uri Eden<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>