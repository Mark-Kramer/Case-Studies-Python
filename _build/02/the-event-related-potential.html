---
redirect_from: /02
interact_link: content/02/the-event-related-potential.ipynb
kernel_name: python3
has_widgets: false
title: 'The Event-Related Potential'
prev_page:
  url: /01/introduction-to-python.html
  title: 'Introduction to Python'
next_page:
  url: /03/the-power-spectrum-part-1.html
  title: 'The Power Spectrum (Part 1)'
comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a id="introduction"></a></p>
<h1 id="The-Event-Related-Potential-for-the-practicing-neuroscientist">The Event-Related Potential <em>for the practicing neuroscientist</em><a class="anchor-link" href="#The-Event-Related-Potential-for-the-practicing-neuroscientist"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

_**Synopsis**_ 

**Data:** 1 s of scalp EEG data sampled at 500 Hz during 1,000 trials in two conditions.

**Goal:** Characterize the response of the EEG in the two conditions.

**Tools:** Visualization, event-related potential, confidence intervals, bootstrapping.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><a href="#background">Background</a></li>
<li><a href="#case-study-data">Case Study Data</a></li>
<li><a href="#data-analysis">Data Analysis</a><ul>
<li><a href="#visual-inspection">Visual Inspection</a></li>
<li><a href="#plotting-the-erp">Plotting the ERP</a></li>
<li><a href="#cis-m1">Confidence Intervals for the ERP (Method 1)</a></li>
<li><a href="#comparing-erps">Comparing ERPs</a></li>
<li><a href="#cis-m2">Confidence Intervals for the ERP (Method 2)</a></li>
<li><a href="#bootstrap">A Bootstrap Test to Compare ERPs</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before we start any computations, let's import some modules and functions that we will use throughout the chapter. A module can be imported any time, but there are a few things that we know we will need straight off the bat. For clarity, it is best practice to import packages at the beginning.</p>
<p>You will see that we have imported <code>matlab.pyplot</code> and can call any functions in the module with <code>plt.f()</code>, where <code>f</code> should be replaced with the name of the desired function. Hence, if we want to plot something, we would call <code>plt.plot()</code>. However, we will use that function so often that it will be convenient to import <code>plot()</code> directly without typing <code>plt</code> first.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.io</span> <span class="k">import</span> <span class="n">loadmat</span>       <span class="c1"># Import function to read data.</span>
<span class="kn">from</span> <span class="nn">IPython.lib.display</span> <span class="k">import</span> <span class="n">YouTubeVideo</span>  <span class="c1"># Enable YouTube videos</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                 <span class="c1"># Import numpy for computations</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>    <span class="c1"># Import a useful plotting package, </span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="k">import</span> <span class="n">plot</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="n">subplots</span><span class="p">,</span> <span class="n">savefig</span>
                                   <span class="c1"># ... and a few specific functions that are used often</span>
<span class="c1"># ... make the plots &quot;inline&quot;.</span>
<span class="o">%</span><span class="k">matplotlib</span> inline                 

<span class="c1"># Tools for this chapter</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="k">import</span> <span class="n">imshow</span><span class="p">,</span> <span class="n">colorbar</span><span class="p">,</span> <span class="n">hlines</span><span class="p">,</span> <span class="n">vlines</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="k">import</span> <span class="n">randint</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="On-ramp:-computing-the-event-related-potential-in-Python">On-ramp: computing the event-related potential in Python<a class="anchor-link" href="#On-ramp:-computing-the-event-related-potential-in-Python"> </a></h2><p>We begin this module with an "<em>on-ramp</em>" to analysis. The purpose of this on-ramp is to introduce you immediately to a core concept in this module: how to compute an event-related potential with error bars in Python. You may not understand all aspects of the program here, but that's not the point. Instead, the purpose of this on-ramp is to  illustrate what <em>can</em> be done. Our advice is to simply run the code below and see what happens ...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;EEG-1.mat&#39;</span><span class="p">)</span>  <span class="c1"># Load the data,</span>
<span class="n">EEGa</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;EEGa&#39;</span><span class="p">]</span>  <span class="c1"># ... and get the EEG from one condition,</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># ... and a time axis,</span>
<span class="n">ntrials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">EEGa</span><span class="p">)</span>  <span class="c1"># ... and compute the number of trials.</span>

<span class="n">mn</span> <span class="o">=</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Compute the mean signal across trials (the ERP)</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Compute the std of the signal across trials</span>
<span class="n">sdmn</span> <span class="o">=</span> <span class="n">sd</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ntrials</span><span class="p">)</span>  <span class="c1"># Compute the std of the mean</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>  <span class="c1"># Resize the figure</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mn</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Plot the ERP of condition A</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mn</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sdmn</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># ... and include the upper CI</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mn</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sdmn</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># ... and the lower CI</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>  <span class="c1"># Label the axes</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage [$\mu$ V]&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;ERP of condition A&#39;</span><span class="p">)</span>  <span class="c1"># ... provide a useful title</span>
<span class="n">show</span><span class="p">()</span>  <span class="c1"># ... and show the plot</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_6_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q:** Try to read the code above. Can you see how it loads data, computes the event-related potential and error, and then plots the results?

**A:** If you've never computed an event-related potential before, that's an especially difficult question. Please continue on to learn this **and more**!
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Background-">Background <a class="anchor" id="background" /><a class="anchor-link" href="#Background-"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;Cy_BF7smAkk&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/Cy_BF7smAkk"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Voltage recordings from the scalp surface - the electroencephalogram or EEG - provide a powerful window into brain voltage activity.  Some of the earliest human EEG recording occurred in 1924, when <a href="https://en.wikipedia.org/wiki/Hans_Berger">Dr. Hans Berger</a> made a remarkable discovery:  the EEG of a human subject at rest with eyes closed exhibits rhythmic activity, an approximately 10 Hz oscillation he labeled the alpha rhythm.  Although now studied for nearly 100 years, the definitive functional role (if any) of the alpha rhythm remains unknown.  Since then, many other EEG rhythms have been detected and labelled (typically with Greek letters) and the analysis of EEG rhythms remains <a href="https://global.oup.com/academic/product/rhythms-of-the-brain-9780199828234">an active area of research</a>.</p>
<p>Compared to other modalities for measuring brain activity, the EEG possesses both advantages and disadvantages.  Perhaps the most important advantages are:</p>
<ol>
<li>The EEG is non-invasive, and</li>
<li>The EEG permits a high temporal resolution (on the order of milliseconds).</li>
</ol>
<p>However, the EEG measure also suffers from significant disadvantages, the most devastating being the poor spatial resolution;  a single scalp electrode detects the summed activity from approximately 10 cm<sup>2</sup> of cortex.</p>
<p>In this chapter, we consider EEG data recorded from a single scalp electrode.  We will analyze these data to determine what (if any) activity is evoked following two different types of stimuli presented to a human subject.  In doing so, we will use Python, and see how this powerful tool can help us understand these time series data.  We begin with a brief description of the EEG data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Case Study: an EEG ERP task <a class="anchor" id="case-study-data"><a/></h2>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;q2-DjvPRaNA&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/q2-DjvPRaNA"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>An undergraduate student volunteers to participate in a psychology study at his university. In this study, EEG electrodes (sampling rate 500 Hz, i.e., 500 samples per second) are placed on the student's scalp, and he is seated in a comfortable chair in a dark, electrically isolated room.  The student is instructed to place headphones over his ears and listen to a series of repeated sounds.  The sounds consist of two tones - either a high pitch tone or a low pitch tone.  A single tone is presented once every few seconds, and the student responds with a button press to the low pitch tone.  The tone presentation is repeated to collect the EEG response to numerous presentations of the two tones, as illustrated here:</p>
<p><img src="imgs/2-1.png"></p>
<p>In this cartoon illustration of the EEG experiment, the EEG electrodes are placed on the scalp surface of a human subject (left).  The EEG activity (blue) is recorded as a function of time during presentation of high pitch tones (black) and low pitch tones (orange).</p>
<p>Our collaborator leading this research study has agreed to provide us with EEG data recorded at a single electrode for 1000 presentations of the high pitch tone, and 1000 presentations of the low pitch tone.  In each presentation - or "trial" - she provides us with 1 s of EEG data, such that the tone occurs at 0.25 s into the trial.  She asks us to analyze these data to determine whether the EEG signal differs following the two tone presentations.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Analysis-">Data Analysis <a id="data-analysis" /><a class="anchor-link" href="#Data-Analysis-"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our first step is to load the data into Python.  To do so, we use the function <code>loadmat()</code> from the <code>scipy.io</code> module as follows:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.io</span> <span class="k">import</span> <span class="n">loadmat</span>       <span class="c1"># Import function to read data.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;EEG-1.mat&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To understand the outcome of issuing this command, let's examine the variable <code>data</code> now present in the workspace.  This variable is a <em>dictionary</em> variable (to see this, execute <code>type(data)</code>). To see the <em>keys</em> of a dictionary, use the <code>keys()</code> method.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;__header__&#39;, &#39;__version__&#39;, &#39;__globals__&#39;, &#39;EEGa&#39;, &#39;EEGb&#39;, &#39;t&#39;])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The keys that start and end with two underscores ( <code>__</code> ) are private and contain information about the MATLAB file; we will not need those keys here. The variables that we are interested in here are <code>EEGa</code>, <code>EEGb</code>, and <code>t</code>. These correspond to the EEG data recorded in the two conditions (i.e., <code>EEGa</code> to condition A and <code>EEGb</code> to condition B) as well as a time axis (<code>t</code>). Let's extract these variables from the <code>data</code> dictionary.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EEGa</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;EEGa&#39;</span><span class="p">]</span>
<span class="n">EEGb</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;EEGb&#39;</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You may notice that we specified index zero when we imported the variable <code>t</code>. This is because <code>t</code> is a vector (one-dimensional) rather than an array (multi-dimensional). The default behavior of <code>loadmat()</code> is to extract variables as ndarray types (to see this, execute <code>type(EEGa)</code>). Specifically, if we don't tell Python to import the <a href="https://en.wikipedia.org/wiki/Zero-based_numbering">zeroth</a> (row) element of <code>data['t']</code> then <code>t</code> will have shape (1, 500), rather than (500,). There may be cases where this arrangement is preferred, but best practice is to convert the variable to a one-diminsional vector.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1, 500)
(500,)
1
500
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

In general, a single underscore at the beginning of a variable, function or method indicates that this object should be treated as *private*. Double underscores often indicate that Python will interpret this object with some special instructions. In both cases, for what we are doing, we can usually ignore an object that starts with an underscore.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's use the <code>whos</code> command to get some more information about the variables.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">whos</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Variable   Type                          Data/Info
--------------------------------------------------
EEGa       ndarray                       1000x500: 500000 elems, type `float64`, 4000000 bytes (3.814697265625 Mb)
EEGb       ndarray                       1000x500: 500000 elems, type `float64`, 4000000 bytes (3.814697265625 Mb)
colorbar   function                      &lt;function colorbar at 0xb19a21b70&gt;
data       dict                          n=6
hlines     function                      &lt;function hlines at 0xb19a22f28&gt;
imshow     function                      &lt;function imshow at 0xb19a23048&gt;
mn         ndarray                       500: 500 elems, type `float64`, 4000 bytes
ntrials    int                           1000
randint    builtin_function_or_method    &lt;built-in method randint &lt;...&gt;te object at 0x10b362c60&gt;
sd         ndarray                       500: 500 elems, type `float64`, 4000 bytes
sdmn       ndarray                       500: 500 elems, type `float64`, 4000 bytes
sqrt       ufunc                         &lt;ufunc &#39;sqrt&#39;&gt;
t          ndarray                       500: 500 elems, type `float64`, 4000 bytes
vlines     function                      &lt;function vlines at 0xb19a23d90&gt;
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

We could also have used `EEGa.shape` to find out the dimensions of the variable `EEGa`.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the <em>Data/Info</em> column we see <em>1000x500</em> for <code>EEGa</code> and <code>EEGb</code>.  Both variables are matrices with 1000 rows and 500 columns.  Our collaborator tells us that:</p>
<ul>
<li>each row corresponds to a separate trial, and</li>
<li>each column to a point in time.</li>
</ul>
<p>So there are 1000 total trials, each consisting of 500 time points.  As a matter of convenience, we define a new variable to record the number of trials:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ntrials</span> <span class="o">=</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># len(EEGa) would give the same result</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>shape</code> property of an array is a <em>tuple</em> that indicates the size of each dimension. Adding <code>[0]</code> at the end tells Python to give us only the first value in the tuple. Recall that Python indexing starts at 0. This variable will be useful later, as we'll see. In fact, we can assign two variables at the same time:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ntrials</span><span class="p">,</span> <span class="n">nsamples</span> <span class="o">=</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With this syntax:</p>
<ul>
<li>we assign the variable <code>ntrials</code> to the value <code>EEGa.shape[0]</code>, which is the number of rows.</li>
<li>we assign the variable <code>nsamples</code> to the value <code>EEGa.shape[1]</code>, which is the number of columns.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Determine the size of the variable `EEGb`. How many rows and columns does it possess? Which dimension corresponds to trials and which corresponds to time?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

A *tuple* is another data structure in Python that is similar to an array or a list because it usually contains more than one element. Python treats each of these structures slightly differently, however. One of the most challenging things about starting with Python is learning to understand the different data structures. Here, we will mainly work with arrays, which are good for holding multidimensional data. If you are curious and want to know more about data structures, there is a very concise description <a href="http://thomas-cokelaer.info/tutorials/python/data_structures.html">here</a> to get you started.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Visual-Inspection-">Visual Inspection <a id="visual-inspection" /><a class="anchor-link" href="#Visual-Inspection-"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;uSjd41G-yNY&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/uSjd41G-yNY"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Both <code>EEGb</code> and <code>EEGa</code> are complicated variables that contain many elements. To understand these data, we might attempt to read the values contained in each element. For example, we can print out the EEG data for the first trial of condition A</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span> <span class="n">EEGa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>  <span class="c1"># EEGa[0, :] is equivalent to EEGa[0]</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[-1.85909632e-01  4.49876010e-01  1.06070801e+00 -4.71265246e-01
  1.68669327e+00  9.38221338e-01  2.21207038e-01  4.05491276e-01
  8.78879665e-01  5.23697825e-01 -2.35240678e+00 -9.24345879e-01
  7.66671797e-01 -4.64254999e-01  6.25953180e-02  1.51917029e+00
 -7.76400815e-01  8.14988739e-01 -1.58137285e-01 -6.17402518e-01
  2.07506393e-01  3.59430871e-01 -1.21455008e+00 -6.16715452e-01
 -4.81362032e-02  3.17982689e-01 -2.77459585e-01  4.14839815e-02
 -1.52257779e+00  1.31993666e+00  1.46836023e+00  1.84666100e+00
  5.23163980e-02  2.05515379e-01  2.27994679e-01 -1.34063464e+00
  5.61451651e-01  1.20391968e+00  1.06398658e+00  4.38748238e-01
  1.64443736e+00 -1.54713823e+00  6.41177787e-01 -1.13319311e+00
  1.06869889e+00  3.88678297e-01 -1.86251056e+00 -1.14074604e+00
 -4.59323117e-01  7.46220184e-01  4.40752835e-01 -7.05129357e-01
 -1.85879610e-01 -4.52021194e-02 -7.74389189e-01  1.55051475e+00
  1.12600755e+00 -1.14703552e+00 -5.42577409e-02  8.27809465e-01
  8.56502531e-01 -1.14366915e+00 -8.19876772e-01  1.43053099e+00
  3.58257978e-01 -3.63287337e-01  2.95693239e-01  1.66255457e+00
 -1.81447543e+00 -5.63326663e-01  2.93117130e-01 -1.68396270e+00
 -1.62231509e-01 -1.00251701e+00 -9.48001461e-01  3.16019127e-02
  2.21147695e-01  3.99303915e-01  1.00913940e-01  1.21148596e+00
  7.96770791e-01  1.66308465e+00 -6.46124699e-01 -1.02735954e-01
  3.99807249e-01  2.03571783e-01  1.26714525e+00 -4.04535735e-01
 -8.58928288e-02  3.81672240e-01 -8.10521508e-01  5.62971518e-01
 -1.50312432e-01  2.16392074e+00 -7.56258314e-01  1.78649753e+00
 -5.76044830e-01  2.70405891e-02 -1.77661427e-01 -8.66317207e-01
 -2.71389551e-01 -3.89374337e-01  1.32780017e+00  6.56102489e-01
 -6.17931971e-01  4.38460156e-01  4.96160421e-01 -2.43224802e-01
 -7.59665353e-01  2.12561928e-01 -5.29236003e-01 -7.79237099e-01
 -3.99720441e-01 -5.73857423e-01  1.68557371e-02 -3.33452422e-01
  5.49266775e-02 -8.05679798e-01  3.48038611e-01  1.10559489e+00
  1.58877419e-01  4.26861264e-01 -3.58946165e-01  1.49418999e+00
  9.00513782e-01 -8.29008444e-01  2.26386025e+00 -5.42571448e-01
  1.51343144e+00 -6.21544949e-01 -7.22549599e-01  3.21016398e-01
  1.28741129e-01  1.27751490e+00 -7.49605666e-01  1.52310976e+00
 -6.86917819e-03 -2.54194745e-01  1.00352371e+00 -5.12364395e-01
  1.66279331e-01 -1.69990836e+00 -1.85635884e+00  3.02517825e-01
  5.55141950e-02  4.32485593e-01 -2.74367743e+00 -2.81457510e-01
  8.14989513e-01  2.61966455e-01  1.04412960e+00  9.65418636e-01
  3.41587255e-01 -1.88010279e-01 -8.39449139e-01  6.33492347e-01
 -1.24757135e+00  1.31337736e+00 -6.22469263e-01  1.09149506e+00
 -1.09034016e+00  3.76813749e-01 -3.18257114e-01  2.61894031e+00
 -2.76705198e-01  4.42140552e-01 -1.43555653e+00  7.85517143e-01
 -9.88738053e-01  6.72988002e-01  8.68360705e-01  3.13242062e-01
 -1.54828005e-01  1.17732668e+00  4.02575413e-01 -2.25480529e-01
  2.72944171e-01 -7.02691389e-01 -2.31377386e+00 -2.22783195e-01
 -1.35413650e+00 -1.15072542e+00 -2.88073430e-01  1.81260388e-01
 -2.23623245e-01 -1.94225711e-01 -5.57725111e-01  8.91721155e-01
  1.16596501e-01  2.63088800e-01 -7.05166127e-01  4.08335180e-01
 -7.90285417e-01  9.51082199e-01  2.10206983e+00 -1.47579554e-01
 -4.84839924e-01  1.60258306e+00  8.81078598e-02  3.61369070e-01
  2.27598177e-02  3.17643233e-01  7.36130484e-02  1.37376140e+00
  7.61866764e-01 -3.98162196e-01 -1.31208258e+00 -7.31528581e-01
 -1.07254213e+00  1.22320138e+00 -2.58565701e+00 -1.14526894e+00
 -4.33488841e-01 -4.39707520e-01 -1.03812489e+00 -2.62273457e-01
  6.38441158e-01  8.12705883e-01 -8.18589118e-01 -1.08256005e+00
 -3.80301239e-01 -6.89096543e-01  2.39683506e-01  8.50289735e-01
 -7.26308358e-01 -4.91580776e-01  1.03219979e+00  1.12525973e-01
 -5.71141273e-01  6.18952595e-02  1.09705291e+00  7.85887270e-01
 -1.85564767e-01  1.14603225e+00 -2.06964423e+00 -4.38792883e-01
  1.74227196e+00  1.94092238e-01 -1.47258884e+00 -6.41420839e-01
  6.72742297e-02 -1.58340914e-02  1.37746846e+00 -2.56196901e-01
 -5.67582665e-01  5.37033982e-01 -5.44631235e-01  3.23707432e-01
  1.61864414e+00  6.64638714e-02 -1.06040359e+00  5.45961175e-02
  3.93434967e-02 -1.05920809e+00 -2.98790912e-01  2.22548242e+00
  2.24405511e-01 -5.42362119e-01  5.22628043e-01  1.10073489e+00
 -4.75832910e-01 -1.48245524e+00 -5.19264968e-01  8.66583703e-01
  3.71195522e-01 -2.10862001e+00  1.41854997e+00 -4.00056944e-01
 -1.04638985e+00 -2.23544462e-03 -5.98113911e-01 -7.59605516e-01
 -9.26386972e-01 -2.18387895e-01 -1.09959119e+00  3.36465936e-01
 -7.19877563e-01  9.42514084e-01 -4.25416496e-01  3.79620259e-01
 -1.70723125e+00  1.06572378e-02 -2.35473140e-01  4.54021576e-01
 -1.02334158e+00 -1.38240225e-01  3.48629888e-01 -2.68704032e-01
  5.91463529e-01 -1.78286801e-01  1.02320933e+00 -7.07756343e-01
 -1.16006916e+00  1.91717624e+00 -1.23381123e-01 -2.68528533e-01
 -1.14265441e+00  1.36823726e+00  1.77076815e-01  1.20573044e+00
  1.41205843e+00 -2.15337976e+00  6.00658920e-01  1.15495770e-01
 -1.31467338e+00 -5.09848812e-01 -4.70210648e-01 -1.95764263e+00
  1.46093909e+00  1.31264582e+00  2.08027524e+00 -2.83817742e-02
 -3.34822927e-02  5.97081623e-02 -2.41728231e+00 -2.06588056e+00
 -1.74279194e-01  2.06744443e-01 -1.09047610e+00 -1.19118680e-01
  4.01697824e-01  3.02122302e-01  3.34421161e-01 -1.10831100e+00
 -9.20222909e-01  2.32218615e-01 -2.55154972e-01 -3.14863316e-01
 -1.59970267e+00  4.36780490e-01  5.65896649e-01 -9.78787106e-01
  1.22855597e+00  7.58542962e-01  5.58518929e-01 -6.29520116e-02
  1.18742536e+00  1.18562777e+00  1.42177066e+00 -1.06696561e+00
 -1.78054659e+00 -8.24179662e-01  1.72242837e+00 -1.13652998e+00
 -2.74037314e-01 -1.61735137e+00  1.76740867e+00 -1.36302046e+00
 -1.24542747e+00 -1.10195479e+00  4.97427770e-01  3.40747285e-01
  1.29469407e+00 -1.68192736e-01 -1.58189637e+00  3.32752964e-01
  2.06914282e-01 -8.33433942e-01 -1.20097677e+00  4.09469512e-01
 -5.56735550e-01 -2.86558705e-02 -8.96614175e-01 -2.22091771e+00
 -1.34815359e+00  6.51385061e-01  1.36132110e+00  5.12259438e-01
  1.15080616e+00 -9.45816812e-01  3.48666490e-01  1.29115601e+00
  1.13964510e+00  1.13056053e+00 -7.28460179e-02  1.58127482e+00
  8.66434530e-01 -1.77527248e-01 -4.01926432e-01  1.61406298e+00
  1.93971032e+00  1.75279276e+00 -2.56648516e+00 -9.33356759e-01
 -2.54317956e-01 -1.13741045e-01  4.05204253e-01 -1.43414289e+00
 -1.37124663e+00  8.71688411e-01  9.86925920e-01  1.58442262e-01
  1.10944234e+00 -2.60888891e-01 -4.94844677e-01  2.10364682e-01
 -6.90648659e-01  9.44229553e-01 -1.67842868e+00  9.94333574e-01
 -5.42498176e-02 -6.10670786e-01  3.40630320e-01 -1.32665190e+00
 -6.35411807e-01  1.82564630e-01  1.03543428e+00  9.70748027e-02
 -5.46855555e-01 -3.30881410e+00 -4.63280602e-01  2.24579407e-01
 -2.24752515e+00  9.98283459e-01 -1.06182712e+00 -3.46684931e-02
  1.41764225e+00 -1.24954136e+00 -6.18775586e-01 -5.11007703e-01
 -9.14202212e-01 -3.01515892e-01 -1.59706594e+00  2.40487958e-01
  1.59654644e-03  5.03777332e-01  1.84766666e-01  3.90711577e-01
  2.27690541e+00 -1.67938680e+00  1.52788636e+00 -1.68420319e+00
 -5.06769300e-01  1.19757238e+00 -2.78010488e-01  6.86491400e-02
 -5.39049209e-01 -1.29632687e-01  3.14379167e-01  6.84138095e-01
  9.36048610e-01 -1.45547151e+00 -2.69117642e-01  4.91635711e-01
 -9.69470971e-01  1.83872986e+00  8.19492008e-01 -4.22742826e-01
 -1.02695268e-01  3.65153939e-01 -4.40593064e-01 -6.06052965e-01
  4.75034049e-01 -1.21577077e+00 -9.68793697e-01 -6.46342514e-01
  1.08533369e+00 -2.19535994e-01 -1.19895690e-01  1.98995688e-01
  6.82348483e-01 -1.10943112e-01  1.19046834e-01  6.71215306e-01
 -9.96084629e-01  1.34367623e+00  1.62036945e+00 -5.62949996e-01
 -8.61888584e-01  1.49041285e+00 -7.57353843e-01  4.98675751e-01
 -2.50954448e-01 -1.79724228e+00 -1.35719865e+00  1.05713585e+00
 -1.05491807e-01  4.63733007e-01 -2.16122922e-01 -7.99948330e-01
 -6.55124881e-01 -2.24820127e+00  2.37631176e-01 -9.71408307e-01
 -7.66843512e-01 -2.70585493e-01 -1.11657661e+00  1.25282149e+00
 -1.60574278e+00 -2.23134272e+00  9.09836712e-01  8.87246449e-01
 -1.72687413e+00  5.94455670e-01 -6.35422508e-01  9.86293109e-01
 -9.91015631e-01 -7.97709874e-01 -1.27420635e+00  8.67409389e-01]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this command, we index the first row of the matrix <code>EEGa</code> and print out all columns (corresponding to all moments of time).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Upon issuing this command what do you find? Does the printout help you understand these data?

**A.** You should observe a list of 500 numbers that begins 

    `-1.85909632e-01   4.49876010e-01   1.06070801e+00  -4.71265246e-01   1.68669327e+00   9.38221338e-01 ...`

We might conclude that these numbers exhibit variability (i.e., the values are both positive and negative), but examining the data in this way is not particularly useful. For example, determining trends in the behavior (such as intervals of repeated activity) through inspection of these printed numbers alone is extremely difficult.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;9qx29zDxcAc&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/9qx29zDxcAc"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Printing out the data to the screen is <strong>not useful</strong> in this case. How else can we deepen our understanding of these data? Let’s make a plot:
<a id="fig:2"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">EEGa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                   <span class="c1"># Plot the data from condition A, trial 1.</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/2-2a&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_45_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Visualizing the data in this way, we immediately notice many features. First, let’s consider the axes. The horizontal axis extends from 0 to (nearly) 500. This corresponds to the 500 columns in the variable <code>EEGa</code>. While this visualization is useful, it would be more informative to plot the EEG data as a function of time rather than indices. Fortunately, we possess a variable <code>t</code> in the workspace that corresponds to the time axis. Determining the size of the variable <code>t</code>, we find it is a vector with 1 row and 500 columns. Each column corresponds to a point in time.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Plot the variable `t`. What is its range? 
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The variable <code>t</code> corresponds to the 1 s of EEG data recorded in each trial. We can also use the variable <code>t</code> to determine the sampling interval,</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Determine the sampling interval</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The new variable <code>dt</code> corresponds to the time between samples.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** What is the value of `dt`? We were told by our collaborator that the sampling frequency is 500 Hz. Is the value of `dt` consistent with this sampling frequency?

**A.** Yes, it is consistent. Using the command `print(dt)`, we find that `dt` is 0.002 s, or 2 ms. The sampling frequency of 500 Hz corresponds to one sample of the EEG data every 1/(500 Hz) = 2 ms. If the two were not consistent, we would return to our collaborator and figure out what has gone wrong. In general, it’s useful to ask such questions along the way to make sure we understand the formatting of the data and catch any potentially serious misunderstandings early in the analysis.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div id="singleTrial">

We can now combine the time axis with the EEG data to make a more complete plot. Let’s also label the axes and give the plot a title.

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">EEGa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                     <span class="c1"># Plot condition A, trial 1 data vs t.</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>                   <span class="c1"># Label the x-axis as time.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage [$\mu$ V]&#39;</span><span class="p">)</span>          <span class="c1"># Label the y-axis as voltage.</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;EEG data from condition A, Trial 1&#39;</span><span class="p">)</span>  <span class="c1"># Add a title</span>

<span class="c1"># Add a vertical line to indicate the stimulus time</span>
<span class="n">plot</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/2-2b&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_53_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This plot provides a nice summary of the data in the first trial of condition A. Visual inspection of the plot suggests that these data exhibit complicated activity. We know from our collaborator that the stimulus occurs at time 0.25 s in each trial. Note how we indicated this time as a vertical line in the plot above. This command includes additional options that make the line black (<code>'k'</code>) and a bit wider (<code>lw=2</code>).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** What else, if anything, can you say about the single trial of EEG data plotted above? Does the visual inspection reveal any particular change in the EEG activity following the stimulus presentation?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So far we have visualized only the data from condition A. Because we are interested in whether the EEG behaves differently in the two conditions, visualizing both conditions simultaneously would be of use. We can do this as follows:
<a id="fig:3"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>     <span class="c1"># Resize the figure to make it easier to see</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">EEGa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                 <span class="c1"># Plot condition A, trial 1, data vs t,</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">EEGb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>            <span class="c1"># ... and the data from condition B, trial 1,</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>              <span class="c1"># Label the x-axis as time.</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage [\mu V]&#39;</span><span class="p">)</span>       <span class="c1"># Label the y-axis as voltage.</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;EEG data from conditions A (blue) and B (red), Trial 1&#39;</span><span class="p">)</span> <span class="c1"># And give it a title.</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/2-3&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_57_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

Note that because we did not import the function `figure()` directly, we need to include the prefix `plt`.

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Compare the voltage traces from the first trial of conditions A and B as plotted above. What similarities and differences do you observe?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** The analysis has so far focused only on the first trial. Repeat this visual inspection of the data for different trials. What do you find? What similarities and differences exist between the two conditions across trials?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;nandZ5aaRaQ&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/nandZ5aaRaQ"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These techniques allow us to visualize the data one trial at a time. That is useful but can be time consuming, especially for a large number of trials. For the EEG data of interest here, each condition contains 1,000 trials, and to visualize each trial separately could require 2,000 plots. We can certainly create 2,000 plots, but the subsequent visual inspection would be time consuming and difficult. Fortunately, a more efficient visualization approach exists: we can display the entire structure of the data across both time and trials as an image:
<a id="fig:4"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imshow</span><span class="p">(</span><span class="n">EEGa</span><span class="p">,</span>                                   <span class="c1"># Image the data from condition A.</span>
           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;BuPu&#39;</span><span class="p">,</span>                            <span class="c1"># ... set the colormap (optional)</span>
           <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ntrials</span><span class="p">],</span>       <span class="c1"># ... set axis limits (t[-1] represents the last element of t)</span>
           <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>                          <span class="c1"># ... set aspect ratio </span>
           <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>                         <span class="c1"># ... put origin in lower left corner</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time[s]&#39;</span><span class="p">)</span>                              <span class="c1"># Label the axes</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Trial #&#39;</span><span class="p">)</span>
<span class="n">colorbar</span><span class="p">()</span>                                     <span class="c1"># Show voltage to color mapping</span>
<span class="n">vlines</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>       <span class="c1"># Indicate stimulus onset with line</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/2-4&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_63_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>imshow</code> command allows us to visualize the entire matrix <code>EEGa</code> as a function of trial number and time. Each row corresponds to a single trial of duration 1 s, and the color indicates the voltage, with darker (lighter) colors indicating higher (lower) voltages. This plot also indicates the time of stimulus presentation with a vertical black line as a cue to assist visual inspection.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

We have used the *BuPu* color map for the plot above. There are many other options; use `plt.colormaps?` for details.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.**
Upon close inspection of the figure above, what response, if any, do you observe following the stimulus presentation? (Look *really* carefully.) Repeat this visualization and analysis for `EEGb`. How do the two conditions compare?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Plotting-the-ERP-">Plotting the ERP <a id="plotting-the-erp" /><a class="anchor-link" href="#Plotting-the-ERP-"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;kPr2GLSKLJg&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/kPr2GLSKLJg"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Visual inspection of the EEG data has so far come up empty. The EEG traces appear noisy or perhaps rhythmic, but from visual inspection of the individual trials it’s difficult to make a decisive conclusion of underlying structure (<a href="#singleTrial">see above</a>). To further investigate the activity in these data, we compute the <strong>event-related potential</strong> (ERP).</p>
<p>To compute the ERP, we first assume that each trial evokes an instantiation of the same underlying brain process. So, in this case, we assume that the same brain response is evoked 1,000 times (once for each trial) for each condition. However, the evoked response due to the stimulus is small and hidden in the EEG signal by other ongoing activity unrelated to the stimulus (e.g., daydreaming, thoughts of dinner, thoughts of homework). Therefore, to tease out the weak evoked effect, <strong>we average the EEG responses across trials</strong>. Ideally, EEG activity unrelated to the stimulus will cancel out in the average, while EEG activity evoked by the stimulus will sum constructively. The procedure to perform and display this averaging can be done in Python as follows:
<a id="fig:5"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># Plot the ERP of condition A</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>           <span class="c1"># Label the axes</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage [$\mu V$]&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;ERP of condition A&#39;</span><span class="p">)</span>  <span class="c1"># ... provide a title</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/2-5&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>                       <span class="c1"># ... and show the plot</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_71_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the first line, we compute the mean of <code>EEGa</code> using the method <code>mean()</code>; see the documentation for this function <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.mean.html">here</a>. The default behavior is to compute the mean of all elements of the array. By calling <code>EEG.mean(0)</code>, we compute the mean along the zeroth dimension. The result is the ERP for condition A.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Consider the ERP for condition A plotted above. Update this figure to include a vertical line at the location of the stimulus, and the ERP for condition B. How, if at all, do the ERPs for Conditions A and B differ?

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The ERP of condition A shows the mean voltage across trials at each moment in time. Visual inspection suggests that before stimulus presentation (i.e., times 0 s to 0.25 s) the EEG fluctuates around zero. Then, after stimulus presentation, the ERP increases and decreases substantially above and below zero. Which, if any, of these deviations following stimulation are significant? To address this, we make use of the trial structure of the EEG data to compute confidence bounds for the ERP. We do so in two ways.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Confidence-Intervals-for-the-ERP-(Method-1)-">Confidence Intervals for the ERP (Method 1) <a id="cis-m1" /><a class="anchor-link" href="#Confidence-Intervals-for-the-ERP-(Method-1)-"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;pXCJbyrw8Ug&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/pXCJbyrw8Ug"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To compute the ERP we average the EEG data across many trials. Because of this, we may make use of a powerful theorem in statistics—the <a href="https://en.wikipedia.org/wiki/Central_limit_theorem"><em>central limit theorem</em></a> (CLT)—to include approximate confidence bounds in the ERP figure. Briefly, this theorem states that the mean of a sufficiently large number of independent random variables, each with finite mean and variance, will be approximately <a href="https://en.wikipedia.org/wiki/Normal_distribution">normally distributed</a>. Remember that the ERP at each moment in time is the sum of EEG activity across trials (then scaled by a constant, the number of trials). Let’s assume that the trials are independent (i.e., one trial does not depend on any other trial). Let’s also assume that the EEG data at each moment in time have finite mean and variance. With those assumptions, we have satisfied the CLT and may therefore conclude that the ERP at each moment in time is approximately normally distributed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** To use the CLT, we make two assumptions about the EEG data. Are these assumptions reasonable?

**A.** We assume that the EEG data are independent across trials. This assumption may fail if, for example, the activity in one trial influences the activity in the next trial. We also assume that the EEG data are “well-behaved” (i.e., have finite mean and variance). That is a reasonable assumption for physical data we observe from the brain; we expect the EEG data to always remain finite and not diverge to plus or minus infinity.

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This conclusion—that the ERP at each moment in time is approximately normally distributed—is useful because the normal distribution (also known as the Gaussian distribution or bell curve) possesses many convenient properties. First, a normal distribution is relatively simple; it can be completely specified with two parameters: the mean value and the standard deviation. Second, 95% of the values drawn from a normal distribution lie within approximately two standard deviations of the mean.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="imgs/gaussian.png" alt="Example Gaussian" style="width:40%; max-width:300px;"/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here's a plot of the canonical normal distribution showing the mean (dotted vertical line) and standard deviation (blue). Ninety-five percent of values lie within the interval indicated by the red bar.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Therefore, to construct a 95% confidence interval for the ERP, we need to determine the mean and standard deviation of the mean across trials at each point in time. To compute the mean in Python is easy:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mn</span> <span class="o">=</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Compute the mean across trials (the ERP)</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

Note that when we refer to the *mean* here we could instead write *sample mean* because we use the observed data to estimate the theoretical mean that we would see if we kept repeating this experiment. This distinction is not essential to our goals here, but it is important when talking to your statistics-minded colleagues. Throughout the book, we omit the term sample when referring to sample means, variances, covariances, and so forth, unless this distinction is essential to the discussion.

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We again note that the second input to the <code>mean</code> function specifies the dimension in which we compute the mean, in this case, across the first dimension of the variable <code>EEGa</code> corresponding to the trials. To compute the standard deviation of the mean, we start by computing the standard deviation of the data:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sd</span> <span class="o">=</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Compute the std across trials</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But we’re not interested in the standard deviation of the EEG data across trials; instead, we’re interested in the standard deviation <em>of the estimate of the mean</em>. To calculate the standard deviation of the mean, we divide the standard deviation of the data by the square root of the number of trials (i.e., the number of terms used to compute the mean). In Python,</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdmn</span> <span class="o">=</span> <span class="n">sd</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ntrials</span><span class="p">)</span>  <span class="c1"># Compute the std of the mean</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, having found the mean (<code>mn</code>) and the standard deviation of the mean (<code>sdmn</code>), we can compute a 95% confidence interval for the ERP. We again exploit the observation, based on the central limit theorem, that the ERP is normally distributed at each instant of time. With these calculations, the following code plots the ERP and the 95% confidence interval:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>     <span class="c1"># Save the axes for use in later cells and resize the figure</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mn</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>              <span class="c1"># Plot the ERP of condition A</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mn</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sdmn</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># ... and include the upper CI</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mn</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sdmn</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># ... and the lower CI</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>                     <span class="c1"># Label the axes</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage [$\mu$ V]&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;ERP of condition A&#39;</span><span class="p">)</span>            <span class="c1"># ... provide a useful title</span>
<span class="n">fig</span>                                    <span class="c1"># ... and show the plot</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_91_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The ERP computed with confidence intervals allows us to ask specific questions about the data. For example, does the ERP ever differ significantly from zero? To answer this, we look for intervals of the ERP for which the confidence intervals do not include zero. To aid visual inspection, we add to the ERP plot a horizontal line at 0: <a id="plt:erpA-m1"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

A good rule of thumb when you are programming is that you should not be rewriting (or copy-pasting) code over and over again. Instead, you should write a function that you can call whenever you need the action that you keep repeating. At this point, we have resized the plots and labeled the axes the same way several times so we should fix the default plot size and write a function that automates the labeling so that next time we make a plot, we don't need to rewrite the same code again.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Change the default figure size</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Create a function to label plots</span>
<span class="k">def</span> <span class="nf">labelPlot</span><span class="p">(</span><span class="n">title_string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function that labels the x-axis as &#39;Time [s]&#39; and</span>
<span class="sd">    the y-axis as &#39;Voltage [$\mu V$]&#39;. </span>
<span class="sd">    Arguments:</span>
<span class="sd">        title_string:  string variable to be used as</span>
<span class="sd">                       the plot title (default: &#39;Title&#39;)</span>
<span class="sd">                       </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>           <span class="c1"># x-axis is time</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage [$/mu V$]&#39;</span><span class="p">)</span>  <span class="c1"># y-axis is voltage</span>
    <span class="n">title</span><span class="p">(</span><span class="n">title_string</span><span class="p">)</span>          <span class="c1"># use the input here</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    <span class="c1"># no white-space in plot</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** How would you write a function to compute the ERP and confidence bounds of a dataset?

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** What do you think the following code will do?

       `ax.hlines(0, t[0], t[-1])`

Try it out.

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** What is the role of the method function `hlines()` in this code? *Hint*: If you have not encountered this function before, look it up in the Documentation.

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/2-7&#39;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="../images/02/the-event-related-potential_98_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the figure above, the thick line indicates the ERP for Condition A (i.e., the mean of the EEG across trials) while the thin dotted lines indicate the 95% confidence intervals.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We find three time intervals at which the confidence intervals of the ERP do not include zero: near 0.27 s, near 0.37 s, and near 0.47 s. These results suggest that for an interval of time following the stimulus presentation in condition A, the observed ERP is not a random fluctuation about zero but instead contains consistent structure across trials.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Construct the ERP with confidence intervals for condition B. As for condition A, you should find that before stimulus presentation the ERP fluctuates around zero. What intervals of time, if any, differ significantly from zero?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Comparing-ERPs-">Comparing ERPs <a class="anchor" id="comparing-erps" /><a class="anchor-link" href="#Comparing-ERPs-"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the previous section, we implemented a procedure to compute confidence intervals for the ERPs in conditions A and B. To investigate <em>differences</em> between the ERPs in the two conditions, we can use a similar approach. To start, let’s plot the ERPs with confidence intervals for both conditions and attempt to identify periods for which the confidence intervals do not overlap (such intervals would correspond to significant differences between the responses of the two conditions).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">my_module</span> <span class="k">import</span> <span class="n">ERP</span>  <span class="c1"># A function written by the author to compute the ERP</span>

<span class="n">erpA</span><span class="p">,</span> <span class="n">ca_l</span><span class="p">,</span> <span class="n">ca_h</span> <span class="o">=</span> <span class="n">ERP</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;EEGa&#39;</span><span class="p">])</span>  <span class="c1"># Compute the ERP of condition A</span>
<span class="n">erpB</span><span class="p">,</span> <span class="n">cb_l</span><span class="p">,</span> <span class="n">cb_h</span> <span class="o">=</span> <span class="n">ERP</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;EEGb&#39;</span><span class="p">])</span>  <span class="c1"># ... and condition B</span>

<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ca_l</span><span class="p">,</span> <span class="s1">&#39;r:&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ca_h</span><span class="p">,</span> <span class="s1">&#39;r:&#39;</span><span class="p">)</span>  <span class="c1"># Plot confidence bounds in back</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">cb_l</span><span class="p">,</span> <span class="s1">&#39;b:&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">cb_h</span><span class="p">,</span> <span class="s1">&#39;b:&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">erpA</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;condition A&#39;</span><span class="p">)</span>  <span class="c1"># ... and ERPs in front</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">erpB</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;condition B&#39;</span><span class="p">)</span>

<span class="c1"># Prettify</span>
<span class="n">labelPlot</span><span class="p">(</span><span class="s1">&#39;ERP of conditions A and B&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/2-8a&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_105_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** In the cell above, the ERPs and confidence bounds are computed using a function written by the author. Can you write the code to make this plot yourself?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see, the plot of both ERPs is rather messy; it’s difficult to determine through visual inspection alone in which intervals the ERPs exhibit significant separation.</p>
<p>To facilitate further inspection of the data, we compute the difference between the ERPs in the two conditions. In the differenced signal, large deviations between the two conditions will appear as large differences from zero. To determine whether a deviation is significantly different from zero, we need to determine the confidence interval for the differenced ERP. This requires we propagate the standard deviation of the mean for both ERPs to the new differenced ERP. The propagated standard deviation of the mean at a fixed moment in time is computed as:</p>
<p><a id="eq:1"></a>
$$ \sigma = \sqrt{\frac{\sigma_A^2}{K} + \frac{\sigma_B^2}{K}}, \tag{1}$$</p>
<p>where $\sigma_A$ is the standard deviation of the data from condition A, $\sigma_B$ is the standard deviation of the data from condition B, and $K$ is the number of trials.</p>
<p>In Python we compute the differenced ERP and standard deviation of the mean of the difference as follows:
<a id="plt:differencedERP"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mnA</span> <span class="o">=</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># ERP of condition A</span>
<span class="n">sdmnA</span> <span class="o">=</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ntrials</span><span class="p">)</span>  <span class="c1"># ... and standard dev of mean</span>

<span class="n">mnB</span> <span class="o">=</span> <span class="n">EEGb</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># ERP of condition B</span>
<span class="n">sdmnB</span> <span class="o">=</span> <span class="n">EEGb</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ntrials</span><span class="p">)</span>  <span class="c1"># ... and standard dev of mean</span>

<span class="n">mnD</span> <span class="o">=</span> <span class="n">mnA</span> <span class="o">-</span> <span class="n">mnB</span>  <span class="c1"># the differenced ERP</span>
<span class="n">sdmnD</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sdmnA</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">sdmnB</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># ... and its standard dev</span>

<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mnD</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># plot the differenced ERP</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mnD</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sdmnD</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>  <span class="c1"># ... the upper CI</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mnD</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sdmnD</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>  <span class="c1"># ... and the lower CI</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>  <span class="c1"># ... and a horizontal line at 0</span>
<span class="n">labelPlot</span><span class="p">(</span><span class="s1">&#39;Differenced ERP&#39;</span><span class="p">)</span>  <span class="c1"># label the plot</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_108_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the code above we first compute the ERP and standard deviation of the mean for each condition. We then compute the differenced ERP (<code>mnD</code>) and the standard deviation of the mean of this difference (<code>sdmnD</code>) using equation (<a href="#eq:1" class="thumb">1<span>)<img src="imgs/eq1.png"></span></a>. We note that <code>sdmnA</code>$= \sqrt{\sigma_A^2/K}$ and therefore <code>sdmnA**2</code> $= \sigma_A^2/K$, with similar expressions for condition B. We then plotted the resulting differenced ERP with 95% confidence intervals. The hope is that from this figure we can more easily identify significant differences between the two conditions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q:** Examine the plot of the differenced ERP. In what intervals of time do the EEG responses in the two conditions significantly differ?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Confidence-Intervals-for-the-ERP-(Method-2)-">Confidence Intervals for the ERP (Method 2) <a id="cis-m2" /><a class="anchor-link" href="#Confidence-Intervals-for-the-ERP-(Method-2)-"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;vVXH4XsPFEs&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/vVXH4XsPFEs"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So far we have computed confidence intervals for the ERPs by relying on the central limit theorem and approximating the average voltage values at each point in time as normally distributed. That’s a completely reasonable approach. And because the normal distribution is so well-behaved, it’s easy to compute the 95% confidence intervals. An alternative approach to generate confidence intervals is through a <strong>bootstrap</strong> procedure. Bootstrapping is a resampling method that allows us to estimate the sampling distribution of many different statistics. In this chapter, we implement a <em>nonparametric bootstrap</em> (see note). To do so, we generate new <em>pseudodata</em> from the observed EEG data. We begin by using a bootstrapping procedure to create confidence intervals for the ERPs observed in each condition.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="math-note">

**A note on the nonparametric bootstrap.** Briefly, there is strong theoretical justification for the nonparametric bootstrap. The fundamental idea is that resampling the data with replacement is equivalent to sampling new pseudodata from the empirical cumulative distribution function (eCDF) of the observed data. For a large sample of independent, identically distributed random variables, the distribution of the pseudodata generated from the eCDF will be close to the true distribution of the data. Note the important caveat that the variables are independent, identically distributed; this assumption fails in many cases, such as for time series. Here, we assume that each trial is drawn independently from the same distribution (i.e., the trials are independent, identically distributed variables).
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We implement the bootstrapping procedure to compute pointwise confidence intervals. By pointwise we mean that the confidence intervals are computed separately for each point in time, and interactions across time are not considered. The prescription for the bootstrapping procedure follows four steps:</p>
<ol>
<li>Sample with replacement 1,000 trials of the EEG data from condition A.</li>
<li>Average these 1,000 trials to create a resampled ERP.</li>
<li>Repeat these two steps 3,000 times to create a distribution of ERPs.</li>
<li>For each time point, identify the values greater than 2.5% and less than 97.5% of all 3,000 values. This range determines the 95% confidence interval for the ERP for that time point.</li>
</ol>
<p>Let’s now implement each step in Python.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;mqDEJyW_z4c&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/mqDEJyW_z4c"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Step 1.</strong> In step 1 we must sample with replacement from the EEG data. To visualize this procedure, imagine placing 1,000 marbles in an opaque bag. Each marble is assigned a unique integer value from 1 to 1,000. Now, reach your hand into the bag, grab a marble, record its number, and replace the marble in the bag. We assume that each marble is equally likely to be selected at each draw (i.e., there are no special features that allow some marbles to be drawn more often). Repeat this procedure 1,000 times to create a list of 1,000 integers. Notice that after recording the drawn marble’s number, we replace it in the bag. So, we could potentially draw the same marble 1,000 times, although that’s extremely unlikely. Performing this sampling with replacement procedure by hand would, of course, be extremely time consuming (e.g., who will paint integers on each marble?). Fortunately, Python provides a function to perform sampling with replacement:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Draw 1000 integers with replacement from [0, 1000)</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ntrials</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ntrials</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The first and second inputs to <code>randint()</code> specify the minimum and maximum integers to draw, respectively. Note that the low number is included in the set, but the high number is not. If only the upper bound is given, the lower bound is assumed to be zero (i.e., we can rewrite the above line as <code>np.random.randint(ntrials, size=ntrials)</code>). The last input indicats the number of samples to draw (as always, use <code>np.random.randint?</code> to find out more).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Examine the values of `i`. What values do you find?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The result <code>i</code> provides a list of integers between 0 and 999. These values specify the trials to use in creating the resampled EEG. This resampled EEG will contain the same number of trials as the original EEG (i.e., 1,000 trials) but in a different order and with possibly repeated trials. For example, if the sampling with replacement procedure returns</p>

<pre><code>i = [10, 941, 3, 400, 10, ...

</code></pre>
<p>then the first and fifth trials of the resampled EEG will equal the eleventh trial of the original EEG (remember that Python indices start at zero). We create the resampled EEG in Python as follows:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EEG0</span> <span class="o">=</span> <span class="n">EEGa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># Create the resampled EEG.</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this code we use the variable <code>i</code> as the index to the rows of <code>EEGa</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** What is the `shape` of the new variable `EEG0`? Is this shape consistent with the original EEG datasets?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That completes step 1 of the resampling procedure.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;bUzuNojLUik&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/bUzuNojLUik"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Step 2.</strong> This step is easy: we create a resampled ERP from the resampled EEG data. Computing the resampled ERP requires only one line of code in Python:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ERP0</span> <span class="o">=</span> <span class="n">EEG0</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Create the resampled ERP</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** What is the difference between the resampled EEG and resampled ERP? Explain your answer in words.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Plot the resampled ERP that we created. What does it look like?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;feQk_vKloXk&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/feQk_vKloXk"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Step 3.</strong> In the first two steps of the resampling procedure we created a single resampled ERP. In step 3 we are instructed to repeat this procedure 3,000 times and create a distribution of ERPs. How can we do so? One potential solution is to cut and paste the code we developed over and over again, for example:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">ntrials</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ntrials</span><span class="p">);</span>  <span class="c1"># Draw integers,</span>
<span class="n">EEG1</span> <span class="o">=</span> <span class="n">EEGa</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>  <span class="c1"># ... create resampled EEG,</span>
<span class="n">ERP1</span> <span class="o">=</span> <span class="n">EEG1</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>  <span class="c1"># ... create resampled ERP.</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">ntrials</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ntrials</span><span class="p">);</span>  <span class="c1"># Draw integers,</span>
<span class="n">EEG2</span> <span class="o">=</span> <span class="n">EEGa</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>  <span class="c1"># ... create resampled EEG,</span>
<span class="n">ERP2</span> <span class="o">=</span> <span class="n">EEG2</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>  <span class="c1"># ... create resampled ERP.</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">ntrials</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ntrials</span><span class="p">);</span>  <span class="c1"># Draw integers,</span>
<span class="n">EEG3</span> <span class="o">=</span> <span class="n">EEGa</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>  <span class="c1"># ... create resampled EEG,</span>
<span class="n">ERP3</span> <span class="o">=</span> <span class="n">EEG3</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>  <span class="c1"># ... create resampled ERP.</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In these lines we have created three resampled ERPs, each with its own variable name. We could, of course, repeat this procedure and eventually define the variable <code>ERP3000</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Is defining the resampled ERPs in this way a good idea?

**A.** No! We should let the computer execute this repeated procedure for us. If you find yourself cutting and pasting the same code over and over again, you're probably doing something inefficient, inelegant, and error-prone.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A better approach to create the 3,000 resampled ERPs is with a <em>for-loop</em>. We do so in Python with the <code>for</code> statement:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">bootstrapERP</span><span class="p">(</span><span class="n">EEGdata</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># Steps 1-2</span>
    <span class="sd">&quot;&quot;&quot; Calculate bootstrap ERP from data (array type)&quot;&quot;&quot;</span>
    <span class="n">ntrials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">EEGdata</span><span class="p">)</span>  <span class="c1"># Get the number of trials</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Unless the size is specified,</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">ntrials</span>  <span class="c1"># ... choose ntrials</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">ntrials</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>  <span class="c1"># ... draw random trials,</span>
    <span class="n">EEG0</span> <span class="o">=</span> <span class="n">EEGdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># ... create resampled EEG,</span>
    <span class="k">return</span> <span class="n">EEG0</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># ... return resampled ERP.</span>

<span class="n">ERP0</span> <span class="o">=</span> <span class="p">[</span><span class="n">bootstrapERP</span><span class="p">(</span><span class="n">EEGa</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3000</span><span class="p">)]</span>  <span class="c1"># Step 3: Repeat 3000 times </span>
<span class="n">ERP0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ERP0</span><span class="p">)</span>  <span class="c1"># ... and convert the result to an array</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the first line, we define a function that performs the calculations that we wish to repeat. In this case, the function performs steps 1 and 2 of the bootstrapping procedure. The last two lines call the function 3,000 times and convert the result from a <em>list</em> into an <em>array</em>. This completes step 3 of the bootstrapping procedure.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

Note that in the definition of `bootstrapERP`, we included an argument (`size`) that has a *default* value (`None`). This lets us assume that we want the resampled dataset to be the same size as the original, which is true for right now. Later, however, we will reuse this function but will not want the resampled data to be the same size as the original.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

In Python it is common to see for-loops written in the form

    `y = [f(x) for x in some_set]`

This will return a *list* datatype, which is why we had to convert it to an array in the code above. We could also have written the loop in an alternative way:


    `ERP0 = np.zeros((3000, EEGa.shape[1]))`

    `for k in range(3000):`

    `    ERP0[k, :] = bootstrapERP()`

Note that it is good practice, but not required, to define a function that contains the code you wish to repeat, especially if you might use it again later. This minimizes rewrites, and if there is a mistake then you only need to make a correction in one place.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;NLc93QESVZs&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/NLc93QESVZs"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Step 4.</strong> In this step of the bootstrapping procedure, we determine for each time point the values greater than 2.5% and less than 97.5% of all values. There are many ways to perform this operation in Python, perhaps the easiest being to sort from smallest to largest the 3,000 resampled ERP values at each time point. With the resampled values sorted in this way, we then find the resampled ERP value at index $0.025 \times 3000 = 75$ and $0.975 \times 3000 = 2925$. These indices correspond to the resampled ERP values greater than 2.5% of all values and greater than 97.5% of all values, respectively, and therefore define the lower and upper confidence intervals at each moment in time. We can compute both confidence intervals in Python, and (at last!) plot the ERP for condition A with confidence intervals computed using the bootstrapping procedure: <a id="fig:1"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ERP0</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Sort each column of the resampled ERP</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ERP0</span><span class="p">)</span>  <span class="c1"># Define the number of samples</span>
<span class="n">ciL</span> <span class="o">=</span> <span class="n">ERP0</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.025</span><span class="o">*</span><span class="n">N</span><span class="p">)]</span>  <span class="c1"># Determine the lower CI</span>
<span class="n">ciU</span> <span class="o">=</span> <span class="n">ERP0</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.975</span><span class="o">*</span><span class="n">N</span><span class="p">)]</span>  <span class="c1"># ... and the upper CI</span>
<span class="n">mnA</span> <span class="o">=</span> <span class="n">EEGa</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Determine the ERP for condition A</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mnA</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># ... and plot it</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ciL</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>  <span class="c1"># ... and plot the lower CI</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ciU</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>  <span class="c1"># ... and the upper CI</span>
<span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>  <span class="c1"># plot a horizontal line at 0</span>
                      <span class="c1"># ... and label the axes</span>
<span class="n">labelPlot</span><span class="p">(</span><span class="s1">&#39;ERP of condition A with bootstrap confidence intervals&#39;</span><span class="p">)</span>  <span class="c1"># We define this function above!</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/02/the-event-related-potential_144_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can use these results to identify, for example, intervals in which the ERP differs significantly from zero by finding periods in which the confidence intervals do not include zero. The advantage of the bootstrapping procedure over other approaches is that this procedure requires few assumptions about the distribution of the statistic of interest, and that we use the observed data to probe the distribution of the statistic. The disadvantage of the bootstrapping procedure is that it is computationally intensive. Here we considered 3,000 resamplings, but we could easily consider more.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Compare the confidence intervals in the plot above (bootstrap confidence intervals) to [the CLT confidence intervals](#plt:erpA-m1) computed earlier. How are the two results similar or different? What happens to the confidence intervals if you change the number of resamplings in step 3 from 3,000 to 10,000?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Compute the confidence intervals using the bootstrapping procedure for the ERP of condition B. What do you find?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-Bootstrap-Test-to-Compare-ERPs-">A Bootstrap Test to Compare ERPs <a id="bootstrap" /><a class="anchor-link" href="#A-Bootstrap-Test-to-Compare-ERPs-"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;K6pgCxFdELc&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/K6pgCxFdELc"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The bootstrapping procedure provides a powerful technique to construct confidence intervals for the ERPs using only the observed EEG measurements. We can apply a similar technique to search for significant differences between the ERPs in conditions A and B. To do so, we first choose a <em>statistic</em>, a measure of some attribute of the difference between the two ERPs. There are many choices, some informative and some not. Let’s choose as our statistic the maximum absolute value of the difference in the ERPs across time. Computing this statistic is straightforward in Python:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mbA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">EEGa</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>          <span class="c1"># Determine ERP for condition A</span>
<span class="n">mnB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">EEGb</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>          <span class="c1"># Determine ERP for condition B</span>
<span class="n">mnD</span> <span class="o">=</span> <span class="n">mnA</span> <span class="o">-</span> <span class="n">mnB</span>                <span class="c1"># Compute the differenced ERP</span>
<span class="n">stat</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mnD</span><span class="p">))</span>        <span class="c1"># Compute the statistic</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stat = </span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stat</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>stat = 0.2884
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Given the value we determined for `stat`, are the ERPs for the two conditions different?
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;390ywma7S3U&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/390ywma7S3U"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In isolation, the numerical value for <code>stat</code> is not very useful or interesting. Is the value for <code>stat</code> consistent with noisy scalp EEG data lacking an evoked response? Or is the value for <code>stat</code> large and unexpected to occur unless the ERPs in the two conditions are different? To make the statistic useful, we need <code>stat</code> to be interpretable, which we pursue here through a bootstrapping procedure. We assume that no difference exists between the two conditions; in the language of statistics, this is called the <a href="https://en.wikipedia.org/wiki/Null_hypothesis"><em>null hypothesis</em></a>. If the null hypothesis holds, then we can pool all the EEG signals together from both conditions (for a total of 2,000 trials) and draw from this combined distribution to create resampled ERPs representative of either condition.</p>
<p>It may seem odd to create pseudodata by selecting trials across both conditions; intuitively, we may expect the data to differ in these two conditions and feel uncomfortable making a pseudodata set that includes trials from both conditions. But under the null hypothesis, we assume no difference between the EEG responses in conditions A and B, and we are therefore free to create pseudodata drawing from trials in both conditions. We do so with the goal of creating a distribution of values for <code>stat</code> under the null hypothesis that conditions A and B exhibit no difference. We then compare the observed value of <code>stat</code> with this distribution of <code>stat</code> values. If there is a difference between the two conditions, we expect to find the observed value of <code>stat</code> to be very different from the distribution of <code>stat</code> values generated from the pseudodata under the null hypothesis.</p>
<p>To create the distribution of <code>stat</code> values under the null hypothesis of no difference between the two conditions, we perform a bootstrap test. The idea is similar to the bootstrapping procedure used to construct the <a href="#fig:1">confidence intervals for the ERP</a> <abbr class="figsup">fig<img src="imgs/2-1.png"></abbr>. We proceed as follows:</p>
<ol>
<li>Merge the 1,000 trials each of EEG data from conditions A and B to form a combined distribution of 2,000 trials.</li>
<li>Sample with replacement 1,000 trials of EEG data from the combined distribution, and compute the resampled ERP.</li>
<li>Repeat step 2 and compute a second resampled ERP.</li>
<li>Compute the statistic, the maximum absolute value of the difference between the two resampled ERPs.</li>
<li>Repeat steps 2-4, 3,000 times to create a distribution of statistic values.</li>
<li>Compare the observed statistic to this distribution of statistic values. If the observed statistic is greater than 95% of the bootstrapped values, then reject the null hypothesis that the two conditions are the same.</li>
</ol>
<p>The code to implement this procedure is similar to the bootstrapping procedure that we have already implemented to compute the confidence intervals for the ERP:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EEG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">EEGa</span><span class="p">,</span> <span class="n">EEGb</span><span class="p">))</span>  <span class="c1"># Step 1. Merge EEG data from all trials</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>  <span class="c1"># For reproducibility</span>

<span class="k">def</span> <span class="nf">bootstrapStat</span><span class="p">(</span><span class="n">EEG</span><span class="p">):</span>  <span class="c1"># Steps 2-4.</span>
    <span class="n">mnA</span> <span class="o">=</span> <span class="n">bootstrapERP</span><span class="p">(</span><span class="n">EEG</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ntrials</span><span class="p">)</span>  <span class="c1"># Create resampled ERPa. The function &#39;bootstrapERP&#39; is defined above!</span>
    <span class="n">mnB</span> <span class="o">=</span> <span class="n">bootstrapERP</span><span class="p">(</span><span class="n">EEG</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ntrials</span><span class="p">)</span>  <span class="c1"># Create resampled ERPb</span>
    <span class="n">mnD</span> <span class="o">=</span> <span class="n">mnA</span> <span class="o">-</span> <span class="n">mnB</span>  <span class="c1"># Compute differenced ERP</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mnD</span><span class="p">))</span>  <span class="c1"># Return the statistic</span>

<span class="n">statD</span> <span class="o">=</span> <span class="p">[</span><span class="n">bootstrapStat</span><span class="p">(</span><span class="n">EEG</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3000</span><span class="p">)]</span>  <span class="c1"># Resample 3,000 times</span>
</pre></div>

    </div>
</div>
</div>

</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this code, we first combine <code>EEGa</code> and <code>EEGb</code> in a new variable <code>EEG</code>.
Then, as before, we define the function <code>bootstrapStat</code> which performs the operations that we wish to repeat. Both of the first two lines of the function call <code>bootstrapERP</code>, the function that we defined earlier to compute a resampled ERP. Note that in this case, we call <code>bootstrapERP</code> with <code>size=ntrials</code>. When we combined the original datasets in <code>EEG</code>, we generated a dataset with twice the number of trials, but we still wish to perform the bootstrap procedure to create a resampled ERP using the original number of trials (1,000). The last two lines of the function compute the resampled difference and return the statistic. Finally, we repeat the procedure 3,000 times using a for-loop.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;iefCPGHd5vY&#39;</span><span class="p">)</span>
<span class="c1"># NO CODE</span>
</pre></div>

    </div>
</div>
</div>

</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/iefCPGHd5vY"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img alt="Bootstrap distribution of statistic values" title="" src="imgs/bootstrapERPdiff.png" height="20" width="600"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The figure above shows the distribution of values for the test statistic under the null hypothesis of no difference between the two conditions. The orange line indicates observed statistic from the EEG data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="python-note">

The `seed()` function controls the random numbers that are generated. This ensures that when you recreate the plot above, yours will look identical. Nonetheless, if you remove (or comment out) this statement, your plot should still look very similar as the distribution should change only slightly.
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** See if you can write code to generate this plot using the `hist()` function from the NumPy module. 
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="question">

**Q.** Given the distribution of `statD` values shown above, and the value of `stat` computed from the original data, can we conclude that the difference between the two conditions is significant with this statistic?

**A.** Yes. Under the null hypothesis, the distribution fo the statistic ranges from approximately 0.15 to 0.33. The observed statistic `stat = 0.2884` exceeds most values in this distribution. Computing `sum(statD > stat)` we find in this example that only 18 of the 3,000 values in the distribution exceed the observed statistic. This corresponds to a proportion of 18/3000 = 0.006. We therefore reject the null hypothesis of no difference between the ERPs of conditions A and B. This result may be surprising, given how similar the two ERPs appear and the large variability in their differences ([see figure](#plt:differencedERP)).
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This result illustrates the power of the bootstrapping procedure. We proposed a complicated statistic (the maximum absolute value of the difference between the two resampled ERPs). For this statistic, we do not possess an obvious formula to decide whether the resulting statistic is significant (we cannot rely on the CLT, for example). To determine significance, we employ a bootstrapping procedure (also known as a permutation test), which we can perform even for the relatively complicated statistic. In this way, we may devise complicated measures of data and construct error bars or compute statistical significance, provided our computational resources are sufficient.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Summary-">Summary <a id="summary" /><a class="anchor-link" href="#Summary-"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this notebook, we considered scalp EEG data recorded from a single electrode during an auditory task. The task consisted of two conditions, and we sought to uncover the difference in the EEG responses between the two conditions. We began with a visual inspection of the EEG recordings from individual trials and from all trials, and concluded that the data were quite noisy; any evoked response due to the stimulus was not obvious in the single-trial data.</p>
<p>To emphasize the evoked signal, we computed the ERP, which involved averaging the EEG signal across trials. By doing so, we uncovered interesting structure in condition A, but not much in condition B. We then developed two techniques to add error bars to an ERP. One technique relied on the central limit theorem, and the other technique involved a computationally expensive bootstrapping procedure. Both techniques suggested that the ERP in condition A differed significantly from zero following the stimulus at time 0.25 s.</p>
<p>Finally, we assessed whether the two ERPs from condition A and condition B differed. We did so through visual inspection, by comparing the differences in the ERPs, and by computing a statistic and assessing its significance through a bootstrapping procedure. Using the last procedure, we concluded that the ERP in the two conditions significantly differed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="#introduction">Return to top</a></p>

</div>
</div>
</div>
 

